/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var lt=Object.defineProperty;var oa=Object.getOwnPropertyDescriptor;var ca=Object.getOwnPropertyNames;var la=Object.prototype.hasOwnProperty;var da=(e,t)=>{for(var n in t)lt(e,n,{get:t[n],enumerable:!0})},ua=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ca(t))!la.call(e,r)&&r!==n&&lt(e,r,{get:()=>t[r],enumerable:!(a=oa(t,r))||a.enumerable});return e};var ha=e=>ua(lt({},"__esModule",{value:!0}),e);var fs={};da(fs,{default:()=>ct});module.exports=ha(fs);var F=require("obsidian");var pt=require("obsidian");var fe=require("obsidian");async function It(e,t,n,a){let r=await e.vault.read(t),i=new RegExp(String.raw`^#{1,6}.*?\b${n.replace(/\s+/g,"\\s+")}\b.*$`,"im").exec(r);if(!i)return;let c=i.index+i[0].length,o=r.slice(c).split(/\r?\n/),l=p=>/^#{1,6}\s/.test(p);for(let p=0;p<o.length;p++){let h=o[p];if(l(h)){o.splice(p,0,a);let f=r.slice(0,c)+o.join(`
`);f!==r&&await e.vault.modify(t,f);return}if(h.trim()!==""){if(h!==a){o[p]=a;let f=r.slice(0,c)+o.join(`
`);f!==r&&await e.vault.modify(t,f)}return}}if(o.length===0){let p=r.slice(0,c)+a;p!==r&&await e.vault.modify(t,p);return}o[0]=a;let u=r.slice(0,c)+o.join(`
`);u!==r&&await e.vault.modify(t,u)}function pa(e,t,n){let a=e.metadataCache.getFileCache(t);if(!a?.headings)return null;let r=l=>l.trim().toLowerCase(),s=r(n),i=a.headings.sort((l,u)=>l.position.start.line-u.position.start.line),c=i.findIndex(l=>r(l.heading)===s);if(c===-1)return null;let d=i[c].position.end.line+1,o=c<i.length-1?i[c+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:d,endLine:o}}async function Kt(e,t,n,a){let r=pa(e,t,n);if(!r)return!1;let i=(await e.vault.read(t)).split(`
`),c=Math.min(r.startLine,i.length-1),d=Math.min(r.endLine,i.length-1),o=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let l=c;l<=d;l++){let u=i[l].match(o);if(!u)continue;let h=`- [${u[1]==="x"||u[1]==="X"?"x":" "}] ${a}`;return i[l]!==h&&(i[l]=h,await e.vault.modify(t,i.join(`
`))),!0}return!1}function O(e=new Date){let t=e.getTimezoneOffset();return new Date(e.getTime()-t*6e4).toISOString().slice(0,10)}function ma(e=new Date){return e.toLocaleDateString(void 0,{weekday:"long"})}function ga(e=new Date){return e.toLocaleDateString(void 0,{month:"short"})}function fa(e=new Date){return e.getFullYear()}function ya(e=new Date){return Math.floor(e.getMonth()/3)+1}function wa(e=new Date){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let n=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((+t-+n)/864e5+1)/7)}function dt(e,t,n=new Date){let a=O(n),r=e;return r=r.replace(/{{\s*title\s*}}/gi,t),r=r.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,s=>a),r=r.replace(/{{\s*dateLong\s*}}/gi,n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),r=r.replace(/{{\s*weekday\s*}}/gi,ma(n)),r=r.replace(/{{\s*monthShort\s*}}/gi,ga(n)),r=r.replace(/{{\s*year\s*}}/gi,String(fa(n))),r=r.replace(/{{\s*isoWeek\s*}}/gi,String(wa(n))),r=r.replace(/{{\s*quarter\s*}}/gi,String(ya(n))),r}function ba(e,t){let n=(0,fe.normalizePath)(t);return e.vault.getAbstractFileByPath(n)??null}async function Ce(e,t){let n=(0,fe.normalizePath)(t).split("/"),a="";for(let r of n)a=a?`${a}/${r}`:r,e.vault.getAbstractFileByPath(a)||await e.vault.createFolder(a)}async function N(e,t,n){let a=(0,fe.normalizePath)(t);if(!ba(e,a)){let s=a.split("/").slice(0,-1).join("/");s&&await Ce(e,s),await e.vault.create(a,n)}}var De=require("obsidian");var R="03 SaveBox/Templates",ut={area:`${R}/Area Template.md`,wish:`${R}/Wish Template.md`,goal:`${R}/Goal Template.md`,project:`${R}/Project Template.md`,task:`${R}/Task Template.md`,habit:`${R}/Habit Template.md`,note:`${R}/Note Template.md`,daily:`${R}/Daily Template.md`,weekly:`${R}/Weekly Template.md`,monthly:`${R}/Monthly Template.md`,quarterly:`${R}/Quarterly Template.md`,yearly:`${R}/Yearly Template.md`},ht={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function ye(e,t,n,a=new Date){let r=(0,De.normalizePath)(ut[t]),s=e.vault.getAbstractFileByPath(r);if(s instanceof De.TFile){console.log(`[MMOS] Using VAULT template for ${t}: ${r}`);let i=await e.vault.read(s);return dt(i,n,a)}return console.log(`[MMOS] Using FALLBACK template for ${t}`),dt(ht[t],n,a)}var va="03 SaveBox/Templates";async function Ta(e,t){let n=e.vault.getMarkdownFiles().filter(s=>s.path.startsWith(va+"/")),a=s=>s.toLowerCase().trim().replace(/^[^a-z0-9]+/,""),r=n.find(s=>new RegExp(`^${t}(\\s|:|-|_)`,"i").test(a(s.basename)));return r?e.vault.read(r):""}async function Gt(e,t){let{kind:n,title:a}=t,r=t.path??xa(n,a),s=r.substring(0,r.lastIndexOf("/"));s&&await Ce(e,s);let i;if(n==="note"){if(i=await Ta(e,"note"),!i){let d=r.split("/").pop().replace(/\.md$/i,"");i=`---
created: ${O(new Date)}
status: Active
---
# ${d}
`}}else i=await ye(e,n,a,new Date);let c=await e.vault.create(r,i);return await e.fileManager.processFrontMatter(c,d=>{d.created??(d.created=O(new Date)),n==="task"?(d.status??(d.status="Active"),d.impact??(d.impact="Med"),d.slot??(d.slot="Morning"),d.done??(d.done=!1),d.priority??(d.priority="Medium")):n==="goal"||n==="project"||n==="habit"?(d.status??(d.status="Active"),d.done??(d.done=!1),d.priority??(d.priority="Medium")):n==="area"&&(d.status??(d.status="Active"))}),c}async function Qt(e){let t=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let n of t)await Ce(e,n);await N(e,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await N(e,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await N(e,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await N(e,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await N(e,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[n,a]of Object.entries(ut))await N(e,a,ht[n]);await N(e,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${O(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await N(e,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${O(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await N(e,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${O(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await N(e,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${O(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await N(e,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new pt.Notice("\u2705 MindMap OS: starter structure updated.")}function xa(e,t){let n=ka(t);switch(e){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${qt("note")}${n}.md`;default:return`03 SaveBox/Active/${qt(e)}${n}.md`}}function qt(e){switch(e){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";case"note":return"\u270F\uFE0FNote - ";default:return""}}function ka(e){return e.replace(/[\\/:*?"<>|]/g,"").trim()}var ce=require("obsidian");var Fa=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],mt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - ",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function Aa(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ma(e,t){let a=new RegExp(`^#{1,6}\\s+${Aa(t)}\\s*$`,"gim").exec(e);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,i=new RegExp(`^#{1,${s}}\\s+`,"gim");i.lastIndex=r;let c=i.exec(e);return{start:r,end:c?c.index:e.length}}function $a(e,t){let n=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,a=e.slice(t.start,t.end);n.lastIndex=0;let r=n.exec(a);if(!r)return null;let s=t.start+r.index,i=s+r[0].length,c=/\[(x|X)\]/.test(r[0]);return{absStart:s,absEnd:i,line:r[0],checked:c}}async function Ea(e,t){for(let n=0;n<25;n++){if(e.metadataCache.getFileCache(t)?.headings?.length)return;await new Promise(r=>setTimeout(r,40))}}async function Sa(e,t,n,a){await Ea(e,t);let r=await e.vault.read(t),s=Ma(r,n);if(!s)return!1;let i=$a(r,s);if(!i)return!1;let d=`- [${/\[(x|X)\]/.test(i.line)?"x":" "}] ${a}`;if(i.line.trimEnd()===d)return!0;let o=r.slice(0,i.absStart)+d+r.slice(i.absEnd);return o!==r&&await e.vault.modify(t,o),!0}function La(e){return e==="task"?"My Task":e==="project"?"My Project":"My Goal"}function Pa(e){return e instanceof ce.TFile&&e.extension.toLowerCase()==="md"}function Ca(e){let t=e.match(/^(\w+)\s*(?:[-–]\s*|\s+)(.+)$/i);if(!t)return null;let n=t[1].toLowerCase();if(!Fa.includes(n))return null;let a=t[2].trim();return{kind:n,title:a}}function Da(e,t){let n=Ha(t);switch(e){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${mt.note}${n}.md`;default:return`03 SaveBox/Active/${mt[e]}${n}.md`}}function Ha(e){return e.replace(/[\\/:*?"<>|]/g,"").trim()}async function Na(e,t,n){await e.fileManager.processFrontMatter(t,a=>{a.created??(a.created=O(new Date)),n==="task"?(a.status??(a.status="Active"),a.impact??(a.impact="Medium"),a.slot??(a.slot="Morning"),a.done??(a.done=!1),a.duration_hours??(a.duration_hours=void 0),a.tags??(a.tags=[])):n==="goal"||n==="project"||n==="habit"?(a.status??(a.status="Active"),a.done??(a.done=!1)):n==="area"&&(a.status??(a.status="Active"))})}function Ut(e){e.vault.on("create",async t=>{try{if(!Pa(t)||(await e.vault.read(t)).trim().length>0)return;let a=t.basename,r=Ca(a);if(!r)return;let{kind:s,title:i}=r,c;s==="note"?(c=await ye(e,"note",i,new Date),c||(c=`---
created: ${O(new Date)}
status: Active
---
# \u270F\uFE0FNote - ${i}
`)):c=await ye(e,s,i,new Date),await e.vault.modify(t,c),await Na(e,t,s);let d=(0,ce.normalizePath)(Da(s,i));if(d!==t.path&&await e.fileManager.renameFile(t,d),s==="area"||s==="wish"){let o=e.vault.getAbstractFileByPath(d),l=o instanceof ce.TFile?o:t,u=l.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),p=`${mt[s]}${u}`,h=s==="area"?"My Area":"My Wish";console.log("[MMOS][wikilinks] finalize",{kind:s,formatted:p,path:l.path}),await It(e,l,h,p)}if(s==="task"||s==="project"||s==="goal"){let o=e.vault.getAbstractFileByPath(d),l=o instanceof ce.TFile?o:t,u=La(s),p=l.basename;await Sa(e,l,u,p)}console.log(`[MMOS] wikilink routed \u2192 ${s} | ${i}`)}catch(n){console.error("[MMOS] wikilink routing error",n)}}),console.log("MMOS wikilink watcher: ON")}var Xt=require("obsidian");function Ra(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Oa(e,t){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,e(...a)},t)}}function Vt(e,t){let a=new RegExp(`^#{1,6}\\s+${Ra(t)}\\s*$`,"gim").exec(e);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,i=new RegExp(`^#{1,${s}}\\s+`,"gim");i.lastIndex=r;let c=i.exec(e);return{start:r,end:c?c.index:e.length}}var zt=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function Jt(e,t){let n=e.slice(t.start,t.end);zt.lastIndex=0;let a=zt.exec(n);if(!a)return null;let r=t.start+a.index,s=r+a[0].length,i=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:s,line:a[0],checked:i}}function Zt(e,t){return e.replace(/\[(?: |x|X)\]/,t?"[x]":"[ ]")}var Ya=2e3;function _a(e){return/(^|\/)(templates?|Templates?)(\/|$)/.test(e)}function ja(e){return e?.template===!0||e?.is_template===!0||e?.type==="template"}function Wa(e){return/<%[\s\S]*?%>/.test(e)}function Ba(e){let t=e?.stat?.ctime??0;return Date.now()-t<Ya}function en(e,t){let n=new Set,a=e.vault.on("modify",o=>{n.has(o.path)&&e?.notifier?.hideAll&&e.notifier.hideAll()}),r=o=>{let l=e.workspace.getActiveViewOfType(Xt.MarkdownView),p=!!l&&l.file?.path===o.path&&l?.getMode()!=="preview";return{editor:l?.editor,inEdit:p}},s=async(o,l)=>{n.add(o.path);try{await e.fileManager.processFrontMatter(o,u=>{for(let p of Object.keys(l))u[p]=l[p]})}finally{n.delete(o.path)}},i=async(o,l,u,p,h)=>{let{editor:f,inEdit:g}=r(o);n.add(o.path);try{if(g&&f){let m=f.offsetToPos(u),w=f.offsetToPos(p);await new Promise(requestAnimationFrame),f.replaceRange(h,m,w)}else{let m=l.slice(0,u)+h+l.slice(p);m!==l&&await e.vault.modify(o,m)}}finally{n.delete(o.path)}},d=Oa(async()=>{let o=e.workspace.getActiveFile();if(!o||t?.(o)||_a(o.path))return;let u=(e.metadataCache.getFileCache(o)??{}).frontmatter??{};if(ja(u))return;let{editor:p,inEdit:h}=r(o),f=h&&p?p.getValue():await e.vault.read(o);if(!f||Wa(f)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(f)||Ba(o)||n.has(o.path))return;let m=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let w of m){let v=Vt(f,w.heading);if(!v)continue;let y=Jt(f,v);if(!y)continue;let b=typeof u.done=="boolean"?u.done:null,E=typeof u[w.flag]=="boolean"?u[w.flag]:null,k=y.checked;if(E===null){await s(o,{done:!!k,[w.flag]:!!k});return}let H=b!==null&&b!==E;if(k!==E){await s(o,{done:!!k,[w.flag]:!!k});return}if(H){let Z=Zt(y.line,!!b);await i(o,f,y.absStart,y.absEnd,Z),await s(o,{[w.flag]:!!b});return}return}},150);e.workspace.on("file-open",()=>d()),e.workspace.on("active-leaf-change",()=>d()),e.workspace.on("layout-change",()=>d()),e.workspace.on("editor-change",()=>d()),e.metadataCache.on("changed",()=>d()),e.metadataCache.on("resolved",()=>d()),e.vault.on("modify",()=>d()),e.vault.on("rename",()=>d()),e.vault.on("create",()=>d())}async function tn(e,t){let a=(e.metadataCache.getFileCache(t)??{}).frontmatter??{},r=!(typeof a.done=="boolean"&&a.done);await e.fileManager.processFrontMatter(t,c=>{c.done=r});let s=await e.vault.read(t),i=["My Task","My Project","My Goal"];for(let c of i){let d=Vt(s,c);if(!d)continue;let o=Jt(s,d);if(!o)continue;let l=Zt(o.line,r),u=s.slice(0,o.absStart)+l+s.slice(o.absEnd);u!==s&&await e.vault.modify(t,u);break}}var an=require("obsidian");function Ia(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ka(e,t){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,e(...a)},t)}}function qa(e){return/(^|\/)(templates?|Templates?)(\/|$)/.test(e)}function Ga(e){return/<%[\s\S]*?%>/.test(e)}function Qa(e,t=1500){let n=e?.stat?.ctime??0;return Date.now()-n<t}function Ua(e,t,n,a){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(e)||/^habit template(\.md)?$/i.test(t)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(t)||a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(n))}function za(e,t){let n=t.map(Ia).join("|"),r=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${n})\\s*$`,"gim").exec(e);if(!r)return null;let s=r.index+r[0].length,i=(r[0].match(/^#+/)||["#"])[0].length,c=new RegExp(`^#{1,${i}}\\s+`,"gim");c.lastIndex=s;let d=c.exec(e);return{start:s,end:d?d.index:e.length}}var nn=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function Xa(e,t){let n=e.slice(t.start,t.end);nn.lastIndex=0;let a=nn.exec(n);if(!a)return null;let r=t.start+a.index,s=r+a[0].length,i=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:s,line:a[0],checked:i}}function Va(e,t){return e.replace(/\[(?: |x|X)\]/,t?"[x]":"[ ]")}function rn(e,t){let n=new Set,a=d=>{let o=e.workspace.getActiveViewOfType(an.MarkdownView),u=!!o&&o.file?.path===d.path&&o?.getMode()!=="preview";return{editor:o?.editor,inEdit:u}},r=async(d,o)=>{n.add(d.path);try{await e.fileManager.processFrontMatter(d,l=>{for(let u of Object.keys(o))l[u]=o[u]})}finally{n.delete(d.path)}},s=async(d,o,l,u,p)=>{let{editor:h,inEdit:f}=a(d);n.add(d.path);try{if(f&&h){let g=h.offsetToPos(l),m=h.offsetToPos(u);await new Promise(requestAnimationFrame),h.replaceRange(p,g,m)}else{let g=o.slice(0,l)+p+o.slice(u);g!==o&&await e.vault.modify(d,g)}}finally{n.delete(d.path)}},c=Ka(async()=>{let d=e.workspace.getActiveFile();if(!d||t?.(d)||qa(d.path)||Qa(d)||n.has(d.path))return;let l=(e.metadataCache.getFileCache(d)??{}).frontmatter??{},{editor:u,inEdit:p}=a(d),h=p&&u?u.getValue():await e.vault.read(d);if(!h||Ga(h)||!Ua(d.path,d.basename,h,l))return;let f=za(h,["\u270D\uFE0F Log","Log"]);if(!f)return;let g=Xa(h,f),m=typeof l.done=="boolean"?l.done:null,w=typeof l._habit_sync_state=="boolean"?l._habit_sync_state:null;if(!g&&m===null)return;if(w===null){g?await r(d,{done:!!g.checked,_habit_sync_state:!!g.checked}):m!==null&&await r(d,{_habit_sync_state:!!m});return}let v=g?g.checked:null,y=m!==null&&m!==w;if(v!==null&&v!==w){await r(d,{done:!!v,_habit_sync_state:!!v});return}if(y&&g){let E=Va(g.line,!!m);await s(d,h,g.absStart,g.absEnd,E),await r(d,{_habit_sync_state:!!m});return}},150);e.workspace.on("file-open",()=>c()),e.workspace.on("active-leaf-change",()=>c()),e.workspace.on("layout-change",()=>c()),e.workspace.on("editor-change",()=>c()),e.metadataCache.on("changed",()=>c()),e.metadataCache.on("resolved",()=>c()),e.vault.on("modify",()=>c()),e.vault.on("rename",()=>c()),e.vault.on("create",()=>c())}var j=require("obsidian");var Ne={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - "},Ja="03 SaveBox/Templates";function un(e){return e.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim()}function sn(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}async function hn(e,t,n,a){let s=(await e.vault.read(t)).split(/\r?\n/),i=sn(n),c=-1;for(let f=0;f<s.length;f++)if(/^#{1,6}\s/.test(s[f])&&sn(s[f]).includes(i)){c=f;break}if(console.log("[MMOS][writer] target header:",n,"| found index:",c),c===-1){console.warn("[MMOS][writer] header not found in",t.path);return}let d=f=>/^\s*$/.test(f),o=f=>/^\s*(?:-{3,}|_{3,}|\*{3,})\s*$/.test(f),l=c+1;for(;l<s.length&&(d(s[l])||o(s[l]));)l++;let u=l>=s.length||/^#{1,6}\s/.test(s[l]);console.log("[MMOS][writer] insert/replace at line:",l,"| nextIsHeader:",u,"| writing:",a),u?(s.splice(l,0,a),await e.vault.modify(t,s.join(`
`))):s[l]!==a?(console.log("[MMOS][writer] replacing existing line:",JSON.stringify(s[l])),s[l]=a,await e.vault.modify(t,s.join(`
`))):console.log("[MMOS][writer] already correct, skipping write");let h=(await e.vault.read(t)).split(/\r?\n/)[l]??"";console.log("[MMOS][writer] post-write line:",JSON.stringify(h))}async function on(e,t){for(let r=0;r<25&&!e.metadataCache.getFileCache(t)?.headings?.length;r++)await new Promise(i=>setTimeout(i,40));let n=un(t.basename),a=`${Ne.area}${n}`;console.log("[MMOS][finalizeArea]",{path:t.path,basename:t.basename,core:n,formatted:a}),await hn(e,t,"My Area",a)}async function cn(e,t){for(let r=0;r<25&&!e.metadataCache.getFileCache(t)?.headings?.length;r++)await new Promise(i=>setTimeout(i,40));let n=un(t.basename),a=`${Ne.wish}${n}`;console.log("[MMOS][finalizeWish]",{path:t.path,basename:t.basename,core:n,formatted:a}),await hn(e,t,"My Wish",a)}function He(e){return e.replace(/[\\/:*?"<>|]/g,"").trim()}function pn(e){return e.trim().split(/\s+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function Za(e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let n=new Date(Date.UTC(t.getUTCFullYear(),0,1)),a=Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7);return{isoYear:t.getUTCFullYear(),week:a}}async function mn(e,t){let n=(0,j.normalizePath)(t).split("/"),a="";for(let r of n){a=a?`${a}/${r}`:r;try{await e.vault.createFolder(a)}catch{}}}function le(e,t){let n=e.vault.getAbstractFileByPath((0,j.normalizePath)(t));return n instanceof j.TFile?n:null}function er(e,t){let n=new Date;switch(e){case"daily":return`02 Execution/1 Daily/${`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}.md`}`;case"weekly":{let{isoYear:a,week:r}=Za(n);return`02 Execution/2 Weekly/${`${a}-W${String(r).padStart(2,"0")}.md`}`}case"monthly":return`02 Execution/3 Monthly/${`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}.md`}`;case"quarterly":{let a=Math.floor(n.getMonth()/3)+1;return`02 Execution/4 Quarterly/${`${n.getFullYear()}-Q${a}.md`}`}case"yearly":return`02 Execution/5 Yearly/${`${n.getFullYear()}.md`}`;case"note":return`03 SaveBox/Active/\u270F\uFE0FNote - ${He(t)}.md`;case"area":case"wish":case"goal":case"project":case"task":case"habit":return`03 SaveBox/Active/${Ne[e]}${He(t)}.md`}return`03 SaveBox/Active/${He(t)}.md`}async function ln(e,t){let n=`${t.charAt(0).toUpperCase()}${t.slice(1)} Template.md`,a=(0,j.normalizePath)(`${Ja}/${n}`),r=e.vault.getAbstractFileByPath(a);return r instanceof j.TFile?e.vault.read(r):""}async function tr(e,t,n){let a=(0,j.normalizePath)(t),r=a.replace(/\/[^/]+$/,""),s=a.split("/").pop();await mn(e,r);let i=le(e,a);if(i)return i;let c=e.vault.getFiles().find(o=>o.name===s);if(c&&c.path!==a){await e.fileManager.renameFile(c,a);let o=le(e,a);if(o){if(!(await e.vault.read(o)).trim()){let u=await ln(e,n);u&&await e.vault.modify(o,u)}return o}}let d=await ln(e,n);return await e.vault.create(a,d??"")}async function dn(e,t,n){if(!["task","project","goal","area","wish","habit","note"].includes(n))return t;let a=Ne[n],r=t.path.startsWith("03 SaveBox/Active/"),s=t.basename.startsWith(a);if(!r||s)return t;let i=t.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),c=pn(i||"Untitled"),d=(0,j.normalizePath)(`03 SaveBox/Active/${a}${He(c)}.md`);if(d===t.path)return t;let o=le(e,d);return o||(await e.fileManager.renameFile(t,d),le(e,d)??t)}function nr(e){return e==="task"?"My Task":e==="project"?"My Project":"My Goal"}async function ar(e,t,n){for(let s=0;s<25&&!e.metadataCache.getFileCache(t)?.headings?.length;s++)await new Promise(c=>setTimeout(c,40));let a=t.basename,r=nr(n);await Kt(e,t,r,a)}async function Q(e,t,n){let a=(0,j.normalizePath)(er(t,n));if(t==="daily"||t==="weekly"||t==="monthly"||t==="quarterly"||t==="yearly"){console.log("[MMOS][routeKind] periodic:",{kind:t,targetPath:a});let u=await tr(e,a,t);return await e.workspace.getLeaf(!1).openFile(u),u}let s=["task","project","goal","area","wish","habit","note"].includes(t)?pn(n):n,i=le(e,a);if(i){console.log("[MMOS][routeKind] existing at target:",{kind:t,targetPath:a});let u=await dn(e,i,t);return t==="area"&&await on(e,u),t==="wish"&&await cn(e,u),await e.workspace.getLeaf(!1).openFile(u),u}console.log("[MMOS][routeKind] createTypedNote:",{kind:t,effectiveTitle:s,targetPath:a});let c=await Gt(e,{kind:t,title:s}),d=a.replace(/\/[^/]+$/,"");await mn(e,d),c.path!==a&&await e.fileManager.renameFile(c,a);let o=le(e,a)??c;console.log("[MMOS][routeKind] moved/created final:",{kind:t,finalPath:o.path}),(t==="task"||t==="project"||t==="goal")&&await ar(e,o,t),t==="area"&&await on(e,o),t==="wish"&&await cn(e,o);let l=await dn(e,o,t);return console.log("[MMOS][routeKind] ensurePrefixedName ->",{from:o.path,to:l.path,kind:t}),await e.workspace.getLeaf(!1).openFile(l),l}var gn=(e,t)=>Q(e,"task",t),fn=(e,t)=>Q(e,"project",t),yn=(e,t)=>Q(e,"goal",t);var we=e=>Q(e,"daily",""),gt=e=>Q(e,"weekly",""),ft=e=>Q(e,"monthly",""),yt=e=>Q(e,"quarterly",""),wt=e=>Q(e,"yearly","");var rr=window.moment,bt=new Set,sr={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},vt={};for(let[e,t]of Object.entries(sr))for(let n of t)vt[n.toLowerCase()]=e;var ir=Object.keys(vt).sort((e,t)=>t.length-e.length).join("|"),or=new RegExp(`\\b(?:${ir})\\b`,"gi");function cr(e){let n=/^#{1,6}\s*.*\blog\b.*$/mi.exec(e);if(!n)return null;let a=n[0],r=n.index+a.length;return e[r]==="\r"&&e[r+1]===`
`?r+2:e[r]===`
`?r+1:r}function lr(e,t){let n=cr(e);if(n===null)return e.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${t}
`;let a=e.slice(0,n),s=e.slice(n).replace(/^\r?\n{0,}/,""),i=a.endsWith(`

`)?"":a.endsWith(`
`)?`
`:`

`;return a+i+t+`
`+s}function wn(e,t){let n=e.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(n)||/^habit template(\.md)?$/i.test(e.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e.basename))return!0;if(t){let a=t.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(a[1]))return!0}return!1}function dr(e){let t=e.match(or);return t?[...new Set(t.map(n=>vt[n.toLowerCase()]).filter(Boolean))]:[]}function ur(e){let t=dr(e);if(t.length===0)return!0;let n=rr().format("dddd");return t.includes(n)}function hr(e){let t=e.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return t?t[1].trim():e.trim()}async function bn(e,t,n){let a=window.moment().format("YYYY-MM-DD"),r=`^${a}`;if(n.includes(r))return!1;let i=`- [ ] \u{1F504}Habit - ${hr(t.basename)} ${a} ${r}`,c=lr(n,i);return await e.vault.modify(t,c),!0}async function be(e,t){let n=t.path;if(!bt.has(n)){bt.add(n);try{if(!wn(t))return;if(!ur(t.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:t.path});return}let a=await e.vault.read(t);if(!wn(t,a))return;await bn(e,t,a)}finally{setTimeout(()=>bt.delete(n),120)}}}async function vn(e,t){let n=await e.vault.read(t);await bn(e,t,n)}var pr=window.moment,mr="03 SaveBox/Active",gr=/(^| )Habit -|^🔁Habit -/i,fr={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},Tt={};for(let[e,t]of Object.entries(fr))for(let n of t)Tt[n.toLowerCase()]=e;var yr=Object.keys(Tt).sort((e,t)=>t.length-e.length).join("|"),wr=new RegExp(`\\b(?:${yr})\\b`,"gi");function br(e){let t=e.match(wr);return t?[...new Set(t.map(n=>Tt[n.toLowerCase()]).filter(Boolean))]:[]}function vr(e){let t=pr().format("dddd"),n=br(e);return{ok:n.length>0&&n.includes(t),todayName:t}}async function Tn(e,t=mr){let n=e.vault.getMarkdownFiles().filter(a=>a.path.startsWith(t+"/")).filter(a=>gr.test(a.basename));for(let a of n){let{ok:r}=vr(a.basename);if(r)try{await be(e,a)}catch{}}}var Re=require("obsidian"),W=window.moment,Tr=e=>W(e).format("YYYY-MM-DD");function xn(e){let t=W(e+"-01","YYYY-MM-DD").startOf("month"),n=t.clone().endOf("month");return{start:t,end:n}}function xr(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function kr(e,t){let a=new RegExp(`^#{1,6}\\s+${xr(t)}\\s*$`,"gim").exec(e);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,i=new RegExp(`^#{1,${s}}\\s+`,"gim");i.lastIndex=r;let c=i.exec(e);return{start:r,end:c?c.index:e.length}}function Fr(e){e=String(e).trim();let t=e.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/)||e.match(/due\((\d{4}-\d{2}-\d{2})\)/i)||e.match(/due::\s*(\d{4}-\d{2}-\d{2})/i)||e.match(/📅\s*(\d{4}-\d{2}-\d{2})/);return t?t[1]:null}async function Ar(e,t){let n=e.vault.getAbstractFileByPath(t.sourcePath);return n instanceof Re.TFile?e.vault.read(n):""}function Mr(e){let t=kr(e,"\u270D\uFE0F Log")||{start:0,end:e.length},n=e.slice(t.start,t.end),a=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,r=[],s;for(;s=a.exec(n);){let i=s[1].toLowerCase()==="x",c=s[2],d=Fr(c);d&&r.push({date:d,done:i})}return r}function $r(e){let t=new Map;for(let n of e)t.set(n.date,t.get(n.date)||!1||n.done);return t}function Er(e){let t={};for(let[a,r]of e){let s=W(a).format("YYYY-MM");(t[s]||(t[s]=[])).push({date:a,done:r})}return Object.keys(t).sort().slice(-3).reverse().map(a=>{let r=t[a],s=r.length?Math.round(r.filter(i=>i.done).length/r.length*100):0;return{label:W(a,"YYYY-MM").format("MMM"),pct:s}})}function Sr(e,t=90){let n=0,a=W();for(let r=0;r<t;r++){let s=Tr(a);if(e.get(s))n++;else break;a.subtract(1,"day")}return n}function Lr(e,t,n){let a=e.createDiv({cls:"habit-monthly-summary"});a.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${n} day${n===1?"":"s"}</strong>`;let r=a.createDiv({cls:"month-bars"});t.forEach(({label:s,pct:i},c)=>{let d=r.createDiv({cls:"month-row"});d.innerHTML=`
      <div class="month-label">${s}</div>
      <div class="bar-track">
        <div class="bar-fill ${c===0?"bar-orange":"bar-purple"}" style="width:${i}%;"></div>
      </div>
      <div class="pct-text">${i}<span class="pct-symbol">%</span></div>
    `})}function kn(e,t,n,a){let r=f=>W(f).format("YYYY-MM-DD"),s=n.clone().startOf("isoWeek"),i=a.clone().endOf("isoWeek"),c=[...t.keys()].sort(),d=null;for(let f=c.length-1;f>=0;f--){let g=c[f];if(!W(g).isAfter(a)){if(W(g).isBefore(n))break;if(t.get(g)){d=g;break}}}let o=e.createDiv({cls:"weekly-streak-wrap"}),l=o.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(f=>l.createDiv({cls:"head",text:f}));let u=o.createDiv({cls:"weekly-streak-grid"}),p=[],h=i.clone().endOf("isoWeek");for(;h.isSameOrAfter(s);){let f=h.clone().startOf("isoWeek");p.push({weekStart:f.clone(),weekEnd:h.clone()}),h.subtract(1,"week")}for(let f of p){let g=f.weekStart.clone();for(let m=0;m<7;m++){let w=r(g),v=g.isSameOrAfter(n)&&g.isSameOrBefore(a),y=v?!!t.get(w):!1,b=u.createDiv({cls:"weekly-streak-cell"});v||b.classList.add("pad"),y&&v&&(b.classList.add("hit"),w===d&&b.classList.add("latest-hit")),b.createDiv({cls:"num",text:v?g.format("D"):""}),b.createDiv({cls:"mmm",text:v?g.format("MMM"):""}),b.setAttr("title",v?`${g.format("ddd, DD MMM YYYY")} ${y?"\u2705 Done":"\u274C Missed"}`:""),g.add(1,"day")}}}function Pr(e,t,n){let a=e.createDiv({cls:"month-switch"});return t.forEach((r,s)=>{let i=a.createEl("button",{text:r.label,cls:"month-btn"});s===0&&i.classList.add("active"),i.addEventListener("click",()=>{a.querySelectorAll(".month-btn").forEach(c=>c.classList.remove("active")),i.classList.add("active"),n(r.key)})}),a}function Cr(e){let t=document.createElement("style");t.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width: 4ch; text-align: right; font-weight: 600; font-size: .95em; white-space: nowrap; }
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn { font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer; background: var(--background-modifier-border); border: none; }
.month-btn.active { background: var(--interactive-accent); color: white; }
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden; background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border); display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,e.appendChild(t)}async function Fn(e,t,n){t.replaceChildren();let a=await Ar(e,n),r=Mr(a),s=$r(r),i=Er(s),c=Sr(s);Cr(t),Lr(t,i,c);let o=Array.from(new Set([...s.keys()].map(u=>W(u).format("YYYY-MM")))).sort().slice(-3).reverse().map(u=>({key:u,label:W(u,"YYYY-MM").format("MMM")})),l=o[0]?.key;if(Pr(t,o,u=>{l=u,t.querySelectorAll(".weekly-streak-wrap").forEach(f=>f.remove());let{start:p,end:h}=xn(u);kn(t,s,p,h)}),l){let{start:u,end:p}=xn(l);kn(t,s,u,p)}}function Dr(e,t,n){let a=(()=>{let s=null;return()=>{s&&window.clearTimeout(s),s=window.setTimeout(async()=>{s=null,await Fn(e.app,t,n)},120)}})();class r extends Re.MarkdownRenderChild{onload(){this.registerEvent(e.app.vault.on("modify",i=>{i?.path===n.sourcePath&&a()})),this.registerEvent(e.app.metadataCache.on("changed",i=>{i?.path===n.sourcePath&&a()})),this.registerEvent(e.app.metadataCache.on("resolved",()=>a())),this.registerEvent(e.app.workspace.on("editor-change",()=>a()))}}n.addChild(new r(t))}function An(e){let t=async(n,a,r)=>{await Fn(e.app,a,r),Dr(e,a,r)};e.registerMarkdownCodeBlockProcessor("wishmap-habit-monthly",t),e.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",t)}var Oe=require("obsidian");var xt=class extends Oe.SuggestModal{constructor(n){super(n.app);this.plugin=n;this.setPlaceholder("Search or open a periodic note\u2026")}getSuggestions(n){let a=[{label:"Open Today (Daily)",action:async()=>{await we(this.app)}},{label:"Open This Week (Weekly)",action:async()=>{await gt(this.app)}},{label:"Open This Month (Monthly)",action:async()=>{await ft(this.app)}},{label:"Open This Quarter",action:async()=>{await yt(this.app)}},{label:"Open This Year",action:async()=>{await wt(this.app)}}],r=n.trim().toLowerCase();return r?a.filter(s=>s.label.toLowerCase().includes(r)):a}renderSuggestion(n,a){a.createDiv({text:n.label})}async onChooseSuggestion(n){await n.action()}};function Mn(e){e.addRibbonIcon("calendar-clock","WishMap: Periodic Notes",n=>{let a=new Oe.Menu;a.addItem(r=>r.setTitle("Open Today (Daily)").onClick(async()=>{await we(e.app)})),a.addItem(r=>r.setTitle("Open This Week (Weekly)").onClick(async()=>{await gt(e.app)})),a.addItem(r=>r.setTitle("Open This Month (Monthly)").onClick(async()=>{await ft(e.app)})),a.addItem(r=>r.setTitle("Open This Quarter").onClick(async()=>{await yt(e.app)})),a.addItem(r=>r.setTitle("Open This Year").onClick(async()=>{await wt(e.app)})),a.showAtMouseEvent(n)}).setAttr("aria-label","WishMap: Periodic Notes"),e.addCommand({id:"wishmap-open-periodic-notes",name:"Open Periodic Note\u2026",callback:()=>new xt(e).open()})}var At=require("obsidian");var de=require("obsidian");async function $n(e,t,n){let a=e.vault.getAbstractFileByPath(t);if(!(a instanceof de.TFile))return;let r=await e.vault.read(a),s=r.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/),i=r,c={};if(s){try{c=(0,de.parseYaml)(s[1])??{}}catch{c={}}i=r.slice(s[0].length)}for(let[l,u]of Object.entries(n))u!==void 0&&(c[l]=u);let o=`---
${(0,de.stringifyYaml)(c).trimEnd()}
---
${i}`;o!==r&&await e.vault.modify(a,o)}function Mt(e){return e.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}function U(e,t){let n=Mt(t.basename);return/^project(\s|:|-|_)/.test(n)}function ne(e,t){let n=Mt(t.basename);return/^task(\s|:|-|_)/.test(n)}function te(e,t){let n=Mt(t.basename);return/^goal(\s|:|-|_)/.test(n)}function En(e,t){let a=e.metadataCache.getFileCache(t)?.links??[],r=new Set,s=[];for(let i of a){let c=e.metadataCache.getFirstLinkpathDest(i.link,t.path);c instanceof At.TFile&&c.extension==="md"&&(r.has(c.path)||(r.add(c.path),s.push(c)))}return s}function Sn(e,t){return En(e,t).filter(n=>ne(e,n))}function Hr(e,t){return En(e,t).filter(n=>U(e,n))}function Ft(e,t){let n=e.metadataCache.getFileCache(t)?.frontmatter??{},a=["duration_hours","durationHours","duration","duration hours"];for(let r of a)if(n[r]!==void 0){let s=(typeof n[r]=="string",Number(n[r]));if(Number.isFinite(s))return s}return 0}async function Ln(e,t,n,a){let r=e.metadataCache.getFileCache(t)?.frontmatter?.[n],s=Number(r),i=Math.round(a*10)/10;Number.isFinite(s)&&Math.abs(s-i)<.05||await $n(e,t.path,{[n]:i})}async function ve(e,t){if(!U(e,t))return;let n=Sn(e,t),a=0;for(let r of n)a+=Ft(e,r);await Ln(e,t,"duration_hours",a)}async function $t(e,t){if(!te(e,t))return;let n=Hr(e,t),a=Sn(e,t),r=0;for(let s of n)r+=Ft(e,s);for(let s of a)r+=Ft(e,s);await Ln(e,t,"duration_hours",r)}function kt(e,t,n){let a=[],r=e.metadataCache.resolvedLinks,s=new Set;for(let[i,c]of Object.entries(r)){if(!c[t.path])continue;let d=e.vault.getAbstractFileByPath(i);d instanceof At.TFile&&d.extension==="md"&&n(e,d)&&(s.has(d.path)||(s.add(d.path),a.push(d)))}return a}function K(e,t){if(U(e,t))return[t,...kt(e,t,te)];if(ne(e,t)){let n=kt(e,t,U),a=kt(e,t,te);return[...n,...a]}return te(e,t)?[t]:[]}var Pn=require("obsidian");function Et(e){let{app:t}=e;console.log("[WishMap] rollup auto: wiring listeners");let n=new Map;function a(s){let i=s.path,c=n.get(i);c&&window.clearTimeout(c);let d=window.setTimeout(async()=>{if(n.delete(i),U(t,s)){await ve(t,s);for(let o of K(t,s).filter(l=>te(t,l)))await $t(t,o)}else te(t,s)&&await $t(t,s)},300);n.set(i,d)}function r(s){if(s instanceof Pn.TFile&&s.extension==="md"){console.log("[WishMap] rollup auto: file change",s.path);for(let i of K(t,s))a(i)}}e.registerEvent(t.metadataCache.on("changed",r)),e.registerEvent(t.vault.on("modify",r)),e.registerEvent(t.vault.on("create",r)),e.registerEvent(t.vault.on("rename",r)),e.registerEvent(t.vault.on("delete",r)),e.addCommand({id:"wishmap-rollup-current",name:"Recompute duration for current note",checkCallback:s=>{let i=t.workspace.getActiveFile();return!i||i.extension!=="md"?!1:(s||a(i),!0)}}),t.workspace.onLayoutReady(()=>{let s=t.vault.getMarkdownFiles();for(let i of s)for(let c of K(t,i))a(c)})}var G=require("obsidian"),Ye="03 SaveBox/Active",Nr=["duration_hours","durationHours","duration","duration hours"],Rr=2;function ie(e){return e.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}var je=e=>/^area(\s|:|-|_)/.test(ie(e.basename)),Te=e=>/^wish(\s|:|-|_)/.test(ie(e.basename)),xe=e=>/^goal(\s|:|-|_)/.test(ie(e.basename)),oe=e=>/^project(\s|:|-|_)/.test(ie(e.basename)),me=e=>/^task(\s|:|-|_)/.test(ie(e.basename)),ke=e=>/^habit(\s|:|-|_)/.test(ie(e.basename)),Fe=e=>/^note(\s|:|-|_)/.test(ie(e.basename)),Or=e=>e.path===Ye||e.path.startsWith(Ye+"/"),M=e=>e.vault.getMarkdownFiles().filter(Or),T=(e,t)=>e.basename.localeCompare(t.basename),ae=(e,t)=>e.metadataCache.getFileCache(t),St=(e,t)=>ae(e,t)?.frontmatter??{};function Yr(e){let t=Number(String(e??"").replace(/[^0-9.\-]/g,""));return Number.isFinite(t)?t:NaN}function B(e,t){for(let n of Nr)if(St(e,t)[n]!==void 0){let a=Yr(St(e,t)[n]);if(Number.isFinite(a))return a}return NaN}function _r(e,t){let n=new Set;for(let r of ae(e,t)?.tags??[])n.add(String(r?.tag??r).replace(/^#/,""));let a=St(e,t).tags;return Array.isArray(a)?a.forEach(r=>r&&n.add(String(r).replace(/^#/,""))):a&&n.add(String(a).replace(/^#/,"")),Array.from(n)}var x=(e,t)=>{let n=_r(e,t);return n.length?" "+n.map(a=>`#${a}`).join(" "):""},_e=e=>Number(e.toFixed(Rr)),P=e=>`${_e(e)} ${_e(e)===1?"hr":"hrs"}`,C=e=>`<span class="duration-chip">${e}</span>`,A=(e,t)=>t?`<span class="grey-link">~~${e}~~ \u2705</span>`:e;function q(e,t){let n=t.split(`
`).map(a=>a?`> ${a}`:">").join(`
`);return`> [!wishmap]+ ${e}
>
${n}
`}function Cn(){return`
.duration-chip{display:inline-block;padding:0 6px;border-radius:12px;line-height:1.6;font-size:0.9em;background-color:var(--interactive-accent-hover);color:var(--background-primary);}
.grey-link a{color:var(--text-faint)!important;}
.callout[data-callout="wishmap"] .callout-icon{display:none;} /* hide icon */
`}function Dn(e,t){let n=ae(e,t)?.links??[],a=new Set,r=[];for(let s of n){let i=e.metadataCache.getFirstLinkpathDest(s.link,t.path);i instanceof G.TFile&&i.extension==="md"&&!a.has(i.path)&&(a.add(i.path),r.push(i))}return r}var L=(e,t,n)=>Dn(e,t).some(a=>a.path===n.path)||Dn(e,n).some(a=>a.path===t.path),jr=(e,t)=>M(e).filter(Te).filter(n=>L(e,t,n)),Nn=(e,t)=>M(e).filter(xe).filter(n=>L(e,t,n)),ue=(e,t)=>M(e).filter(oe).filter(n=>L(e,t,n)),re=(e,t)=>M(e).filter(me).filter(n=>L(e,t,n)),We=(e,t)=>M(e).filter(ke).filter(n=>L(e,t,n)),Wr=(e,t)=>M(e).filter(Fe).filter(n=>L(e,t,n)),Rn=(e,t)=>M(e).filter(Fe).filter(n=>L(e,t,n)),Lt=(e,t)=>M(e).filter(Fe).filter(n=>L(e,t,n)),Be=(e,t)=>M(e).filter(Fe).filter(n=>L(e,t,n)),se=(e,t)=>M(e).filter(Fe).filter(n=>L(e,t,n)),Br=(e,t)=>M(e).filter(oe).filter(n=>L(e,t,n)),Ir=(e,t)=>M(e).filter(me).filter(n=>L(e,t,n)),Kr=(e,t)=>M(e).filter(ke).filter(n=>L(e,t,n)),qr=(e,t)=>M(e).filter(oe).filter(n=>L(e,t,n)),Gr=(e,t)=>M(e).filter(me).filter(n=>L(e,t,n)),Qr=(e,t)=>M(e).filter(ke).filter(n=>L(e,t,n)),Ur=(e,t)=>M(e).filter(me).filter(n=>L(e,t,n)),zr=(e,t)=>M(e).filter(ke).filter(n=>L(e,t,n));function he(e,t){let n=re(e,t).map(s=>({d:B(e,s),done:S(e,s)})).filter(s=>Number.isFinite(s.d)&&s.d>0),a=n.reduce((s,i)=>s+i.d,0),r=n.filter(s=>s.done).reduce((s,i)=>s+i.d,0);return a<=0?{total:null,pct:null}:{total:_e(a),pct:Math.round(r/a*100)}}var pe=(e,t)=>re(e,t).length>0&&re(e,t).every(n=>S(e,n));function On(e,t){let n=ue(e,t),a=0,r=0,s=!1;for(let i of n){let{total:c,pct:d}=he(e,i);Number.isFinite(c)&&c>0&&(s=!0,a+=c,d!=null&&(r+=c*(d/100)))}return!s||a<=0?{total:null,pct:null}:{total:_e(a),pct:Math.round(r/a*100)}}var Yn=(e,t)=>ue(e,t).length>0&&ue(e,t).every(n=>pe(e,n));function S(e,t){let a=(ae(e,t)?.listItems??[]).find(r=>r&&"task"in r);return String(a?.task??"").toLowerCase()==="x"}function Pt(e,t){let n=new Set,a=[];a.push(`- [[${t.path}|${t.basename}]]${x(e,t)}`);for(let r of jr(e,t).sort(T))if(!n.has(r.path)){n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${x(e,r)}`);for(let s of Nn(e,r).sort(T)){if(n.has(s.path))continue;n.add(s.path);let{total:i,pct:c}=On(e,s),d=Yn(e,s),o=Number.isFinite(i)&&i>0?` ${C(P(i))}`:"",l=c!=null&&c>0&&c<100?` ${c}%`:"",u=`[[${s.path}|${s.basename}]]${o}${l}${x(e,s)}`;a.push(`    - ${A(u,d)}`);for(let p of ue(e,s).sort(T)){if(n.has(p.path))continue;n.add(p.path);let{total:h,pct:f}=he(e,p),g=pe(e,p),m=Number.isFinite(h)&&h>0?` ${C(P(h))}`:"",w=f!=null&&f>0&&f<100?` ${f}%`:"",v=`[[${p.path}|${p.basename}]]${m}${w}${x(e,p)}`;a.push(`      - ${A(v,g)}`);for(let y of re(e,p).sort(T)){if(n.has(y.path))continue;n.add(y.path);let b=B(e,y),E=Number.isFinite(b)&&b>0?` ${C(P(b))}`:"",k=`[[${y.path}|${y.basename}]]${E}${x(e,y)}`;a.push(`        - ${A(k,S(e,y))}`)}for(let y of We(e,p).sort(T)){if(n.has(y.path))continue;n.add(y.path);let b=`[[${y.path}|${y.basename}]]${x(e,y)}`;a.push(`        - ${A(b,S(e,y))}`)}for(let y of Be(e,p).sort(T))n.has(y.path)||(n.add(y.path),a.push(`        - [[${y.path}|${y.basename}]]${x(e,y)}`))}for(let p of Lt(e,s).sort(T))n.has(p.path)||(n.add(p.path),a.push(`    - [[${p.path}|${p.basename}]]${x(e,p)}`))}for(let s of Rn(e,r).sort(T))n.has(s.path)||(n.add(s.path),a.push(`  - [[${s.path}|${s.basename}]]${x(e,s)}`))}for(let r of Br(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:i}=he(e,r),c=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"",d=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${c}${d}${x(e,r)}`,pe(e,r))}`)}for(let r of Ir(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let s=B(e,r),i=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${i}${x(e,r)}`,S(e,r))}`)}for(let r of Kr(e,t).sort(T))n.has(r.path)||(n.add(r.path),a.push(`  - ${A(`[[${r.path}|${r.basename}]]${x(e,r)}`,S(e,r))}`));for(let r of Wr(e,t).sort(T))n.has(r.path)||(n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${x(e,r)}`));return q(`${t.basename}`,a.join(`
`))}function _n(e,t){let n=new Set,a=[];a.push(`- [[${t.path}|${t.basename}]]${x(e,t)}`);for(let r of Nn(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:i}=On(e,r),c=Yn(e,r),d=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"",o=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${d}${o}${x(e,r)}`,c)}`);for(let l of ue(e,r).sort(T)){if(n.has(l.path))continue;n.add(l.path);let{total:u,pct:p}=he(e,l),h=pe(e,l),f=Number.isFinite(u)&&u>0?` ${C(P(u))}`:"",g=p!=null&&p>0&&p<100?` ${p}%`:"";a.push(`    - ${A(`[[${l.path}|${l.basename}]]${f}${g}${x(e,l)}`,h)}`);for(let m of re(e,l).sort(T)){if(n.has(m.path))continue;n.add(m.path);let w=B(e,m),v=Number.isFinite(w)&&w>0?` ${C(P(w))}`:"";a.push(`      - ${A(`[[${m.path}|${m.basename}]]${v}${x(e,m)}`,S(e,m))}`);for(let y of se(e,m).sort(T))n.has(y.path)||(n.add(y.path),a.push(`        - [[${y.path}|${y.basename}]]${x(e,y)}`))}for(let m of We(e,l).sort(T))n.has(m.path)||(n.add(m.path),a.push(`      - ${A(`[[${m.path}|${m.basename}]]${x(e,m)}`,S(e,m))}`));for(let m of Be(e,l).sort(T))n.has(m.path)||(n.add(m.path),a.push(`      - [[${m.path}|${m.basename}]]${x(e,m)}`))}for(let l of Lt(e,r).sort(T))n.has(l.path)||(n.add(l.path),a.push(`  - [[${l.path}|${l.basename}]]${x(e,l)}`))}for(let r of qr(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:i}=he(e,r),c=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"",d=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${c}${d}${x(e,r)}`,pe(e,r))}`)}for(let r of Gr(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let s=B(e,r),i=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${i}${x(e,r)}`,S(e,r))}`);for(let c of se(e,r).sort(T))n.has(c.path)||(n.add(c.path),a.push(`    - [[${c.path}|${c.basename}]]${x(e,c)}`))}for(let r of Qr(e,t).sort(T))n.has(r.path)||(n.add(r.path),a.push(`  - ${A(`[[${r.path}|${r.basename}]]${x(e,r)}`,S(e,r))}`));for(let r of Rn(e,t).sort(T))n.has(r.path)||(n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${x(e,r)}`));return q(`${t.basename}`,a.join(`
`))}function jn(e,t){let n=new Set,a=[];a.push(`- [[${t.path}|${t.basename}]]${x(e,t)}`);for(let r of ue(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:i}=he(e,r),c=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"",d=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${c}${d}${x(e,r)}`,pe(e,r))}`);for(let o of re(e,r).sort(T)){if(n.has(o.path))continue;n.add(o.path);let l=B(e,o),u=Number.isFinite(l)&&l>0?` ${C(P(l))}`:"";a.push(`    - ${A(`[[${o.path}|${o.basename}]]${u}${x(e,o)}`,S(e,o))}`);for(let p of se(e,o).sort(T))n.has(p.path)||(n.add(p.path),a.push(`      - [[${p.path}|${p.basename}]]${x(e,p)}`))}for(let o of We(e,r).sort(T))n.has(o.path)||(n.add(o.path),a.push(`    - ${A(`[[${o.path}|${o.basename}]]${x(e,o)}`,S(e,o))}`));for(let o of Be(e,r).sort(T))n.has(o.path)||(n.add(o.path),a.push(`    - [[${o.path}|${o.basename}]]${x(e,o)}`))}for(let r of Ur(e,t).sort(T)){if(n.has(r.path))continue;n.add(r.path);let s=B(e,r),i=Number.isFinite(s)&&s>0?` ${C(P(s))}`:"";a.push(`  - ${A(`[[${r.path}|${r.basename}]]${i}${x(e,r)}`,S(e,r))}`);for(let c of se(e,r).sort(T))n.has(c.path)||(n.add(c.path),a.push(`    - [[${c.path}|${c.basename}]]${x(e,c)}`))}for(let r of zr(e,t).sort(T))n.has(r.path)||(n.add(r.path),a.push(`  - ${A(`[[${r.path}|${r.basename}]]${x(e,r)}`,S(e,r))}`));for(let r of Lt(e,t).sort(T))n.has(r.path)||(n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${x(e,r)}`));return q(`${t.basename}`,a.join(`
`))}function Wn(e,t){let n=[];n.push(`- [[${t.path}|${t.basename}]]${x(e,t)}`);for(let a of re(e,t).sort(T)){let r=B(e,a),s=Number.isFinite(r)&&r>0?` ${C(P(r))}`:"";n.push(`  - ${A(`[[${a.path}|${a.basename}]]${s}${x(e,a)}`,S(e,a))}`);for(let i of se(e,a).sort(T))n.push(`    - [[${i.path}|${i.basename}]]${x(e,i)}`)}for(let a of We(e,t).sort(T))n.push(`  - ${A(`[[${a.path}|${a.basename}]]${x(e,a)}`,S(e,a))}`);for(let a of Be(e,t).sort(T))n.push(`  - [[${a.path}|${a.basename}]]${x(e,a)}`);return q(`${t.basename}`,n.join(`
`))}function Xr(e,t){let n=[],a=B(e,t),r=Number.isFinite(a)&&a>0?` ${C(P(a))}`:"";n.push(`- ${A(`[[${t.path}|${t.basename}]]${r}${x(e,t)}`,S(e,t))}`);for(let s of se(e,t).sort(T))n.push(`  - [[${s.path}|${s.basename}]]${x(e,s)}`);return q(`${t.basename}`,n.join(`
`))}function Hn(e){return je(e)?0:Te(e)?1:xe(e)?2:oe(e)?3:99}function Vr(e,t,n){let a=ae(e,t)?.links??[],r=ae(e,n)?.links??[],s=a.some(c=>e.metadataCache.getFirstLinkpathDest(c.link,t.path)?.path===n.path),i=r.some(c=>e.metadataCache.getFirstLinkpathDest(c.link,n.path)?.path===t.path);return s||i}function Jr(e,t){let n=y=>(ae(e,y)?.links??[]).length>0,a=y=>{for(let[,b]of Object.entries(e.metadataCache.resolvedLinks))if(b[y.path])return!0;return!1},r=y=>!n(y)&&!a(y),s=y=>{let b=Hn(y);return b===0?!1:M(e).filter(k=>Hn(k)<b).some(k=>Vr(e,k,y))},i=y=>!s(y),c=t.filter(Te).sort(T),d=t.filter(xe).sort(T),o=t.filter(oe).sort(T),l=t.filter(me).sort(T),u=t.filter(ke).sort(T),p=y=>y.map(b=>`- [[${b.path}|${b.basename}]]`).join(`
`),h=(y,b)=>b.length?q(`${y} (${b.length})`,p(b)):"",f=y=>y.sort(T).map(b=>Zr(e,b)).join(`

`),g=(y,b)=>b.length?q(`${y} (${b.length})`,f(b)):"",m=l.filter(y=>r(y)||i(y)),w="";if(m.length){let y=[];for(let b of m.sort(T)){let E=B(e,b),k=Number.isFinite(E)&&E>0?` ${C(P(E))}`:"";y.push(`- ${A(`[[${b.path}|${b.basename}]]${k}${x(e,b)}`,S(e,b))}`);for(let H of se(e,b).sort(T))y.push(`  - [[${H.path}|${H.basename}]]${x(e,H)}`)}w=q(`\u{1F4CC} Solo Tasks (${m.length})`,y.join(`
`))}let v=[];return v.push(g("\u{1F4AD} Unparented Wishes",c.filter(i))),v.push(g("\u{1F3AF} Unparented Goals",d.filter(i))),v.push(g("\u{1F680} Unparented Projects",o.filter(i))),v.push(w),v.push(h("\u{1F501} Solo Habits",u.filter(y=>r(y)||i(y)))),v.push(h("\u{1F4AD} Standalone Wishes",c.filter(r))),v.push(h("\u{1F3AF} Standalone Goals",d.filter(r))),v.push(h("\u{1F680} Standalone Projects",o.filter(r))),v.filter(Boolean).join(`

`)}function Zr(e,t){if(je(t))return Pt(e,t);if(Te(t))return _n(e,t);if(xe(t))return jn(e,t);if(oe(t))return Wn(e,t);let n=x(e,t);return q(`\u{1F4C4} ${t.basename}`,`- [[${t.path}|${t.basename}]]${n}`)}function Bn(e){let t=e.app;e.registerMarkdownCodeBlockProcessor("wishmap",async(n,a,r)=>{a.empty(),a.createEl("style",{text:Cn()});let s=await In(t);await G.MarkdownRenderer.render(t,s,a,r.sourcePath,e)}),e.registerMarkdownCodeBlockProcessor("wishmap-local",async(n,a,r)=>{let s=String(n||"").trim().toLowerCase(),i=t.vault.getAbstractFileByPath(r.sourcePath);if(!(i instanceof G.TFile)||i.extension!=="md"){a.setText("No file context");return}a.empty(),a.createEl("style",{text:Cn()});let c="";s==="project"||!s&&oe(i)?c=Wn(t,i):s==="goal"||!s&&xe(i)?c=jn(t,i):s==="wish"||!s&&Te(i)?c=_n(t,i):s==="area"||!s&&je(i)?c=Pt(t,i):s==="task"||!s&&me(i)?c=Xr(t,i):c="_Place in an Area, Wish, Goal, Project, or Task note, or pass one of: area | wish | goal | project | task._",await G.MarkdownRenderer.render(t,c,a,r.sourcePath,e)})}async function In(e){let t=M(e),n=t.filter(je).sort(T),a=[];for(let r of n)a.push(Pt(e,r));return a.push(Jr(e,t)),a.filter(Boolean).join(`

`)}async function Kn(e){let t=await In(e),n=(0,G.normalizePath)(`${Ye}/_Maps/Area-Maps.md`),a=e.vault.getAbstractFileByPath(n);if(a instanceof G.TFile)await e.vault.read(a)!==t&&await e.vault.modify(a,t);else{try{await e.vault.createFolder(`${Ye}/_Maps`)}catch{}await e.vault.create(n,t)}return n}var D=require("obsidian");function ge(){if(document.getElementById("wm-scheduler-style"))return;let e=`
/* -------------------------------------------------------------------------- */
/* 1. Utility visibility helpers                                              */
/* -------------------------------------------------------------------------- */
.wm-hidden { display: none !important; }  /* Hide elements dynamically */

/* -------------------------------------------------------------------------- */
/* 2. Scheduled wish link bubble (#Y2025) under \u201CMy Wishes\u201D section           */
/* -------------------------------------------------------------------------- */
.wm-wish-link--scheduled::after {
  content: "#Y" attr(data-year);
  display: inline-block;
  margin-left: 6px;
  padding: 2px 8px 3px 8px;
  border-radius: 999px;
  font-size: 0.8em;
  font-weight: 600;
  line-height: 1;
  background: color-mix(in srgb, var(--text-accent) 20%, var(--background-primary));
  color: var(--text-accent);
  vertical-align: middle;
}

/* -------------------------------------------------------------------------- */
/* 3. Wish card hover and external styling                                    */
/* -------------------------------------------------------------------------- */
.wm-year-col .wm-wish-card:hover {
  filter: brightness(1.08);
  opacity: 0.95;
}

/* External (foreign) wishes from other areas: lighter, muted tone */
.wm-year-col .wm-wish-card.is-external {
  background: color-mix(in srgb, var(--interactive-accent) 25%, var(--background-primary));
  border-color: color-mix(in srgb, var(--interactive-accent) 25%, var(--background-primary));
  color: color-mix(in srgb, var(--text-muted) 70%, var(--text-normal));
  opacity: 0.85;
  box-shadow: none;
}

.wm-year-col .wm-wish-card.is-external:hover {
  background: color-mix(in srgb, var(--interactive-accent) 30%, var(--background-primary));
  opacity: 1;
}

/* -------------------------------------------------------------------------- */
/* 4. Hide Obsidian popover previews while dragging                           */
/* -------------------------------------------------------------------------- */
body.wm-dragging .popover,
body.wm-dragging .mod-hover-popover,
body.wm-drag-intent .popover,
body.wm-drag-intent .mod-hover-popover {
  display: none !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* -------------------------------------------------------------------------- */
/* 5. Yearly Schedule grid container                                          */
/* -------------------------------------------------------------------------- */
.wm-year-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;  /* two columns: current year + next */
  gap: 12px;
  margin-top: 6px;
}

.wm-year-col {
  border: 0;
  background: transparent;
}

/* -------------------------------------------------------------------------- */
/* 6. Instruction line shown above the grid                                   */
/* -------------------------------------------------------------------------- */
.wm-year-instruction {
  margin-top: 8px;
  margin-bottom: 6px;
  text-align: left;
  font-size: 0.95em;
  color: var(--text-muted);
  font-style: italic;
}

/* -------------------------------------------------------------------------- */
/* 7. Year column header (year label, darker background)                      */
/* -------------------------------------------------------------------------- */
.wm-year-col--header {
  padding: 10px 12px;
  font-weight: 700;
  text-align: center;
  background: color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border: 1px solid color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border-bottom: 3px solid white;
  color: var(--text-muted);
  font-size: .85em;
  border-radius: 12px 12px 0 0;  /* rounded top corners */
}
/* -------------------------------------------------------------------------- */
/* 7A. Unscheduled column (tighter spacing)                                   */
/* -------------------------------------------------------------------------- */
.wm-year-col--unscheduled .wm-year-col--header {
  padding: 10px 12px;
  font-weight: 700;
  text-align: center;
  background: color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border: 1px solid color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border-bottom: 3px solid white;
  color: var(--text-muted);
  font-size: .85em;
  border-radius: 12px 12px 0 0;  /* rounded top corners */
}

.wm-year-col--unscheduled .wm-year-col--body {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* -------------------------------------------------------------------------- */
/* 8. Year column body (drop zone)                                            */
/* -------------------------------------------------------------------------- */
.wm-year-col--body {
  min-height: 140px;
  padding: 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  background: color-mix(in srgb, var(--background-secondary) 70%, var(--background-primary));
  border: 1px solid color-mix(in srgb, var(--background-secondary) 70%, var(--background-primary));
  border-top: none;
  border-radius: 0 0 12px 12px;  /* rounded bottom corners only */
}

/* When user drags over a box: show accent outline */
.wm-year-col--body.is-dragover {
  outline: 2px dashed var(--text-accent);
  outline-offset: -4px;
}

/* -------------------------------------------------------------------------- */
/* 9. Wish cards (purple draggable rectangles)                                */
/* -------------------------------------------------------------------------- */
.wm-wish-card {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 10px;
  background: var(--interactive-accent);
  border: 1px solid var(--interactive-accent);
  box-shadow: 0 1px 2px rgba(0,0,0,.05);
  color: white;
  font-weight: 700;

  /* --- additions for smoother drag --- */
  cursor: grab;
  user-select: none;
  -webkit-user-drag: element; /* makes the element draggable on Chromium/WebKit */
  transition: transform 0.05s ease-in-out;
}

.wm-wish-card:active {
  cursor: grabbing;
  transform: scale(0.98); /* visual feedback */
}

/* Slightly transparent when external */
.wm-wish-card.is-external { opacity: .9; }

/* -------------------------------------------------------------------------- */
/* 10. Scheduled wish links under \u201CMy Wishes\u201D                                 */
/* -------------------------------------------------------------------------- */
.wm-wish-link--scheduled {
  color: var(--text-faint) !important;
  cursor: default !important;
  text-decoration: none !important;
}

/* Add the #Y2025 bubble for both anchor and span variants */
a.internal-link.wm-wish-link--scheduled::after,
span.cm-hmd-internal-link.wm-wish-link--scheduled::after,
span.internal-link.wm-wish-link--scheduled::after {
  content: "#Y" attr(data-year);
  display: inline-block;
  margin-left: 6px;
  padding: 2px 8px 3px 8px;
  border-radius: 999px;
  font-size: 0.8em;
  font-weight: 600;
  line-height: 1;
  background: color-mix(in srgb, var(--text-accent) 20%, var(--background-primary));
  color: var(--text-accent);
  vertical-align: middle;
}

/* --- Goals: scheduled link treatment --- */
.wm-goal-link--scheduled {
  color: var(--text-muted);                /* greyed link */
  text-decoration: none;
  opacity: 1;
  pointer-events: none;
}

.wm-goal-link--scheduled::after {
  content: " #" attr(data-label);          /* show #2025 Q2 */
  margin-left: 6px;
  font-size: 0.75em;
  line-height: 1;
  padding: 2px 6px;
  border-radius: 999px;
  background-color: var(--interactive-accent); /* strong accent bubble */
  color: var(--text-on-accent);                 /* readable text */
  vertical-align: baseline;
  border: none;
}

.markdown-source-view .wm-goal-link--scheduled {
  color: var(--text-muted);
  opacity: 1;
}



`,t=document.createElement("style");t.id="wm-scheduler-style",t.textContent=e,document.head.appendChild(t)}var z=require("obsidian"),es=/^(?:Y)?\d{4}$/,ts=/^Y\d{4}$/;function X(e,t,n,a){if(typeof e!="object"){let d=window.app,o=e,l=t,u={origin:"native",payloadKey:"text/x-goal-path",...a??{}};return qn(d,o,l,u)}return qn(e,t,n,a??{})}function qn(e,t,n,a){let r=document.createElement("div");r.classList.add("wm-wish-card"),r.textContent=t,r.setAttribute("draggable","true"),r.dataset.path=n;let s=a.origin??"native";r.dataset.origin=s,s==="external"&&r.classList.add("is-external");let i=a.payloadKey??"text/x-wish-path";return r.addEventListener("dragstart",c=>{let d=c.dataTransfer;if(!d)return;d.setData("text/x-origin",s),d.setData(i,n),d.setData("text/plain",n),document.body.classList.add("wm-dragging");let o=new Image;o.src=Ct,d.setDragImage(o,0,0)}),r.addEventListener("dragend",()=>{document.body.classList.remove("wm-dragging")}),r.addEventListener("click",async()=>{let c=e.vault.getAbstractFileByPath(n);c instanceof z.TFile&&await e.workspace.getLeaf(!1).openFile(c)}),r}var Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=";function ns(e){return(Array.isArray(e?.tags)?e.tags:e?.tags?[e.tags]:[]).map(String)}function as(e){return e?(Array.isArray(e?.tags)?e.tags:typeof e?.tags=="string"?[e.tags]:Array.isArray(e?.tag)?e.tag:typeof e?.tag=="string"?[e.tag]:[]).map(String):[]}function Ae(e){return as(e).map(t=>t.trim()).filter(t=>es.test(t)).map(t=>t.replace(/^Y/,"")).filter(t=>/^\d{4}$/.test(t))}function Me(e,t){let r=[...ns(e).filter(s=>!/^Y\d{4}$/.test(String(s))),`Y${t}`];e.tags=r}function Ie(e){return(Array.isArray(e)?e.map(String):[]).filter(n=>!ts.test(n))}function $(e){return/^✨\s*Wish\s*-\s*/i.test(e)?"wish":/^🎯\s*Goal\s*-\s*/i.test(e)?"goal":/^🚀\s*Project\s*-\s*/i.test(e)?"project":/^📌\s*Task\s*-\s*/i.test(e)?"task":"other"}function $e(e){return(e||[]).filter(t=>!/^Y\d{4}Q[1-4]$/i.test(t))}function Ke(e,t){let a=(Array.isArray(e?.tags)?e.tags:typeof e?.tags=="string"?[e.tags]:[]).filter(r=>/^Y\d{4}Q[1-4]$/i.test(r));return t?a.filter(r=>r.startsWith(`Y${t}`)):a}function qe(e){let{app:t,fileRef:n,containerEl:a,getNoteContainer:r,render:s,reAnnotate:i,registerEvent:c}=e,d=null,o=(h,f=120)=>{d&&window.clearTimeout(d),d=window.setTimeout(()=>{d=null,h()},f)},l=()=>i(),u=()=>{t.workspace.getActiveFile()?.path===n.path&&document.visibilityState==="visible"&&(l(),requestAnimationFrame(l),setTimeout(l,120),setTimeout(l,300),setTimeout(l,800),setTimeout(l,1500))},p=()=>{let h=r(a);h.querySelector(".wm-year-grid-mount")||h.querySelector(".wm-quarter-grid-mount")||s(),u()};c(t.metadataCache.on("resolved",()=>{t.workspace.getActiveFile()?.path===n.path&&s(),o(p,150)})),c(t.workspace.on("file-open",h=>{h?.path===n.path&&s(),o(p,150)})),c(t.metadataCache.on("changed",()=>{t.workspace.getActiveFile()?.path===n.path&&s(),o(p,150)}))}function Ge(e){return e.trim().replace(/\\/g,"/").toLowerCase().replace(/\.md$/,"")+".md"}function Gn(e){return(e??"").normalize("NFD").replace(/\p{M}+/gu,"").toLowerCase().replace(/\s+/g," ").replace(/[:.]/g," ").replace(/[0-9]/g," ").replace(/[^\p{L}\s]/gu,"").replace(/\s+/g," ").trim()}function Y(e,t){let n=Gn(t),a=Array.from(e.querySelectorAll(["h1","h2","h3","h4","h5","h6","[data-heading]","[role='heading']","[class^='el-h']",".cm-header",".HyperMD-header"].join(",")));for(let r of a){let s=r.getAttribute("data-heading")??r.textContent??"",i=Gn(s);if(i===n||i.includes(n))return r}return null}function Qe(e,t){let n=e.nextElementSibling;if(n&&n.classList.contains(t))return n;let a=document.createElement("div");return a.classList.add(t),e.insertAdjacentElement("afterend",a),a}function I(e){let t=r=>!!r&&(r.classList.contains("markdown-reading-view")||r.classList.contains("markdown-preview-view")||r.classList.contains("markdown-rendered")||r.classList.contains("markdown-source-view"));if(t(e))return e;let n=e.closest(".markdown-reading-view")||e.closest(".markdown-preview-view")||e.closest(".markdown-rendered")||e.closest(".markdown-source-view");if(n)return n;let a=e;for(;a&&!t(a);)a=a.parentElement;return a??e}function Ue(e,t,n="__wmAutoAnnoGeneric"){if(e[n])return;let a=null,r=()=>{a&&window.clearTimeout(a),a=window.setTimeout(t,100)},s=new MutationObserver(i=>{i.every(c=>c.type==="attributes"&&c.target.classList?.contains("wm-wish-link--scheduled"))||r()});return s.observe(e,{subtree:!0,childList:!0,characterData:!1,attributes:!1}),r(),e[n]=s,()=>{try{s.disconnect()}catch{}e[n]=null}}function ze(e,t){let{resolveFileFromEl:n,scheduledClass:a,payloadKey:r,bindKey:s="__wmBridgeBound_generic"}=t;if(e[s])return;e[s]=!0;let i=d=>{let o=d,l=o.target;if(!l)return;let u=l.closest("a.internal-link, span.cm-hmd-internal-link, span.internal-link");if(!u||u.classList.contains(a))return;let p=n(u);if(!(p instanceof z.TFile))return;let h=o.dataTransfer;if(!h)return;h.setData("text/x-origin","native"),h.setData(r,p.path),h.setData("text/plain",p.path),h.effectAllowed="copyMove";let f=new Image;f.src=Ct,h.setDragImage(f,0,0),document.body.classList.add("wm-dragging","wm-drag-intent"),document.querySelectorAll(".popover,.mod-hover-popover").forEach(g=>{let m=g;m.style.display="none",m.style.opacity="0",m.style.pointerEvents="none"}),requestAnimationFrame(()=>{try{o.dataTransfer?.setData(r,p.path)}catch{}})},c=()=>{document.body.classList.remove("wm-dragging","wm-drag-intent")};e.addEventListener("dragstart",i,!0),e.addEventListener("dragend",c,!0)}function Xe(e){let{grid:t,keys:n,selectors:a,nativeSet:r,filesFor:s,dedupeKey:i,isNative:c,createCard:d,onAppend:o,clearColumns:l=!0}=e,u=n.reduce((h,f)=>(h[f]=0,h),{});if(l)for(let h of n)t.columns[h]?.body.replaceChildren();let p=new Set;for(let h of a){let f=h.key,g=t.columns[f]?.body;if(!g)continue;let m=s(h);for(let w of m){let v=i(w);if(p.has(v))continue;p.add(v);let y=c(w),b=d(w,y);g.appendChild(b),u[f]=(u[f]??0)+1,o?.(b,f)}}return u}function Ve(e){let{root:t,queryLinks:n,scheduledClass:a,kind:r,dataMime:s,app:i,fileRef:c}=e;n(t).filter(o=>o.tagName.toLowerCase()==="a").forEach(o=>{let l=o;if(l.classList.contains(a)){l.removeAttribute("draggable");return}let u=l.getAttribute("data-href")||l.getAttribute("href")||"",p=i.metadataCache.getFirstLinkpathDest(u,c.path);if(!(p instanceof z.TFile)||$(p.basename)!==r||l._wmBound)return;l._wmBound=!0,l.setAttribute("draggable","true");let h=null,f=()=>{h||(h=window.setTimeout(()=>{document.body.classList.add("wm-drag-intent"),document.querySelectorAll(".popover,.mod-hover-popover").forEach(m=>{let w=m;w.style.display="none",w.style.opacity="0",w.style.pointerEvents="none"})},500))},g=()=>{h&&(window.clearTimeout(h),h=null),document.body.classList.remove("wm-drag-intent")};l.addEventListener("mousedown",f),l.addEventListener("touchstart",f,{passive:!0}),["mouseup","mouseleave","touchend","touchcancel"].forEach(m=>l.addEventListener(m,g)),l.addEventListener("dragstart",m=>{let w=m.dataTransfer;if(w){w.setData("text/x-origin","native"),w.setData("text/plain",p.path),w.setData(s,p.path),w.effectAllowed="copyMove";let v=new Image;v.src=Ct,w.setDragImage(v,0,0)}document.body.classList.add("wm-dragging","wm-drag-intent"),requestAnimationFrame(()=>{try{m.dataTransfer?.setData(s,p.path)}catch{}})}),l.addEventListener("dragend",()=>{document.body.classList.remove("wm-dragging","wm-drag-intent"),g()})})}function Ee(e){let t=e.getAttribute("data-href")||e.getAttribute("href");if(t)return t;let n=e.dataset||{},a=n.href||n.linkPath||n.linkpath||n.originalLink||n.file||n.path||n.target||n.routerHref||n.wikilinkTarget;if(a)return String(a);let s=(e.textContent||"").trim().match(/\[\[([^|\]]+)(?:\|[^\]]+)?\]\]/);return s?s[1].trim():null}function Je(e,t,n,a,r={}){let{emojiPrefix:s="",labelPrefix:i=""}=r,c=Ee(n);if(c){let m=e.metadataCache.getFirstLinkpathDest(c,t.path);if(m instanceof z.TFile&&$(m.basename)===a)return m}let d=(n.textContent||"").trim(),l=(d.match(/\[\[([^|\]]+)(?:\|([^\]]+))?\]\]/)?.[2]||d).trim(),u=m=>m.toLowerCase().replace(/\s+/g," ").trim(),p=s?new RegExp(`^${s.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\$&")}\\s*${i}\\s*-\\s*`,"i"):new RegExp(`^\\p{Extended_Pictographic}\\s*${i}\\s*-\\s*`,"iu"),h=i?new RegExp(`^${i}\\s*-\\s*`,"i"):/^$/,f=e.vault.getMarkdownFiles().filter(m=>$(m.basename)===a),g=f.find(m=>u(m.basename)===u(l));return g||(g=f.find(m=>u(m.basename.replace(p,""))===u(l)),g)||(g=f.find(m=>{let w=m.basename.replace(p,"");return u(w)===u(l.replace(h,""))}),g)||s&&i&&(g=f.find(m=>u(m.basename)===u(`${s}${i?" ":""}${i} - ${l}`)),g)?g:null}function Ze(e,t,n){let a=["a.internal-link","span.cm-hmd-internal-link","span.internal-link","a[data-href]","[data-link-path]","[data-router-href]","[data-wikilink-target]","[data-linkpath]","[data-original-link]"].join(",");return Array.from(e.querySelectorAll(a)).filter(s=>{let i=n(s);return i instanceof z.TFile&&$(i.basename)===t})}function rs(e,t,n,a){let r=e.dataTransfer;if(!r)return null;let s=r.getData(a)||r.getData("text/plain")||r.getData("text/uri-list")||"";if(!s)return null;if(!s.endsWith(".md")){let i=t.metadataCache.getFirstLinkpathDest(s,n.path);if(i instanceof z.TFile)s=i.path;else return null}return s}function et(e,t,n){let{keys:a,headerFor:r,dataAttrFor:s,payloadKey:i,onDrop:c}=n,d=document.createElement("div");d.classList.add("wm-year-grid");let o={};for(let l of a){let u=document.createElement("div");u.classList.add("wm-year-col");let p=document.createElement("div");p.classList.add("wm-year-col--header"),p.textContent=r(l);let h=document.createElement("div");h.classList.add("wm-year-col--body");let f=s(l);h.setAttribute(f.name,f.value),h.style.pointerEvents="auto",h.style.position="relative",h.addEventListener("dragenter",g=>{h.classList.add("is-dragover");let m=g.dataTransfer;m&&(m.dropEffect="copy"),h.style.boxShadow="inset 0 0 0 2px var(--text-accent)"}),h.addEventListener("dragover",g=>{g.preventDefault(),g.stopPropagation();let m=g.dataTransfer;m&&(m.dropEffect="copy"),h.classList.contains("is-dragover")||(h.classList.add("is-dragover"),h.style.boxShadow="inset 0 0 0 2px var(--text-accent)")}),h.addEventListener("dragleave",()=>{h.classList.remove("is-dragover"),h.style.boxShadow=""}),h.addEventListener("drop",async g=>{g.preventDefault(),g.stopPropagation(),h.classList.remove("is-dragover"),h.style.boxShadow="";let m=rs(g,e,t,i);m&&await c(m,{key:l,body:h})}),u.appendChild(p),u.appendChild(h),d.appendChild(u),o[l]={root:u,header:p,body:h}}return{wrapper:d,columns:o}}function V(e,t,n,a,r,s){let i=t.map(h=>Y(e,h)).find(h=>!!h)||null;if(!i)return[];let c=h=>/^H[1-6]$/i.test(h.tagName)||h.hasAttribute("data-heading")||h.getAttribute("role")==="heading"||(h.className||"").toString().startsWith("el-h"),d=[];for(let h=i.nextElementSibling;h&&!c(h);h=h.nextElementSibling)d.push(h);let o=[];for(let h of d)o.push(...n(h));let l=[];for(let h of o){let f=a(h);f instanceof z.TFile&&$(f.basename)===r&&l.push(f.path)}let u=Array.from(new Set(l)),p=s?s():[];return Array.from(new Set([...u,...p]))}var Dt=class extends D.MarkdownRenderChild{constructor(n,a,r){super(r);this.appRef=n;this.fileRef=a;this._peEnabled=window.PointerEvent!==void 0;this._dropTargets=[];this._dragGhost=null;this._dragOverEl=null;this._yearsCache=[]}populateWishes(n,a,r){let s=Array.from(new Set(V(r,["\u270D\uFE0Fmy wishes","my wishes"],c=>this.queryWishLinks(c),c=>this.resolveWishFileFromEl(c),"wish")));console.log("[area] collectKindFromThisPage ->",s.length,"paths");let i=new Set(s);return console.log("[area] nativePaths count:",s.length),s.length&&console.log("[area] nativePaths sample:",s.slice(0,10)),Xe({grid:n,keys:a,selectors:a.map(c=>({key:c,ctx:c})),nativeSet:i,clearColumns:!0,filesFor:({ctx:c})=>{let d=c;return this.appRef.vault.getMarkdownFiles().filter(o=>{if($(o.basename)!=="wish")return!1;let l=this.appRef.metadataCache.getFileCache(o)?.frontmatter;return Ae(l).includes(d)})},dedupeKey:c=>Ge(c.path),isNative:c=>i.has(c.path),createCard:(c,d)=>{let o=c.basename.trim(),l=d?"native":"external";console.log("[area] createCard",{path:c.path,origin:l});let u=X(this.appRef,o,c.path,{origin:l,payloadKey:"text/x-wish-path"});return console.log("[area] card element after makeCard",{path:c.path,datasetOrigin:u.dataset.origin,hasExternalClass:u.classList.contains("is-external"),classList:Array.from(u.classList)}),d||u.classList.add("is-external"),u}})}pruneScheduledLinksUnderWishes(n){let a=Y(n,"\u270D\uFE0Fmy wishes")||Y(n,"my wishes");if(!a)return;let r=null;for(let c=a.nextElementSibling;c;c=c.nextElementSibling)if(/^H[1-6]$/i.test(c.tagName)||c.hasAttribute("data-heading")){r=c;break}let s=c=>{let d=!!(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING),o=!r||!!(c.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING);return d&&o},i=()=>{let d=this.queryWishLinks(n).filter(s);for(let o of d){let l=this.resolveWishFileFromEl(o);if(!(l instanceof D.TFile)||$(l.basename)!=="wish")continue;let u=this.appRef.metadataCache.getFileCache(l)?.frontmatter,h=Ae(u)[0];h?(o.classList.add("wm-wish-link--scheduled"),o.setAttribute("data-year",String(h)),o.tagName.toLowerCase()==="a"&&o.setAttribute("draggable","false")):(o.classList.remove("wm-wish-link--scheduled"),o.removeAttribute("data-year"),o.tagName.toLowerCase()==="a"&&o.setAttribute("draggable","true"))}};requestAnimationFrame(()=>{i(),window.setTimeout(i,150)}),window.setTimeout(()=>{try{let d=n.querySelector(".wm-unscheduled")?.children.length??0;this.queryWishLinks(n).length>0&&d===0&&this.doRender()}catch{}},500)}bindMyWishesAnchors(n){Ve({root:n,queryLinks:this.queryWishLinks.bind(this),scheduledClass:"wm-wish-link--scheduled",kind:"wish",dataMime:"text/x-wish-path",app:this.appRef,fileRef:this.fileRef})}onload(){ge();let n="wm-pointer-dnd";if(!document.getElementById(n)){let r=document.createElement("style");r.id=n,r.textContent=`
        .wm-drag-ghost{position:fixed;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);opacity:.9}
        .wm-drop-over{outline:2px solid rgba(0,0,0,.15); outline-offset:-2px}
        @media (hover:none) and (pointer:coarse){
          .wm-card a{pointer-events:none}
        }
      `,document.head.appendChild(r)}let a=I(this.containerEl);qe({app:this.appRef,fileRef:this.fileRef,containerEl:this.containerEl,getNoteContainer:I,render:this.doRender.bind(this),reAnnotate:this.reAnnotateFresh.bind(this),registerEvent:r=>this.registerEvent(r)}),Ue(a,()=>this.reAnnotateFresh()),ze(a,{resolveFileFromEl:this.resolveWishFileFromEl.bind(this),scheduledClass:"wm-wish-link--scheduled",payloadKey:"text/x-wish-path",bindKey:"__wmBridgeBound_wish"}),this.doRender(),this.reAnnotateFresh()}doRender(){ge();let n="wm-hide-inline-in-reading";if(!document.getElementById(n)){let w=document.createElement("style");w.id=n,w.textContent=".markdown-reading-view .wm-instruction-inline{display:none!important}",document.head.appendChild(w)}let a=I(this.containerEl),r=Y(a,"yearly schedule")||Y(a,"my yearly schedule");if(!r)return;let s=r,i=r.nextElementSibling;(i&&(i.classList?.contains("wm-instruction-inline")||i.hasAttribute?.("data-wm-instruction"))||i&&i.tagName?.toLowerCase()==="p")&&(s=i);let c=a.querySelector(".wm-year-grid-mount")||Qe(s,"wm-year-grid-mount");c.innerHTML="";let d=new Date,o=[String(d.getFullYear()),String(d.getFullYear()+1)];this._yearsCache=o;let l=this.renderYearGrid(o);c.appendChild(l.wrapper),l.wrapper.style.gridTemplateColumns="1fr 1fr 1fr";let u=document.createElement("div"),p=document.createElement("div"),h=document.createElement("div");u.classList.add("wm-year-col"),u.classList.add("wm-year-col--unscheduled"),p.classList.add("wm-year-col--header"),p.textContent="Unscheduled",h.classList.add("wm-year-col--body","wm-unscheduled"),h.setAttribute("data-year","unscheduled"),h.style.pointerEvents="auto",h.style.position="relative",u.appendChild(p),u.appendChild(h),l.wrapper.insertBefore(u,l.wrapper.firstChild),this._dropTargets=[h,...Object.values(l.columns).map(w=>w.body)],h.addEventListener("dragenter",w=>{h.classList.add("is-dragover");let v=w.dataTransfer;(v?.getData("text/x-origin")||"")!=="external"&&v&&(v.dropEffect="copy")}),h.addEventListener("dragover",w=>{w.preventDefault(),w.stopPropagation(),h.classList.add("is-dragover");let v=w.dataTransfer;v&&(v.dropEffect="copy")}),h.addEventListener("drop",async w=>{w.preventDefault(),w.stopPropagation(),h.classList.remove("is-dragover");let v=w.dataTransfer;if((v?.getData("text/x-origin")||"")==="external")return;let b=v?.getData("text/x-wish-path")||v?.getData("text/plain")||v?.getData("text/uri-list")||"";if(b&&!b.endsWith(".md")){let k=this.appRef.metadataCache.getFirstLinkpathDest(b,this.fileRef.path);k instanceof D.TFile&&(b=k.path)}if(!b)return;let E=this.appRef.vault.getAbstractFileByPath(b);E instanceof D.TFile&&await this.appRef.fileManager.processFrontMatter(E,k=>{let H=Array.isArray(k?.tags)?k.tags.slice():typeof k?.tags=="string"?[k.tags]:[],J=Ie(H);J.length>0?k.tags=J:delete k.tags});try{let k=this.appRef.metadataCache.getBacklinksForFile(E)?.data??{};for(let H of Object.keys(k)){let J=this.appRef.vault.getAbstractFileByPath(H);if(!(J instanceof D.TFile))continue;let Z=$(J.basename);(Z==="goal"||Z==="project"||Z==="task"||Z==="wish")&&await this.appRef.fileManager.processFrontMatter(J,ee=>{let ia=Array.isArray(ee?.tags)?ee.tags.slice():typeof ee?.tags=="string"?[ee.tags]:[],Bt=Ie($e(ia));Bt.length>0?ee.tags=Bt:delete ee.tags,Z==="task"&&delete ee.due})}}catch{}this.doRender()});let f=0,g=V(a,["\u270D\uFE0Fmy wishes","my wishes"],w=>this.queryWishLinks(w),w=>this.resolveWishFileFromEl(w),"wish");for(let w of g){let v=this.appRef.vault.getAbstractFileByPath(w);if(!(v instanceof D.TFile)||$(v.basename)!=="wish")continue;let y=this.appRef.metadataCache.getFileCache(v)?.frontmatter;if(Ae(y).length>0)continue;let E=X(this.appRef,v.basename.trim(),v.path,{origin:"native",payloadKey:"text/x-wish-path"});h.appendChild(E),f++}f>0?p.textContent=`\u26A0\uFE0F Unscheduled (${f})`:p.textContent="Unscheduled";let m=this.populateWishes(l,o,a);for(let w of o){let v=l.columns[w];if(!v)continue;let y=m[w]??0;v.header.textContent=y>0?`${w} (${y})`:w}}reAnnotateFresh(){let n=I(this.containerEl);if(n)try{this.pruneScheduledLinksUnderWishes(n),this.bindMyWishesAnchors(n)}catch{}}getLinkpathFromEl(n){return Ee(n)}resolveWishFileFromEl(n){return Je(this.appRef,this.fileRef,n,"wish",{emojiPrefix:"\u2728",labelPrefix:"Wish"})}queryWishLinks(n){return Ze(n,"wish",this.resolveWishFileFromEl.bind(this))}renderYearGrid(n){return et(this.appRef,this.fileRef,{keys:n,headerFor:a=>a,dataAttrFor:a=>({name:"data-year",value:a}),payloadKey:"text/x-wish-path",onDrop:async(a,{key:r})=>{await this.onDropWishToYear(a,r),this.doRender()}})}createCard(n,a){let r=X(this.appRef,n.basename.trim(),n.path,{origin:a?"native":"external",payloadKey:"text/x-wish-path"});try{this.bindPointerDrag(r,n.path)}catch{}return r}collectWishesFromThisPage(n){return V(n,["\u270D\uFE0Fmy wishes","my wishes"],a=>this.queryWishLinks(a),a=>this.resolveWishFileFromEl(a),"wish",()=>this.collectWishesFromCache())}collectAllWishesWithYear(n,a){return this.appRef.vault.getMarkdownFiles().filter(s=>$(s.basename)==="wish").filter(s=>{if(a.has(s.path))return!1;let i=this.appRef.metadataCache.getFileCache(s)?.frontmatter;return Ae(i).includes(n)})}collectWishesFromCache(){let a=(this.appRef.metadataCache.getFileCache(this.fileRef)?.links??[]).map(i=>i.link).filter(Boolean),r=[];for(let i of a){let c=this.appRef.metadataCache.getFirstLinkpathDest(i,this.fileRef.path);c instanceof D.TFile&&$(c.basename)==="wish"&&r.push(c.path)}return Array.from(new Set(r))}async onDropWishToYear(n,a){let r=this.appRef.vault.getAbstractFileByPath(n);if(r instanceof D.TFile){await this.appRef.fileManager.processFrontMatter(r,s=>{Me(s,String(a))});try{let s=this.appRef.metadataCache.getBacklinksForFile(r)?.data??{};for(let i of Object.keys(s)){let c=this.appRef.vault.getAbstractFileByPath(i);if(!(c instanceof D.TFile))continue;let d=$(c.basename);(d==="goal"||d==="project"||d==="task"||d==="wish")&&await this.appRef.fileManager.processFrontMatter(c,o=>{Me(o,String(a));let l=Array.isArray(o?.tags)?o.tags.slice():typeof o?.tags=="string"?[o.tags]:[],u=$e(l);u.length>0?o.tags=u:delete o.tags,d==="task"&&delete o.due})}}catch{}}}bindPointerDrag(n,a){this._peEnabled&&n.addEventListener("pointerdown",r=>{if(r.pointerType==="mouse")return;r.preventDefault(),n.setPointerCapture(r.pointerId),this._dragGhost=this.makeGhost(n),document.body.appendChild(this._dragGhost),this.moveGhost(r.clientX,r.clientY);let s=c=>{this._dragGhost&&(this.moveGhost(c.clientX,c.clientY),this.highlightOver(c.clientX,c.clientY))},i=async c=>{n.releasePointerCapture(c.pointerId),document.removeEventListener("pointermove",s,!0),document.removeEventListener("pointerup",i,!0),this.clearHighlight(),this._dragGhost&&(this._dragGhost.remove(),this._dragGhost=null);let d=this.hitTarget(c.clientX,c.clientY);if(!d)return;let o=d.getAttribute("data-year")||"unscheduled";o==="unscheduled"?await this.unscheduleByPath(a):await this.onDropWishToYear(a,o),this.doRender()};document.addEventListener("pointermove",s,!0),document.addEventListener("pointerup",i,!0)},{passive:!1})}makeGhost(n){let a=n.cloneNode(!0);return a.classList.add("wm-drag-ghost"),a.style.width=Math.min(220,n.getBoundingClientRect().width)+"px",a}moveGhost(n,a){this._dragGhost&&(this._dragGhost.style.left=n+"px",this._dragGhost.style.top=a+"px")}hitTarget(n,a){for(let r of this._dropTargets){let s=r.getBoundingClientRect();if(n>=s.left&&n<=s.right&&a>=s.top&&a<=s.bottom)return r}return null}highlightOver(n,a){let r=this.hitTarget(n,a);r!==this._dragOverEl&&(this._dragOverEl&&this._dragOverEl.classList.remove("wm-drop-over"),this._dragOverEl=r,this._dragOverEl&&this._dragOverEl.classList.add("wm-drop-over"))}clearHighlight(){this._dragOverEl&&this._dragOverEl.classList.remove("wm-drop-over"),this._dragOverEl=null}async unscheduleByPath(n){let a=this.appRef.vault.getAbstractFileByPath(n);a instanceof D.TFile&&await this.appRef.fileManager.processFrontMatter(a,r=>{let s=Array.isArray(r?.tags)?r.tags.slice():typeof r?.tags=="string"?[r.tags]:[],i=Ie(s);i.length>0?r.tags=i:delete r.tags})}},tt=class{constructor(t){this.app=t}async postProcess(t,n){let a=this.app.vault.getAbstractFileByPath(n.sourcePath);if(!(a instanceof D.TFile)||!/area/i.test(a.basename))return;let r=t.closest(".markdown-reading-view")||t.closest(".markdown-preview-view")||t.closest(".markdown-rendered")||t,s=new Dt(this.app,a,r);n.addChild(s)}};var _=require("obsidian");var Ht=class extends _.MarkdownRenderChild{constructor(n,a,r){super(r);this.appRef=n;this.fileRef=a}populateGoals(n,a,r){let s=Array.from(new Set(V(r,["\u270D\uFE0Fmy goals","my goals"],d=>this.queryGoalLinks(d),d=>this.resolveGoalFileFromEl(d),"goal")));console.log("[goal] collectKindFromThisPage ->",s.length,"paths");let i=new Set(s);console.log("[goal] nativePaths count:",s.length),s.length&&console.log("[goal] nativePaths sample:",s.slice(0,10));let c=["Q1","Q2","Q3","Q4"];return Xe({grid:n,keys:c,selectors:c.map(d=>({key:d,ctx:{year:a,q:d}})),nativeSet:i,clearColumns:!0,filesFor:({ctx:d})=>{let{year:o,q:l}=d;return this.appRef.vault.getMarkdownFiles().filter(u=>{if($(u.basename)!=="goal")return!1;let p=this.appRef.metadataCache.getFileCache(u)?.frontmatter;return Ke(p,o).some(h=>h===`Y${o}${l}`)})},dedupeKey:d=>Ge(d.path),isNative:d=>i.has(d.path),createCard:(d,o)=>{let l=d.basename.trim(),u=o?"native":"external";console.log("[goal] createCard",{path:d.path,origin:u});let p=X(this.appRef,l,d.path,{origin:u,payloadKey:"text/x-goal-path"});return console.log("[goal] card element after makeCard",{path:d.path,datasetOrigin:p.dataset.origin,hasExternalClass:p.classList.contains("is-external"),classList:Array.from(p.classList)}),o||p.classList.add("is-external"),p}})}pruneScheduledLinksUnderGoals(n){let a=Y(n,"\u270D\uFE0Fmy goals")||Y(n,"my goals");if(!a)return;let r=null;for(let c=a.nextElementSibling;c;c=c.nextElementSibling)if(/^H[1-6]$/i.test(c.tagName)||c.hasAttribute("data-heading")){r=c;break}let s=c=>{let d=!!(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING),o=!r||!!(c.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING);return d&&o},i=()=>{let d=this.queryGoalLinks(n).filter(s);for(let o of d){let l=this.resolveGoalFileFromEl(o);if(!(l instanceof _.TFile)||$(l.basename)!=="goal")continue;let u=this.appRef.metadataCache.getFileCache(l)?.frontmatter,p=Ke(u);p.length>0?(o.classList.add("wm-goal-link--scheduled"),o.setAttribute("data-quarter",p[0]||""),o.tagName.toLowerCase()==="a"&&o.setAttribute("draggable","false")):(o.classList.remove("wm-goal-link--scheduled"),o.removeAttribute("data-quarter"),o.tagName.toLowerCase()==="a"&&o.setAttribute("draggable","true"))}};requestAnimationFrame(()=>{i(),window.setTimeout(i,150)}),window.setTimeout(()=>{try{let d=n.querySelector(".wm-unscheduled")?.children.length??0;this.queryGoalLinks(n).length>0&&d===0&&this.doRender()}catch{}},500)}bindMyGoalsAnchors(n){Ve({root:n,queryLinks:this.queryGoalLinks.bind(this),scheduledClass:"wm-goal-link--scheduled",kind:"goal",dataMime:"text/x-goal-path",app:this.appRef,fileRef:this.fileRef})}onload(){ge();let n=I(this.containerEl);qe({app:this.appRef,fileRef:this.fileRef,containerEl:this.containerEl,getNoteContainer:I,render:this.doRender.bind(this),reAnnotate:this.reAnnotateFresh.bind(this),registerEvent:a=>this.registerEvent(a)}),Ue(n,()=>this.reAnnotateFresh()),ze(n,{resolveFileFromEl:this.resolveGoalFileFromEl.bind(this),scheduledClass:"wm-goal-link--scheduled",payloadKey:"text/x-goal-path",bindKey:"__wmBridgeBound_goal"}),this.doRender(),this.reAnnotateFresh()}doRender(){ge();let n=I(this.containerEl),a=Y(n,"quarterly schedule")||Y(n,"my quarterly schedule");if(!a)return;let r=n.querySelector(".wm-quarter-grid-mount")||Qe(a,"wm-quarter-grid-mount");r.innerHTML="";let i=String(new Date().getFullYear()),c=document.createElement("div");c.classList.add("wm-year-instruction"),c.textContent="Drag your Goal links to the columns below.",r.appendChild(c);let d=this.renderQuarterGrid(i);r.appendChild(d.wrapper),d.wrapper.style.gridTemplateColumns="1fr 1fr 1fr 1fr 1fr";let o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div");o.classList.add("wm-year-col"),o.classList.add("wm-year-col--unscheduled"),l.classList.add("wm-year-col--header"),l.textContent="Unscheduled",u.classList.add("wm-year-col--body","wm-unscheduled"),u.setAttribute("data-quarter","unscheduled"),u.style.pointerEvents="auto",u.style.position="relative",o.appendChild(l),o.appendChild(u),d.wrapper.insertBefore(o,d.wrapper.firstChild),u.addEventListener("dragenter",g=>{u.classList.add("is-dragover");let m=g.dataTransfer;(m?.getData("text/x-origin")||"")!=="external"&&m&&(m.dropEffect="copy")}),u.addEventListener("dragover",g=>{g.preventDefault(),g.stopPropagation(),u.classList.add("is-dragover");let m=g.dataTransfer;m&&(m.dropEffect="copy")}),u.addEventListener("drop",async g=>{g.preventDefault(),g.stopPropagation(),u.classList.remove("is-dragover");let m=g.dataTransfer;if((m?.getData("text/x-origin")||"")==="external")return;let v=m?.getData("text/x-goal-path")||m?.getData("text/plain")||m?.getData("text/uri-list")||"";if(v&&!v.endsWith(".md")){let b=this.appRef.metadataCache.getFirstLinkpathDest(v,this.fileRef.path);b instanceof _.TFile&&(v=b.path)}if(!v)return;let y=this.appRef.vault.getAbstractFileByPath(v);y instanceof _.TFile&&await this.appRef.fileManager.processFrontMatter(y,b=>{let k=(Array.isArray(b?.tags)?b.tags.slice():typeof b?.tags=="string"?[b.tags]:[]).filter(H=>!/^#?Y\d{4}-Q[1-4]$/i.test(H)&&!/^#?Y\d{4}Q[1-4]$/i.test(H));k.length?b.tags=k:delete b.tags}),this.doRender()});let p=0,h=V(n,["\u270D\uFE0Fmy goals","my goals"],g=>this.queryGoalLinks(g),g=>this.resolveGoalFileFromEl(g),"goal");for(let g of h){let m=this.appRef.vault.getAbstractFileByPath(g);if(!(m instanceof _.TFile)||$(m.basename)!=="goal")continue;let w=this.appRef.metadataCache.getFileCache(m)?.frontmatter;if(Ke(w).length>0)continue;let y=X(this.appRef,m.basename.trim(),m.path,{origin:"native",payloadKey:"text/x-goal-path"});y.setAttribute("draggable","true"),u.appendChild(y)}p>0?l.textContent=`\u26A0\uFE0F Unscheduled (${p})`:l.textContent="Unscheduled";let f=this.populateGoals(d,i,n);for(let g of["Q1","Q2","Q3","Q4"]){let m=d.columns[g];if(!m)continue;let w=f[g]??0;m.header.textContent=w>0?`${i} ${g} (${w})`:`${i} ${g}`}}reAnnotateFresh(){let n=I(this.containerEl);if(n)try{this.pruneScheduledLinksUnderGoals(n),this.bindMyGoalsAnchors(n)}catch{}}getLinkpathFromEl(n){return Ee(n)}resolveGoalFileFromEl(n){return Je(this.appRef,this.fileRef,n,"goal",{emojiPrefix:"\u{1F3AF}",labelPrefix:"Goal"})}queryGoalLinks(n){return Ze(n,"goal",this.resolveGoalFileFromEl.bind(this))}renderQuarterGrid(n){return et(this.appRef,this.fileRef,{keys:["Q1","Q2","Q3","Q4"],headerFor:a=>`${n} ${a}`,dataAttrFor:a=>({name:"data-quarter",value:`${n}${a}`}),payloadKey:"text/x-goal-path",onDrop:async(a,{key:r})=>{await this.onDropGoalToQuarter(a,n,r),this.doRender(),this.reAnnotateFresh()}})}createCard(n,a){return X(this.appRef,n.basename.trim(),n.path,{origin:a?"native":"external",payloadKey:"text/x-goal-path"})}collectGoalsFromThisPage(n){return V(n,["\u270D\uFE0Fmy goals","my goals"],a=>this.queryGoalLinks(a),a=>this.resolveGoalFileFromEl(a),"goal",()=>this.collectGoalsFromCache())}collectGoalsFromCache(){let a=(this.appRef.metadataCache.getFileCache(this.fileRef)?.links??[]).map(i=>i.link).filter(Boolean),r=[];for(let i of a){let c=this.appRef.metadataCache.getFirstLinkpathDest(i,this.fileRef.path);c instanceof _.TFile&&$(c.basename)==="goal"&&r.push(c.path)}return Array.from(new Set(r))}async onDropGoalToQuarter(n,a,r){let s=this.appRef.vault.getAbstractFileByPath(n);if(s instanceof _.TFile){await this.appRef.fileManager.processFrontMatter(s,i=>{let c=`#Y${a}-${r}`,o=(Array.isArray(i?.tags)?i.tags.slice():typeof i?.tags=="string"?[i.tags]:[]).filter(l=>!/^#?Y\d{4}-Q[1-4]$/i.test(l)&&!/^#?Y\d{4}Q[1-4]$/i.test(l));o.push(c),i.tags=o});try{let i=this.appRef.metadataCache.getBacklinksForFile(s)?.data??{};for(let c of Object.keys(i)){let d=this.appRef.vault.getAbstractFileByPath(c);if(!(d instanceof _.TFile))continue;let o=$(d.basename);(o==="goal"||o==="project"||o==="task"||o==="wish")&&await this.appRef.fileManager.processFrontMatter(d,l=>{Me(l,String(a));let u=Array.isArray(l?.tags)?l.tags.slice():typeof l?.tags=="string"?[l.tags]:[],p=$e(u);p.length>0?l.tags=p:delete l.tags,o==="task"&&delete l.due})}}catch{}}}},nt=class{constructor(t){this.app=t}async postProcess(t,n){let a=this.app.vault.getAbstractFileByPath(n.sourcePath);if(!(a instanceof _.TFile)||$(a.basename)!=="wish")return;let r=t.closest(".markdown-reading-view")||t.closest(".markdown-preview-view")||t.closest(".markdown-rendered")||t,s=new Ht(this.app,a,r);n.addChild(s)}};var ot=require("obsidian");var at=class{constructor(){this.data={nodes:new Map,byType:{area:new Set,wish:new Set,goal:new Set,project:new Set,task:new Set},childrenOf:new Map,observersOf:new Map,unscheduled:{goal:0,project:0,task:0},ready:!1}}reset(){this.data.nodes.clear(),Object.keys(this.data.byType).forEach(t=>this.data.byType[t].clear()),this.data.childrenOf.clear(),this.data.observersOf.clear(),this.data.unscheduled={goal:0,project:0,task:0},this.data.ready=!1}get(){return this.data}markReady(){this.data.ready=!0}isReady(){return this.data.ready}upsertNode(t){this.data.nodes.set(t.path,t),t.type&&this.data.byType[t.type].add(t.path)}removeNode(t){let n=this.data.nodes.get(t);n?.type&&this.data.byType[n.type].delete(t),this.data.nodes.delete(t),this.data.childrenOf.delete(t),this.data.observersOf.delete(t);for(let a of this.data.childrenOf.values())a.delete(t);for(let a of this.data.observersOf.values())a.delete(t)}setPrimaryEdge(t,n){for(let[a,r]of this.data.childrenOf)r.delete(t);n&&(this.data.childrenOf.has(n)||this.data.childrenOf.set(n,new Set),this.data.childrenOf.get(n).add(t))}setObserverEdges(t,n){for(let[a,r]of this.data.observersOf)n.has(a)||r.delete(t);for(let a of n)this.data.observersOf.has(a)||this.data.observersOf.set(a,new Set),this.data.observersOf.get(a).add(t)}getNode(t){return this.data.nodes.get(t)}getByType(t){return[...this.data.byType[t]].map(n=>this.data.nodes.get(n)).filter(Boolean)}getUnscheduledCounts(){return{...this.data.unscheduled}}setUnscheduledCounts(t){this.data.unscheduled=t}};var Se={YEAR:/#year\/(\d{4})/i,QUARTER:/#quarter\/(\d{4}-Q[1-4])/i,MONTH:/#month\/(\d{4})-(\d{2})/i,WEEK:/#week\/(\d{4})-W(\d{2})/i,DUE:/#due\/(\d{4})-(\d{2})-(\d{2})/i};function Nt(e){let t={},n=e.match(Se.YEAR);n&&(t.year=n[1]);let a=e.match(Se.QUARTER);a&&(t.quarter=a[1]);let r=e.match(Se.MONTH);r&&(t.month=`${r[1]}-${r[2].padStart(2,"0")}`);let s=e.match(Se.WEEK);s&&(t.week=`${s[1]}-W${s[2].padStart(2,"0")}`);let i=e.match(Se.DUE);return i&&(t.due=`${i[1]}-${i[2].padStart(2,"0")}-${i[3].padStart(2,"0")}`),Le(t)}function Qn(e){return e?Nt(e):{}}function Un(e){let t=Le(e),n=[];return t.year&&n.push(`#year/${t.year}`),t.quarter&&n.push(`#quarter/${t.quarter}`),t.month&&n.push(`#month/${t.month}`),t.week&&n.push(`#week/${t.week}`),t.due&&n.push(`#due/${t.due}`),`<!-- wishmap: ${n.join(" ")} -->`}function Le(e){let t={};if(e.year&&/^\d{4}$/.test(e.year)&&(t.year=e.year),e.quarter&&/^\d{4}-Q[1-4]$/.test(e.quarter)&&(t.quarter=e.quarter),e.month&&/^\d{4}-\d{1,2}$/.test(e.month)){let[n,a]=e.month.split("-").map(Number);a>=1&&a<=12&&(t.month=`${n}-${String(a).padStart(2,"0")}`)}if(e.week&&/^\d{4}-W\d{1,2}$/.test(e.week)){let[n,a]=e.week.replace("W","").split("-").map(Number);a>=1&&a<=53&&(t.week=`${n}-W${String(a).padStart(2,"0")}`)}if(e.due&&/^\d{4}-\d{1,2}-\d{1,2}$/.test(e.due)){let[n,a,r]=e.due.split("-").map(Number);a>=1&&a<=12&&r>=1&&r<=31&&(t.due=`${n}-${String(a).padStart(2,"0")}-${String(r).padStart(2,"0")}`)}return t}function Rt(e){let t={due:Le({due:e}).due};if(!t.due)return t;let[n,a,r]=t.due.split("-").map(Number);return t.year=String(n),t.month=`${n}-${String(a).padStart(2,"0")}`,t.quarter=`${n}-Q${Math.floor((a-1)/3)+1}`,t.week=`${n}-W${String(is(new Date(n,a-1,r))).padStart(2,"0")}`,t}function zn(e,t){let n=["due","week","month","quarter","year"];for(let a of n){let r=e[a],s=t[a];if(!r&&!s)continue;if(r&&!s)return-1;if(!r&&s)return 1;let i=ss(a,r,s);if(i!==0)return i}return 0}function ss(e,t,n){switch(e){case"due":case"week":case"month":return t<n?-1:t>n?1:0;case"quarter":{let[a,r]=t.split("-Q").map(Number),[s,i]=n.split("-Q").map(Number);return a!==s?a<s?-1:1:r<i?-1:r>i?1:0}case"year":{let a=Number(t),r=Number(n);return a<r?-1:a>r?1:0}default:return 0}}function is(e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let n=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7)}function os(e){let t=e.trim().match(/^(?:\p{Emoji_Presentation}|\p{Emoji}\uFE0F)/u);return t?t[0]:void 0}function Xn(e){let t=os(e)||"",n=e.toLowerCase();if(t==="\u{1F331}"||n.startsWith("area "))return"area";if(t==="\u2728"||n.startsWith("wish "))return"wish";if(t==="\u{1F3AF}"||n.startsWith("goal "))return"goal";if(t==="\u{1F680}"||n.startsWith("project "))return"project";if(t==="\u{1F4CC}"||n.startsWith("task "))return"task"}function rt(e){let t=e.match(/<!--\s*wishmap:\s*([^>]*)-->/i);return t?t[0]:void 0}function Vn(e){let t=Nt(e),n=Qn(rt(e)??"");return{year:n.year??t.year,quarter:n.quarter??t.quarter,month:n.month??t.month,week:n.week??t.week,due:n.due??t.due}}function Jn(e){let t=new Set,n=/^(?:Parents?|Parent)\s*:\s*(.*)$/i,a=e.split(/\r?\n/);for(let r of a){let s=r.match(n);if(!s)continue;let i=s[1].match(/\[\[([^\]]+)\]\]/g)||[];for(let c of i){let d=c.slice(2,-2).trim();d&&t.add(d)}}return t}async function Zn(e,t){let n=new Set,r=(await e.vault.read(t)).match(/\[\[([^\]]+)\]\]/g)||[];for(let s of r){let i=s.slice(2,-2).trim();i&&n.add(i)}return n}async function st(e,t,n){let a=await e.vault.read(t),r=Un(n),s=rt(a),i=s?a.replace(s,r):a.trimEnd()+`

`+r+`
`;i!==a&&await e.vault.modify(t,i)}async function ta(e,t){let n=e.metadataCache.getFileCache(t)?.frontmatter??{},a={};if(typeof n.done=="boolean"&&(a.done=n.done),typeof n.status=="string"&&(a.status=n.status),typeof n.impact=="string"&&(a.impact=n.impact),ea(n.duration_hours)&&(a.durationHours=Number(n.duration_hours)),ea(n.budget)&&(a.budget=Number(n.budget)),typeof n.due=="string"){let r=cs(n.due);r&&(a.due=r)}return a}function ea(e){return typeof e=="number"||typeof e=="string"&&e.trim()!==""&&!Number.isNaN(Number(e))}function cs(e){let t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(t){let a=Number(t[1]),r=String(Number(t[2])).padStart(2,"0"),s=String(Number(t[3])).padStart(2,"0");return`${a}-${r}-${s}`}let n=new Date(e);if(!Number.isNaN(n.getTime())){let a=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${a}-${r}-${s}`}}function na(){let e=new at,t;return{async init(n){t=n,await this.rescanAll(),e.markReady(),console.debug("[WishMap] indexer ready")},async rescanAll(){e.reset();let n=t.vault.getMarkdownFiles();for(let a of n){let r=await Ot(t,a);r&&e.upsertNode(r)}for(let a of e.get().nodes.values())Yt(e,a);e.setUnscheduledCounts(it(e))},onFileCreate(n){!(n instanceof ot.TFile)||n.extension!=="md"||Ot(t,n).then(a=>{a&&(e.upsertNode(a),Yt(e,a),e.setUnscheduledCounts(it(e)))})},onFileModify(n){!(n instanceof ot.TFile)||n.extension!=="md"||Ot(t,n).then(a=>{a&&(e.upsertNode(a),Yt(e,a),e.setUnscheduledCounts(it(e)))})},onFileDelete(n){n instanceof ot.TFile&&(e.removeNode(n.path),e.setUnscheduledCounts(it(e)))},getStore(){return e}}}async function Ot(e,t){let n=t.basename,a=Xn(n);if(!a)return;let r=t.stat.mtime,s=await e.vault.read(t),i=Vn(s),c=rt(s),d=await ta(e,t),o=Jn(s);if(o.size===0){let p=await Zn(e,t);for(let h of p)o.add(h)}let l=new Set;for(let p of o){let h=e.metadataCache.getFirstLinkpathDest(p,t.path);h&&l.add(h.path)}return{path:t.path,basename:n,type:a,parents:l,primaryParent:void 0,secondaryParents:new Set,tags:i,yaml:d,conflicts:[],serviceLine:c,mtime:r}}function Yt(e,t){if(!t||!t.type)return;let n=[];for(let s of t.parents){let i=e.getNode(s);i&&ds(i.type,t.type)&&n.push(i)}if(n.length===0){t.primaryParent=void 0,t.secondaryParents=new Set,e.setPrimaryEdge(t.path,void 0),e.setObserverEdges(t.path,new Set);return}let a=ls(n);t.primaryParent=a?.path;let r=new Set(n.filter(s=>s.path!==t.primaryParent).map(s=>s.path));t.secondaryParents=r,e.setPrimaryEdge(t.path,t.primaryParent),e.setObserverEdges(t.path,r)}function ls(e){if(e.length===0)return;let t=e[0];for(let n=1;n<e.length;n++){let a=e[n],r=zn(t.tags,a.tags);(r>0||r===0&&a.mtime<t.mtime)&&(t=a)}return t}function ds(e,t){let n=["area","wish","goal","project","task"];return n.indexOf(e)<n.indexOf(t)}function it(e){let t=0,n=0,a=0;for(let r of e.get().nodes.values())r.type==="goal"&&!r.tags.year&&t++,r.type==="project"&&!r.tags.quarter&&n++,r.type==="task"&&!r.yaml?.due&&a++;return{goal:t,project:n,task:a}}function ra(){return{async run(e){for(let t of e.get().nodes.values())await aa(e,t.path)},async onNodeChange(e,t){await aa(e,t)}}}async function aa(e,t){let n=e.getNode(t);if(n){if(n.yaml.due){let a=us(n);await hs(e,n,a),n.primaryParent&&await ps(e,n.path)}n.primaryParent&&await ms(e,n.primaryParent)}}function us(e){return Rt(e.yaml.due)}async function hs(e,t,n){let a=_t(t.tags,n);if(jt(t.tags,a)){t.tags=a;let r=Wt(e,t.path);r&&(await st(window.app,r,t.tags),console.debug("[WishMap] service tags updated",{path:t.path,tags:t.tags}))}}function _t(e,t){let n={...e};return n.due=e.due??t.due,n.week=e.week??t.week,n.month=e.month??t.month,n.quarter=e.quarter??t.quarter,n.year=e.year??t.year,Le(n)}function jt(e,t){return JSON.stringify(e)!==JSON.stringify(t)}async function ps(e,t){let n=e.getNode(t);if(!n?.yaml.due)return;let a=Rt(n.yaml.due),r=n.primaryParent?e.getNode(n.primaryParent):void 0;for(;r;){let s={};r.tags.year||(s.year=a.year),r.tags.quarter||(s.quarter=a.quarter),r.tags.month||(s.month=a.month),r.tags.week||(s.week=a.week);let i=_t(r.tags,s);if(jt(r.tags,i)){r.tags=i;let c=Wt(e,r.path);c&&await st(window.app,c,r.tags),console.debug("[WishMap] Auto-filled parent from child due",{parent:r.path,tags:r.tags})}r=r.primaryParent?e.getNode(r.primaryParent):void 0}}async function ms(e,t){let n=e.getNode(t);if(!n)return;let a=e.get().childrenOf.get(t);if(a?.size)for(let r of a){let s=e.getNode(r);if(!s)continue;let i={};n.tags.year&&!s.tags.year&&(i.year=n.tags.year),n.tags.quarter&&!s.tags.quarter&&(i.quarter=n.tags.quarter),n.tags.month&&!s.tags.month&&(i.month=n.tags.month),n.tags.week&&!s.tags.week&&(i.week=n.tags.week);let c=_t(s.tags,i);if(jt(s.tags,c)){s.tags=c;let d=Wt(e,s.path);d&&await st(window.app,d,s.tags),console.debug("[WishMap] Top-down fill",{child:s.path,tags:s.tags})}}}function Wt(e,t){return window.app.vault.getAbstractFileByPath(t)}var Pe=require("obsidian");function sa(){let e,t;return{init(n,a){e=n,t=a},onNoteOpen(n){let a=t.getNode(n);if(a){if(a.type==="goal"&&!a.tags.year){new Pe.Notice("WishMap: Schedule this goal for a year.");return}if(a.type==="project"&&(a.primaryParent?t.getNode(a.primaryParent):void 0)?.tags.year&&!a.tags.quarter){new Pe.Notice("WishMap: Assign a quarter for this project.");return}a.type==="task"&&!a.yaml.due&&(gs(t,a).some(i=>!i.tags.year||!i.tags.quarter)?new Pe.Notice("WishMap: Set a due date. Parents are unscheduled, we'll fill them automatically."):new Pe.Notice("WishMap: Set a due date or week for this task."))}}}}function gs(e,t){let n=[];for(let a of t.parents){let r=e.getNode(a);r&&n.push(r)}return n}var ct=class extends F.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set;this.data={};this._openedDailyGuard=!1;this.indexer=na();this.inference=ra();this.prompts=sa()}async onload(){console.debug("[WishMap] loading\u2026"),await this.indexer.init(this.app),this.store=this.indexer.getStore(),await this.inference.run(this.store),this.prompts.init(this.app,this.store);let n=new nt(this.app);this.registerMarkdownPostProcessor((o,l)=>n.postProcess(o,l)),this.areaScheduler=new tt(this.app),this.registerMarkdownPostProcessor((o,l)=>{this.areaScheduler.postProcess(o,l)}),this.addCommand({id:"wishmap-refresh-area-schedule",name:"WishMap: Refresh Area Schedule",callback:()=>{let o=this.app.workspace.getActiveViewOfType(F.MarkdownView);if(!o)return;let l=o.getMode?.();o.setMode?.(l==="preview"?"source":"preview"),o.setMode?.("preview")}}),this.registerEvent(this.app.vault.on("create",async o=>{o instanceof F.TFile&&o.extension==="md"&&(this.indexer.onFileCreate(o),await this.inference.onNodeChange(this.store,o.path))})),this.registerEvent(this.app.vault.on("modify",async o=>{o instanceof F.TFile&&o.extension==="md"&&(this.indexer.onFileModify(o),await this.inference.onNodeChange(this.store,o.path))})),this.registerEvent(this.app.vault.on("delete",o=>{this.indexer.onFileDelete(o)})),this.registerEvent(this.app.workspace.on("file-open",o=>{o&&this.prompts.onNoteOpen(o.path)})),console.log("WishMap v0.2 loaded"),Et(this),console.log("[WishMap] rollup auto: setup called from main"),Bn(this),this.addCommand({id:"wishmap-generate-area-maps",name:"Generate Area Maps note",callback:async()=>{let o=await Kn(this.app),l=this.app.vault.getAbstractFileByPath(o);l&&this.app.workspace.getLeaf(!0).openFile(l)}}),this.addCommand({id:"wishmap-print-note",name:"Print (Export to PDF)",callback:()=>{this.app.commands.executeCommandById?.("markdown:export-pdf")}}),await this.loadSettings();let a=new Map,r=o=>{let l=o.path,u=a.get(l);u&&window.clearTimeout(u);let p=window.setTimeout(async()=>{a.delete(l),await ve(this.app,o)},300);a.set(l,p)};this.registerEvent(this.app.vault.on("create",async o=>{let l=o;!(l instanceof F.TFile)||l.extension!=="md"||window.setTimeout(async()=>{if(!ne(this.app,l))return;let u=K(this.app,l);for(let p of u)r(p)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async o=>{let l=o;if(!(l instanceof F.TFile)||l.extension!=="md"||!ne(this.app,l))return;let u=K(this.app,l);for(let p of u)r(p)})),this.addCommand({id:"project-rollup-duration-hours",name:"Project: Roll up duration_hours from linked tasks",callback:async()=>{}}),this.addCommand({id:"create-starter-structure",name:"Create Starter Structure",callback:async()=>{await Qt(this.app),new F.Notice("Starter structure created.")}}),Ut(this.app),this.registerEvent(this.app.vault.on("create",async o=>{let l=o instanceof F.TFile?o:null;if(!l||l.extension!=="md")return;let p=this.app.metadataCache.getFileCache(l)?.frontmatter;(p&&(p.type==="habit"||p.category==="habit")||/\bhabit\b/i.test(l.basename))&&await vn(this.app,l)})),this.registerEvent(this.app.workspace.on("file-open",async o=>{o&&await be(this.app,o)})),en(this.app),rn(this.app),Mn(this),An(this),this.addCommand({id:"open-today",name:"Open Today",callback:async()=>this.createOrOpenTodayDaily()}),this.addCommand({id:"run-habit-autolog",name:"Habit: Run Autolog for Scheduled Habits",callback:async()=>{await Tn(this.app),new F.Notice("Habit autolog completed.")}}),this.addCommand({id:"toggle-first-checkbox",name:"Toggle First Checkbox",callback:async()=>{let o=this.app.workspace.getActiveFile();if(!o)return new F.Notice("No active file.");await tn(this.app,o)}}),this.addCommand({id:"habit-add-today-line",name:"Habit: Append Today Line",callback:async()=>{let o=this.app.workspace.getActiveFile();if(!o)return new F.Notice("No active file.");await be(this.app,o)}}),this.addCommand({id:"wishmap-rescan",name:"WishMap: Rescan vault",callback:async()=>{new F.Notice("WishMap: Rescanning\u2026"),await this.indexer.rescanAll(),await this.inference.run(this.store),new F.Notice("WishMap: Rescan complete.")}}),this.addCommand({id:"wishmap-rebuild-inference",name:"WishMap: Rebuild inference",callback:async()=>{new F.Notice("WishMap: Rebuilding inference\u2026"),await this.inference.run(this.store),new F.Notice("WishMap: Inference rebuilt.")}});let s=!1;this.app.workspace.onLayoutReady(()=>{s||(this.ensureTodayDailyOpenOnce(),s=!0)}),this.registerEvent(this.app.metadataCache.on("resolved",()=>{s||(this.ensureTodayDailyOpenOnce(),s=!0)})),console.log("WishMap ready");let i=new Map,c=(o,l=300)=>{let u=o.path,p=i.get(u);p&&window.clearTimeout(p);let h=window.setTimeout(async()=>{i.delete(u),await ve(this.app,o)},l);i.set(u,h)},d=(o,l=1500)=>new Promise(u=>{let p=!1,h=()=>{p||(p=!0,u())},f=this.app.metadataCache.on("changed",g=>{g?.path===o&&(this.app.metadataCache.offref(f),h())});window.setTimeout(()=>{this.app.metadataCache.offref(f),h()},l)});this.registerEvent(this.app.vault.on("create",async o=>{let l=o;!(l instanceof F.TFile)||l.extension!=="md"||window.setTimeout(async()=>{if(!ne(this.app,l))return;await d(l.path,1500);let u=K(this.app,l);for(let p of u)c(p,200)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async o=>{let l=o;if(!(l instanceof F.TFile)||l.extension!=="md"||!ne(this.app,l))return;let u=K(this.app,l);for(let p of u)c(p,200)})),this.registerEvent(this.app.metadataCache.on("changed",async o=>{let l=o;!(l instanceof F.TFile)||l.extension!=="md"||U(this.app,l)&&c(l,200)})),Et(this)}onunload(){console.log("WishMap unloaded")}async openRouted(n){switch(n.type){case"task":await gn(this.app,n.name??"");break;case"project":await fn(this.app,n.name??"");break;case"goal":await yn(this.app,n.name??"");break;case"daily":await we(this.app);break}}todayISO(){return window.moment().format("YYYY-MM-DD")}pathForTodayDaily(){let n=window.moment(),a=n.format("YYYY-MM-DD"),r=n.format("dddd");return`02 Execution/1 Daily/${a} ${r}.md`}async createOrOpenTodayDaily(){let n=(0,F.normalizePath)(this.pathForTodayDaily()),a=this.app.vault.getAbstractFileByPath(n);if(a instanceof F.TFile){await this.app.workspace.getLeaf(!0).openFile(a);return}let s=this.app.vault.getAbstractFileByPath("03 SaveBox/Templates/Daily Template.md"),i="";s instanceof F.TFile&&(i=await this.app.vault.read(s),i=i.replace(/{{date}}/g,this.todayISO()));let c=await this.app.vault.create(n,i);await this.app.workspace.getLeaf(!0).openFile(c),console.log("Created today\u2019s daily:",n)}async ensureTodayDailyOpenOnce(){if(this._openedDailyGuard)return;let n=this.todayISO(),a=(0,F.normalizePath)(this.pathForTodayDaily()),r=this.app.vault.getAbstractFileByPath(a);if(r instanceof F.TFile){await this.app.workspace.getLeaf(!0).openFile(r),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings();return}await this.createOrOpenTodayDaily(),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings()}async loadSettings(){let n=await this.loadData();this.data=n??{}}async saveSettings(){await this.saveData(this.data)}};
