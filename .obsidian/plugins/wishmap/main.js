/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var mt=Object.defineProperty;var fa=Object.getOwnPropertyDescriptor;var ya=Object.getOwnPropertyNames;var wa=Object.prototype.hasOwnProperty;var ba=(e,n)=>{for(var t in n)mt(e,t,{get:n[t],enumerable:!0})},va=(e,n,t,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of ya(n))!wa.call(e,r)&&r!==t&&mt(e,r,{get:()=>n[r],enumerable:!(a=fa(n,r))||a.enumerable});return e};var Ta=e=>va(mt({},"__esModule",{value:!0}),e);var Fs={};ba(Fs,{default:()=>pt});module.exports=Ta(Fs);var $=require("obsidian");var wt=require("obsidian");var Ae=require("obsidian");async function Xt(e,n,t,a){let r=await e.vault.read(n),i=new RegExp(String.raw`^#{1,6}.*?\b${t.replace(/\s+/g,"\\s+")}\b.*$`,"im").exec(r);if(!i)return;let c=i.index+i[0].length,o=r.slice(c).split(/\r?\n/),l=h=>/^#{1,6}\s/.test(h);for(let h=0;h<o.length;h++){let p=o[h];if(l(p)){o.splice(h,0,a);let g=r.slice(0,c)+o.join(`
`);g!==r&&await e.vault.modify(n,g);return}if(p.trim()!==""){if(p!==a){o[h]=a;let g=r.slice(0,c)+o.join(`
`);g!==r&&await e.vault.modify(n,g)}return}}if(o.length===0){let h=r.slice(0,c)+a;h!==r&&await e.vault.modify(n,h);return}o[0]=a;let u=r.slice(0,c)+o.join(`
`);u!==r&&await e.vault.modify(n,u)}function xa(e,n,t){let a=e.metadataCache.getFileCache(n);if(!a?.headings)return null;let r=l=>l.trim().toLowerCase(),s=r(t),i=a.headings.sort((l,u)=>l.position.start.line-u.position.start.line),c=i.findIndex(l=>r(l.heading)===s);if(c===-1)return null;let d=i[c].position.end.line+1,o=c<i.length-1?i[c+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:d,endLine:o}}async function Vt(e,n,t,a){let r=xa(e,n,t);if(!r)return!1;let i=(await e.vault.read(n)).split(`
`),c=Math.min(r.startLine,i.length-1),d=Math.min(r.endLine,i.length-1),o=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let l=c;l<=d;l++){let u=i[l].match(o);if(!u)continue;let p=`- [${u[1]==="x"||u[1]==="X"?"x":" "}] ${a}`;return i[l]!==p&&(i[l]=p,await e.vault.modify(n,i.join(`
`))),!0}return!1}function G(e=new Date){let n=e.getTimezoneOffset();return new Date(e.getTime()-n*6e4).toISOString().slice(0,10)}function ka(e=new Date){return e.toLocaleDateString(void 0,{weekday:"long"})}function Fa(e=new Date){return e.toLocaleDateString(void 0,{month:"short"})}function Ma(e=new Date){return e.getFullYear()}function Aa(e=new Date){return Math.floor(e.getMonth()/3)+1}function Ea(e=new Date){let n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));let t=new Date(Date.UTC(n.getUTCFullYear(),0,1));return Math.ceil(((+n-+t)/864e5+1)/7)}function gt(e,n,t=new Date){let a=G(t),r=e;return r=r.replace(/{{\s*title\s*}}/gi,n),r=r.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,s=>a),r=r.replace(/{{\s*dateLong\s*}}/gi,t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),r=r.replace(/{{\s*weekday\s*}}/gi,ka(t)),r=r.replace(/{{\s*monthShort\s*}}/gi,Fa(t)),r=r.replace(/{{\s*year\s*}}/gi,String(Ma(t))),r=r.replace(/{{\s*isoWeek\s*}}/gi,String(Ea(t))),r=r.replace(/{{\s*quarter\s*}}/gi,String(Aa(t))),r}function $a(e,n){let t=(0,Ae.normalizePath)(n);return e.vault.getAbstractFileByPath(t)??null}async function _e(e,n){let t=(0,Ae.normalizePath)(n).split("/"),a="";for(let r of t)a=a?`${a}/${r}`:r,e.vault.getAbstractFileByPath(a)||await e.vault.createFolder(a)}async function I(e,n,t){let a=(0,Ae.normalizePath)(n);if(!$a(e,a)){let s=a.split("/").slice(0,-1).join("/");s&&await _e(e,s),await e.vault.create(a,t)}}var je=require("obsidian");var q="03 SaveBox/Templates",ft={area:`${q}/Area Template.md`,wish:`${q}/Wish Template.md`,goal:`${q}/Goal Template.md`,project:`${q}/Project Template.md`,task:`${q}/Task Template.md`,habit:`${q}/Habit Template.md`,note:`${q}/Note Template.md`,daily:`${q}/Daily Template.md`,weekly:`${q}/Weekly Template.md`,monthly:`${q}/Monthly Template.md`,quarterly:`${q}/Quarterly Template.md`,yearly:`${q}/Yearly Template.md`},yt={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function Ee(e,n,t,a=new Date){let r=(0,je.normalizePath)(ft[n]),s=e.vault.getAbstractFileByPath(r);if(s instanceof je.TFile){console.log(`[MMOS] Using VAULT template for ${n}: ${r}`);let i=await e.vault.read(s);return gt(i,t,a)}return console.log(`[MMOS] Using FALLBACK template for ${n}`),gt(yt[n],t,a)}var Sa="03 SaveBox/Templates";async function La(e,n){let t=e.vault.getMarkdownFiles().filter(s=>s.path.startsWith(Sa+"/")),a=s=>s.toLowerCase().trim().replace(/^[^a-z0-9]+/,""),r=t.find(s=>new RegExp(`^${n}(\\s|:|-|_)`,"i").test(a(s.basename)));return r?e.vault.read(r):""}async function Zt(e,n){let{kind:t,title:a}=n,r=n.path??Pa(t,a),s=r.substring(0,r.lastIndexOf("/"));s&&await _e(e,s);let i;if(t==="note"){if(i=await La(e,"note"),!i){let d=r.split("/").pop().replace(/\.md$/i,"");i=`---
created: ${G(new Date)}
status: Active
---
# ${d}
`}}else i=await Ee(e,t,a,new Date);let c=await e.vault.create(r,i);return await e.fileManager.processFrontMatter(c,d=>{d.created??(d.created=G(new Date)),t==="task"?(d.status??(d.status="Active"),d.impact??(d.impact="Med"),d.slot??(d.slot="Morning"),d.done??(d.done=!1),d.priority??(d.priority="Medium")):t==="goal"||t==="project"||t==="habit"?(d.status??(d.status="Active"),d.done??(d.done=!1),d.priority??(d.priority="Medium")):t==="area"&&(d.status??(d.status="Active"))}),c}async function en(e){let n=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let t of n)await _e(e,t);await I(e,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await I(e,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await I(e,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await I(e,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await I(e,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[t,a]of Object.entries(ft))await I(e,a,yt[t]);await I(e,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${G(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await I(e,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${G(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await I(e,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${G(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await I(e,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${G(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await I(e,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new wt.Notice("\u2705 MindMap OS: starter structure updated.")}function Pa(e,n){let t=Ca(n);switch(e){case"daily":return`02 Execution/1 Daily/${t}.md`;case"weekly":return`02 Execution/2 Weekly/${t}.md`;case"monthly":return`02 Execution/3 Monthly/${t}.md`;case"quarterly":return`02 Execution/4 Quarterly/${t}.md`;case"yearly":return`02 Execution/5 Yearly/${t}.md`;case"note":return`03 SaveBox/Active/${Jt("note")}${t}.md`;default:return`03 SaveBox/Active/${Jt(e)}${t}.md`}}function Jt(e){switch(e){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";case"note":return"\u270F\uFE0FNote - ";default:return""}}function Ca(e){return e.replace(/[\\/:*?"<>|]/g,"").trim()}var ye=require("obsidian");var Da=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],bt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - ",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function Ha(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ra(e,n){let a=new RegExp(`^#{1,6}\\s+${Ha(n)}\\s*$`,"gim").exec(e);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,i=new RegExp(`^#{1,${s}}\\s+`,"gim");i.lastIndex=r;let c=i.exec(e);return{start:r,end:c?c.index:e.length}}function Oa(e,n){let t=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,a=e.slice(n.start,n.end);t.lastIndex=0;let r=t.exec(a);if(!r)return null;let s=n.start+r.index,i=s+r[0].length,c=/\[(x|X)\]/.test(r[0]);return{absStart:s,absEnd:i,line:r[0],checked:c}}async function Na(e,n){for(let t=0;t<25;t++){if(e.metadataCache.getFileCache(n)?.headings?.length)return;await new Promise(r=>setTimeout(r,40))}}async function Ya(e,n,t,a){await Na(e,n);let r=await e.vault.read(n),s=Ra(r,t);if(!s)return!1;let i=Oa(r,s);if(!i)return!1;let d=`- [${/\[(x|X)\]/.test(i.line)?"x":" "}] ${a}`;if(i.line.trimEnd()===d)return!0;let o=r.slice(0,i.absStart)+d+r.slice(i.absEnd);return o!==r&&await e.vault.modify(n,o),!0}function _a(e){return e==="task"?"My Task":e==="project"?"My Project":"My Goal"}function ja(e){return e instanceof ye.TFile&&e.extension.toLowerCase()==="md"}function Wa(e){let n=e.match(/^(\w+)\s*(?:[-â€“]\s*|\s+)(.+)$/i);if(!n)return null;let t=n[1].toLowerCase();if(!Da.includes(t))return null;let a=n[2].trim();return{kind:t,title:a}}function Ba(e,n){let t=Ia(n);switch(e){case"daily":return`02 Execution/1 Daily/${t}.md`;case"weekly":return`02 Execution/2 Weekly/${t}.md`;case"monthly":return`02 Execution/3 Monthly/${t}.md`;case"quarterly":return`02 Execution/4 Quarterly/${t}.md`;case"yearly":return`02 Execution/5 Yearly/${t}.md`;case"note":return`03 SaveBox/Active/${bt.note}${t}.md`;default:return`03 SaveBox/Active/${bt[e]}${t}.md`}}function Ia(e){return e.replace(/[\\/:*?"<>|]/g,"").trim()}async function qa(e,n,t){await e.fileManager.processFrontMatter(n,a=>{a.created??(a.created=G(new Date)),t==="task"?(a.status??(a.status="Active"),a.impact??(a.impact="Medium"),a.slot??(a.slot="Morning"),a.done??(a.done=!1),a.duration_hours??(a.duration_hours=void 0),a.tags??(a.tags=[])):t==="goal"||t==="project"||t==="habit"?(a.status??(a.status="Active"),a.done??(a.done=!1)):t==="area"&&(a.status??(a.status="Active"))})}function tn(e){e.vault.on("create",async n=>{try{if(!ja(n)||(await e.vault.read(n)).trim().length>0)return;let a=n.basename,r=Wa(a);if(!r)return;let{kind:s,title:i}=r,c;s==="note"?(c=await Ee(e,"note",i,new Date),c||(c=`---
created: ${G(new Date)}
status: Active
---
# \u270F\uFE0FNote - ${i}
`)):c=await Ee(e,s,i,new Date),await e.vault.modify(n,c),await qa(e,n,s);let d=(0,ye.normalizePath)(Ba(s,i));if(d!==n.path&&await e.fileManager.renameFile(n,d),s==="area"||s==="wish"){let o=e.vault.getAbstractFileByPath(d),l=o instanceof ye.TFile?o:n,u=l.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),h=`${bt[s]}${u}`,p=s==="area"?"My Area":"My Wish";console.log("[MMOS][wikilinks] finalize",{kind:s,formatted:h,path:l.path}),await Xt(e,l,p,h)}if(s==="task"||s==="project"||s==="goal"){let o=e.vault.getAbstractFileByPath(d),l=o instanceof ye.TFile?o:n,u=_a(s),h=l.basename;await Ya(e,l,u,h)}console.log(`[MMOS] wikilink routed \u2192 ${s} | ${i}`)}catch(t){console.error("[MMOS] wikilink routing error",t)}}),console.log("MMOS wikilink watcher: ON")}var an=require("obsidian");function Ga(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ka(e,n){let t=null;return(...a)=>{t&&window.clearTimeout(t),t=window.setTimeout(()=>{t=null,e(...a)},n)}}function rn(e,n){let a=new RegExp(`^#{1,6}\\s+${Ga(n)}\\s*$`,"gim").exec(e);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,i=new RegExp(`^#{1,${s}}\\s+`,"gim");i.lastIndex=r;let c=i.exec(e);return{start:r,end:c?c.index:e.length}}var nn=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function sn(e,n){let t=e.slice(n.start,n.end);nn.lastIndex=0;let a=nn.exec(t);if(!a)return null;let r=n.start+a.index,s=r+a[0].length,i=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:s,line:a[0],checked:i}}function on(e,n){return e.replace(/\[(?: |x|X)\]/,n?"[x]":"[ ]")}var Qa=2e3;function Ua(e){return/(^|\/)(templates?|Templates?)(\/|$)/.test(e)}function za(e){return e?.template===!0||e?.is_template===!0||e?.type==="template"}function Xa(e){return/<%[\s\S]*?%>/.test(e)}function Va(e){let n=e?.stat?.ctime??0;return Date.now()-n<Qa}function cn(e,n){let t=new Set,a=e.vault.on("modify",o=>{t.has(o.path)&&e?.notifier?.hideAll&&e.notifier.hideAll()}),r=o=>{let l=e.workspace.getActiveViewOfType(an.MarkdownView),h=!!l&&l.file?.path===o.path&&l?.getMode()!=="preview";return{editor:l?.editor,inEdit:h}},s=async(o,l)=>{t.add(o.path);try{await e.fileManager.processFrontMatter(o,u=>{for(let h of Object.keys(l))u[h]=l[h]})}finally{t.delete(o.path)}},i=async(o,l,u,h,p)=>{let{editor:g,inEdit:y}=r(o);t.add(o.path);try{if(y&&g){let m=g.offsetToPos(u),b=g.offsetToPos(h);await new Promise(requestAnimationFrame),g.replaceRange(p,m,b)}else{let m=l.slice(0,u)+p+l.slice(h);m!==l&&await e.vault.modify(o,m)}}finally{t.delete(o.path)}},d=Ka(async()=>{let o=e.workspace.getActiveFile();if(!o||n?.(o)||Ua(o.path))return;let u=(e.metadataCache.getFileCache(o)??{}).frontmatter??{};if(za(u))return;let{editor:h,inEdit:p}=r(o),g=p&&h?h.getValue():await e.vault.read(o);if(!g||Xa(g)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(g)||Va(o)||t.has(o.path))return;let m=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let b of m){let w=rn(g,b.heading);if(!w)continue;let f=sn(g,w);if(!f)continue;let v=typeof u.done=="boolean"?u.done:null,M=typeof u[b.flag]=="boolean"?u[b.flag]:null,T=f.checked;if(M===null){await s(o,{done:!!T,[b.flag]:!!T});return}let F=v!==null&&v!==M;if(T!==M){await s(o,{done:!!T,[b.flag]:!!T});return}if(F){let C=on(f.line,!!v);await i(o,g,f.absStart,f.absEnd,C),await s(o,{[b.flag]:!!v});return}return}},150);e.workspace.on("file-open",()=>d()),e.workspace.on("active-leaf-change",()=>d()),e.workspace.on("layout-change",()=>d()),e.workspace.on("editor-change",()=>d()),e.metadataCache.on("changed",()=>d()),e.metadataCache.on("resolved",()=>d()),e.vault.on("modify",()=>d()),e.vault.on("rename",()=>d()),e.vault.on("create",()=>d())}async function ln(e,n){let a=(e.metadataCache.getFileCache(n)??{}).frontmatter??{},r=!(typeof a.done=="boolean"&&a.done);await e.fileManager.processFrontMatter(n,c=>{c.done=r});let s=await e.vault.read(n),i=["My Task","My Project","My Goal"];for(let c of i){let d=rn(s,c);if(!d)continue;let o=sn(s,d);if(!o)continue;let l=on(o.line,r),u=s.slice(0,o.absStart)+l+s.slice(o.absEnd);u!==s&&await e.vault.modify(n,u);break}}var un=require("obsidian");function Ja(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Za(e,n){let t=null;return(...a)=>{t&&window.clearTimeout(t),t=window.setTimeout(()=>{t=null,e(...a)},n)}}function er(e){return/(^|\/)(templates?|Templates?)(\/|$)/.test(e)}function tr(e){return/<%[\s\S]*?%>/.test(e)}function nr(e,n=1500){let t=e?.stat?.ctime??0;return Date.now()-t<n}function ar(e,n,t,a){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(e)||/^habit template(\.md)?$/i.test(n)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(n)||a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(t))}function rr(e,n){let t=n.map(Ja).join("|"),r=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${t})\\s*$`,"gim").exec(e);if(!r)return null;let s=r.index+r[0].length,i=(r[0].match(/^#+/)||["#"])[0].length,c=new RegExp(`^#{1,${i}}\\s+`,"gim");c.lastIndex=s;let d=c.exec(e);return{start:s,end:d?d.index:e.length}}var dn=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function sr(e,n){let t=e.slice(n.start,n.end);dn.lastIndex=0;let a=dn.exec(t);if(!a)return null;let r=n.start+a.index,s=r+a[0].length,i=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:s,line:a[0],checked:i}}function ir(e,n){return e.replace(/\[(?: |x|X)\]/,n?"[x]":"[ ]")}function hn(e,n){let t=new Set,a=d=>{let o=e.workspace.getActiveViewOfType(un.MarkdownView),u=!!o&&o.file?.path===d.path&&o?.getMode()!=="preview";return{editor:o?.editor,inEdit:u}},r=async(d,o)=>{t.add(d.path);try{await e.fileManager.processFrontMatter(d,l=>{for(let u of Object.keys(o))l[u]=o[u]})}finally{t.delete(d.path)}},s=async(d,o,l,u,h)=>{let{editor:p,inEdit:g}=a(d);t.add(d.path);try{if(g&&p){let y=p.offsetToPos(l),m=p.offsetToPos(u);await new Promise(requestAnimationFrame),p.replaceRange(h,y,m)}else{let y=o.slice(0,l)+h+o.slice(u);y!==o&&await e.vault.modify(d,y)}}finally{t.delete(d.path)}},c=Za(async()=>{let d=e.workspace.getActiveFile();if(!d||n?.(d)||er(d.path)||nr(d)||t.has(d.path))return;let l=(e.metadataCache.getFileCache(d)??{}).frontmatter??{},{editor:u,inEdit:h}=a(d),p=h&&u?u.getValue():await e.vault.read(d);if(!p||tr(p)||!ar(d.path,d.basename,p,l))return;let g=rr(p,["\u270D\uFE0F Log","Log"]);if(!g)return;let y=sr(p,g),m=typeof l.done=="boolean"?l.done:null,b=typeof l._habit_sync_state=="boolean"?l._habit_sync_state:null;if(!y&&m===null)return;if(b===null){y?await r(d,{done:!!y.checked,_habit_sync_state:!!y.checked}):m!==null&&await r(d,{_habit_sync_state:!!m});return}let w=y?y.checked:null,f=m!==null&&m!==b;if(w!==null&&w!==b){await r(d,{done:!!w,_habit_sync_state:!!w});return}if(f&&y){let M=ir(y.line,!!m);await s(d,p,y.absStart,y.absEnd,M),await r(d,{_habit_sync_state:!!m});return}},150);e.workspace.on("file-open",()=>c()),e.workspace.on("active-leaf-change",()=>c()),e.workspace.on("layout-change",()=>c()),e.workspace.on("editor-change",()=>c()),e.metadataCache.on("changed",()=>c()),e.metadataCache.on("resolved",()=>c()),e.vault.on("modify",()=>c()),e.vault.on("rename",()=>c()),e.vault.on("create",()=>c())}var z=require("obsidian");var Be={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - "},or="03 SaveBox/Templates";function wn(e){return e.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim()}function pn(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}async function bn(e,n,t,a){let s=(await e.vault.read(n)).split(/\r?\n/),i=pn(t),c=-1;for(let g=0;g<s.length;g++)if(/^#{1,6}\s/.test(s[g])&&pn(s[g]).includes(i)){c=g;break}if(console.log("[MMOS][writer] target header:",t,"| found index:",c),c===-1){console.warn("[MMOS][writer] header not found in",n.path);return}let d=g=>/^\s*$/.test(g),o=g=>/^\s*(?:-{3,}|_{3,}|\*{3,})\s*$/.test(g),l=c+1;for(;l<s.length&&(d(s[l])||o(s[l]));)l++;let u=l>=s.length||/^#{1,6}\s/.test(s[l]);console.log("[MMOS][writer] insert/replace at line:",l,"| nextIsHeader:",u,"| writing:",a),u?(s.splice(l,0,a),await e.vault.modify(n,s.join(`
`))):s[l]!==a?(console.log("[MMOS][writer] replacing existing line:",JSON.stringify(s[l])),s[l]=a,await e.vault.modify(n,s.join(`
`))):console.log("[MMOS][writer] already correct, skipping write");let p=(await e.vault.read(n)).split(/\r?\n/)[l]??"";console.log("[MMOS][writer] post-write line:",JSON.stringify(p))}async function mn(e,n){for(let r=0;r<25&&!e.metadataCache.getFileCache(n)?.headings?.length;r++)await new Promise(i=>setTimeout(i,40));let t=wn(n.basename),a=`${Be.area}${t}`;console.log("[MMOS][finalizeArea]",{path:n.path,basename:n.basename,core:t,formatted:a}),await bn(e,n,"My Area",a)}async function gn(e,n){for(let r=0;r<25&&!e.metadataCache.getFileCache(n)?.headings?.length;r++)await new Promise(i=>setTimeout(i,40));let t=wn(n.basename),a=`${Be.wish}${t}`;console.log("[MMOS][finalizeWish]",{path:n.path,basename:n.basename,core:t,formatted:a}),await bn(e,n,"My Wish",a)}function We(e){return e.replace(/[\\/:*?"<>|]/g,"").trim()}function vn(e){return e.trim().split(/\s+/).map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}function cr(e){let n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));let t=new Date(Date.UTC(n.getUTCFullYear(),0,1)),a=Math.ceil(((n.getTime()-t.getTime())/864e5+1)/7);return{isoYear:n.getUTCFullYear(),week:a}}async function Tn(e,n){let t=(0,z.normalizePath)(n).split("/"),a="";for(let r of t){a=a?`${a}/${r}`:r;try{await e.vault.createFolder(a)}catch{}}}function we(e,n){let t=e.vault.getAbstractFileByPath((0,z.normalizePath)(n));return t instanceof z.TFile?t:null}function lr(e,n){let t=new Date;switch(e){case"daily":return`02 Execution/1 Daily/${`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}.md`}`;case"weekly":{let{isoYear:a,week:r}=cr(t);return`02 Execution/2 Weekly/${`${a}-W${String(r).padStart(2,"0")}.md`}`}case"monthly":return`02 Execution/3 Monthly/${`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}.md`}`;case"quarterly":{let a=Math.floor(t.getMonth()/3)+1;return`02 Execution/4 Quarterly/${`${t.getFullYear()}-Q${a}.md`}`}case"yearly":return`02 Execution/5 Yearly/${`${t.getFullYear()}.md`}`;case"note":return`03 SaveBox/Active/\u270F\uFE0FNote - ${We(n)}.md`;case"area":case"wish":case"goal":case"project":case"task":case"habit":return`03 SaveBox/Active/${Be[e]}${We(n)}.md`}return`03 SaveBox/Active/${We(n)}.md`}async function fn(e,n){let t=`${n.charAt(0).toUpperCase()}${n.slice(1)} Template.md`,a=(0,z.normalizePath)(`${or}/${t}`),r=e.vault.getAbstractFileByPath(a);return r instanceof z.TFile?e.vault.read(r):""}async function dr(e,n,t){let a=(0,z.normalizePath)(n),r=a.replace(/\/[^/]+$/,""),s=a.split("/").pop();await Tn(e,r);let i=we(e,a);if(i)return i;let c=e.vault.getFiles().find(o=>o.name===s);if(c&&c.path!==a){await e.fileManager.renameFile(c,a);let o=we(e,a);if(o){if(!(await e.vault.read(o)).trim()){let u=await fn(e,t);u&&await e.vault.modify(o,u)}return o}}let d=await fn(e,t);return await e.vault.create(a,d??"")}async function yn(e,n,t){if(!["task","project","goal","area","wish","habit","note"].includes(t))return n;let a=Be[t],r=n.path.startsWith("03 SaveBox/Active/"),s=n.basename.startsWith(a);if(!r||s)return n;let i=n.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),c=vn(i||"Untitled"),d=(0,z.normalizePath)(`03 SaveBox/Active/${a}${We(c)}.md`);if(d===n.path)return n;let o=we(e,d);return o||(await e.fileManager.renameFile(n,d),we(e,d)??n)}function ur(e){return e==="task"?"My Task":e==="project"?"My Project":"My Goal"}async function hr(e,n,t){for(let s=0;s<25&&!e.metadataCache.getFileCache(n)?.headings?.length;s++)await new Promise(c=>setTimeout(c,40));let a=n.basename,r=ur(t);await Vt(e,n,r,a)}async function se(e,n,t){let a=(0,z.normalizePath)(lr(n,t));if(n==="daily"||n==="weekly"||n==="monthly"||n==="quarterly"||n==="yearly"){console.log("[MMOS][routeKind] periodic:",{kind:n,targetPath:a});let u=await dr(e,a,n);return await e.workspace.getLeaf(!1).openFile(u),u}let s=["task","project","goal","area","wish","habit","note"].includes(n)?vn(t):t,i=we(e,a);if(i){console.log("[MMOS][routeKind] existing at target:",{kind:n,targetPath:a});let u=await yn(e,i,n);return n==="area"&&await mn(e,u),n==="wish"&&await gn(e,u),await e.workspace.getLeaf(!1).openFile(u),u}console.log("[MMOS][routeKind] createTypedNote:",{kind:n,effectiveTitle:s,targetPath:a});let c=await Zt(e,{kind:n,title:s}),d=a.replace(/\/[^/]+$/,"");await Tn(e,d),c.path!==a&&await e.fileManager.renameFile(c,a);let o=we(e,a)??c;console.log("[MMOS][routeKind] moved/created final:",{kind:n,finalPath:o.path}),(n==="task"||n==="project"||n==="goal")&&await hr(e,o,n),n==="area"&&await mn(e,o),n==="wish"&&await gn(e,o);let l=await yn(e,o,n);return console.log("[MMOS][routeKind] ensurePrefixedName ->",{from:o.path,to:l.path,kind:n}),await e.workspace.getLeaf(!1).openFile(l),l}var xn=(e,n)=>se(e,"task",n),kn=(e,n)=>se(e,"project",n),Fn=(e,n)=>se(e,"goal",n);var $e=e=>se(e,"daily",""),vt=e=>se(e,"weekly",""),Tt=e=>se(e,"monthly",""),xt=e=>se(e,"quarterly",""),kt=e=>se(e,"yearly","");var pr=window.moment,Ft=new Set,mr={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},Mt={};for(let[e,n]of Object.entries(mr))for(let t of n)Mt[t.toLowerCase()]=e;var gr=Object.keys(Mt).sort((e,n)=>n.length-e.length).join("|"),fr=new RegExp(`\\b(?:${gr})\\b`,"gi");function yr(e){let t=/^#{1,6}\s*.*\blog\b.*$/mi.exec(e);if(!t)return null;let a=t[0],r=t.index+a.length;return e[r]==="\r"&&e[r+1]===`
`?r+2:e[r]===`
`?r+1:r}function wr(e,n){let t=yr(e);if(t===null)return e.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${n}
`;let a=e.slice(0,t),s=e.slice(t).replace(/^\r?\n{0,}/,""),i=a.endsWith(`

`)?"":a.endsWith(`
`)?`
`:`

`;return a+i+n+`
`+s}function Mn(e,n){let t=e.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(t)||/^habit template(\.md)?$/i.test(e.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e.basename))return!0;if(n){let a=n.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(a[1]))return!0}return!1}function br(e){let n=e.match(fr);return n?[...new Set(n.map(t=>Mt[t.toLowerCase()]).filter(Boolean))]:[]}function vr(e){let n=br(e);if(n.length===0)return!0;let t=pr().format("dddd");return n.includes(t)}function Tr(e){let n=e.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return n?n[1].trim():e.trim()}async function An(e,n,t){let a=window.moment().format("YYYY-MM-DD"),r=`^${a}`;if(t.includes(r))return!1;let i=`- [ ] \u{1F504}Habit - ${Tr(n.basename)} ${a} ${r}`,c=wr(t,i);return await e.vault.modify(n,c),!0}async function Se(e,n){let t=n.path;if(!Ft.has(t)){Ft.add(t);try{if(!Mn(n))return;if(!vr(n.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:n.path});return}let a=await e.vault.read(n);if(!Mn(n,a))return;await An(e,n,a)}finally{setTimeout(()=>Ft.delete(t),120)}}}async function En(e,n){let t=await e.vault.read(n);await An(e,n,t)}var xr=window.moment,kr="03 SaveBox/Active",Fr=/(^| )Habit -|^ðŸ”Habit -/i,Mr={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},At={};for(let[e,n]of Object.entries(Mr))for(let t of n)At[t.toLowerCase()]=e;var Ar=Object.keys(At).sort((e,n)=>n.length-e.length).join("|"),Er=new RegExp(`\\b(?:${Ar})\\b`,"gi");function $r(e){let n=e.match(Er);return n?[...new Set(n.map(t=>At[t.toLowerCase()]).filter(Boolean))]:[]}function Sr(e){let n=xr().format("dddd"),t=$r(e);return{ok:t.length>0&&t.includes(n),todayName:n}}async function $n(e,n=kr){let t=e.vault.getMarkdownFiles().filter(a=>a.path.startsWith(n+"/")).filter(a=>Fr.test(a.basename));for(let a of t){let{ok:r}=Sr(a.basename);if(r)try{await Se(e,a)}catch{}}}var Ie=require("obsidian"),X=window.moment,Lr=e=>X(e).format("YYYY-MM-DD");function Sn(e){let n=X(e+"-01","YYYY-MM-DD").startOf("month"),t=n.clone().endOf("month");return{start:n,end:t}}function Pr(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Cr(e,n){let a=new RegExp(`^#{1,6}\\s+${Pr(n)}\\s*$`,"gim").exec(e);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,i=new RegExp(`^#{1,${s}}\\s+`,"gim");i.lastIndex=r;let c=i.exec(e);return{start:r,end:c?c.index:e.length}}function Dr(e){e=String(e).trim();let n=e.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/)||e.match(/due\((\d{4}-\d{2}-\d{2})\)/i)||e.match(/due::\s*(\d{4}-\d{2}-\d{2})/i)||e.match(/ðŸ“…\s*(\d{4}-\d{2}-\d{2})/);return n?n[1]:null}async function Hr(e,n){let t=e.vault.getAbstractFileByPath(n.sourcePath);return t instanceof Ie.TFile?e.vault.read(t):""}function Rr(e){let n=Cr(e,"\u270D\uFE0F Log")||{start:0,end:e.length},t=e.slice(n.start,n.end),a=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,r=[],s;for(;s=a.exec(t);){let i=s[1].toLowerCase()==="x",c=s[2],d=Dr(c);d&&r.push({date:d,done:i})}return r}function Or(e){let n=new Map;for(let t of e)n.set(t.date,n.get(t.date)||!1||t.done);return n}function Nr(e){let n={};for(let[a,r]of e){let s=X(a).format("YYYY-MM");(n[s]||(n[s]=[])).push({date:a,done:r})}return Object.keys(n).sort().slice(-3).reverse().map(a=>{let r=n[a],s=r.length?Math.round(r.filter(i=>i.done).length/r.length*100):0;return{label:X(a,"YYYY-MM").format("MMM"),pct:s}})}function Yr(e,n=90){let t=0,a=X();for(let r=0;r<n;r++){let s=Lr(a);if(e.get(s))t++;else break;a.subtract(1,"day")}return t}function _r(e,n,t){let a=e.createDiv({cls:"habit-monthly-summary"});a.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${t} day${t===1?"":"s"}</strong>`;let r=a.createDiv({cls:"month-bars"});n.forEach(({label:s,pct:i},c)=>{let d=r.createDiv({cls:"month-row"});d.innerHTML=`
      <div class="month-label">${s}</div>
      <div class="bar-track">
        <div class="bar-fill ${c===0?"bar-orange":"bar-purple"}" style="width:${i}%;"></div>
      </div>
      <div class="pct-text">${i}<span class="pct-symbol">%</span></div>
    `})}function Ln(e,n,t,a){let r=g=>X(g).format("YYYY-MM-DD"),s=t.clone().startOf("isoWeek"),i=a.clone().endOf("isoWeek"),c=[...n.keys()].sort(),d=null;for(let g=c.length-1;g>=0;g--){let y=c[g];if(!X(y).isAfter(a)){if(X(y).isBefore(t))break;if(n.get(y)){d=y;break}}}let o=e.createDiv({cls:"weekly-streak-wrap"}),l=o.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(g=>l.createDiv({cls:"head",text:g}));let u=o.createDiv({cls:"weekly-streak-grid"}),h=[],p=i.clone().endOf("isoWeek");for(;p.isSameOrAfter(s);){let g=p.clone().startOf("isoWeek");h.push({weekStart:g.clone(),weekEnd:p.clone()}),p.subtract(1,"week")}for(let g of h){let y=g.weekStart.clone();for(let m=0;m<7;m++){let b=r(y),w=y.isSameOrAfter(t)&&y.isSameOrBefore(a),f=w?!!n.get(b):!1,v=u.createDiv({cls:"weekly-streak-cell"});w||v.classList.add("pad"),f&&w&&(v.classList.add("hit"),b===d&&v.classList.add("latest-hit")),v.createDiv({cls:"num",text:w?y.format("D"):""}),v.createDiv({cls:"mmm",text:w?y.format("MMM"):""}),v.setAttr("title",w?`${y.format("ddd, DD MMM YYYY")} ${f?"\u2705 Done":"\u274C Missed"}`:""),y.add(1,"day")}}}function jr(e,n,t){let a=e.createDiv({cls:"month-switch"});return n.forEach((r,s)=>{let i=a.createEl("button",{text:r.label,cls:"month-btn"});s===0&&i.classList.add("active"),i.addEventListener("click",()=>{a.querySelectorAll(".month-btn").forEach(c=>c.classList.remove("active")),i.classList.add("active"),t(r.key)})}),a}function Wr(e){let n=document.createElement("style");n.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width: 4ch; text-align: right; font-weight: 600; font-size: .95em; white-space: nowrap; }
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn { font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer; background: var(--background-modifier-border); border: none; }
.month-btn.active { background: var(--interactive-accent); color: white; }
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden; background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border); display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,e.appendChild(n)}async function Pn(e,n,t){n.replaceChildren();let a=await Hr(e,t),r=Rr(a),s=Or(r),i=Nr(s),c=Yr(s);Wr(n),_r(n,i,c);let o=Array.from(new Set([...s.keys()].map(u=>X(u).format("YYYY-MM")))).sort().slice(-3).reverse().map(u=>({key:u,label:X(u,"YYYY-MM").format("MMM")})),l=o[0]?.key;if(jr(n,o,u=>{l=u,n.querySelectorAll(".weekly-streak-wrap").forEach(g=>g.remove());let{start:h,end:p}=Sn(u);Ln(n,s,h,p)}),l){let{start:u,end:h}=Sn(l);Ln(n,s,u,h)}}function Br(e,n,t){let a=(()=>{let s=null;return()=>{s&&window.clearTimeout(s),s=window.setTimeout(async()=>{s=null,await Pn(e.app,n,t)},120)}})();class r extends Ie.MarkdownRenderChild{onload(){this.registerEvent(e.app.vault.on("modify",i=>{i?.path===t.sourcePath&&a()})),this.registerEvent(e.app.metadataCache.on("changed",i=>{i?.path===t.sourcePath&&a()})),this.registerEvent(e.app.metadataCache.on("resolved",()=>a())),this.registerEvent(e.app.workspace.on("editor-change",()=>a()))}}t.addChild(new r(n))}function Cn(e){let n=async(t,a,r)=>{await Pn(e.app,a,r),Br(e,a,r)};e.registerMarkdownCodeBlockProcessor("wishmap-habit-monthly",n),e.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",n)}var qe=require("obsidian");var Et=class extends qe.SuggestModal{constructor(t){super(t.app);this.plugin=t;this.setPlaceholder("Search or open a periodic note\u2026")}getSuggestions(t){let a=[{label:"Open Today (Daily)",action:async()=>{await $e(this.app)}},{label:"Open This Week (Weekly)",action:async()=>{await vt(this.app)}},{label:"Open This Month (Monthly)",action:async()=>{await Tt(this.app)}},{label:"Open This Quarter",action:async()=>{await xt(this.app)}},{label:"Open This Year",action:async()=>{await kt(this.app)}}],r=t.trim().toLowerCase();return r?a.filter(s=>s.label.toLowerCase().includes(r)):a}renderSuggestion(t,a){a.createDiv({text:t.label})}async onChooseSuggestion(t){await t.action()}};function Dn(e){e.addRibbonIcon("calendar-clock","WishMap: Periodic Notes",t=>{let a=new qe.Menu;a.addItem(r=>r.setTitle("Open Today (Daily)").onClick(async()=>{await $e(e.app)})),a.addItem(r=>r.setTitle("Open This Week (Weekly)").onClick(async()=>{await vt(e.app)})),a.addItem(r=>r.setTitle("Open This Month (Monthly)").onClick(async()=>{await Tt(e.app)})),a.addItem(r=>r.setTitle("Open This Quarter").onClick(async()=>{await xt(e.app)})),a.addItem(r=>r.setTitle("Open This Year").onClick(async()=>{await kt(e.app)})),a.showAtMouseEvent(t)}).setAttr("aria-label","WishMap: Periodic Notes"),e.addCommand({id:"wishmap-open-periodic-notes",name:"Open Periodic Note\u2026",callback:()=>new Et(e).open()})}var Lt=require("obsidian");var be=require("obsidian");async function Hn(e,n,t){let a=e.vault.getAbstractFileByPath(n);if(!(a instanceof be.TFile))return;let r=await e.vault.read(a),s=r.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/),i=r,c={};if(s){try{c=(0,be.parseYaml)(s[1])??{}}catch{c={}}i=r.slice(s[0].length)}for(let[l,u]of Object.entries(t))u!==void 0&&(c[l]=u);let o=`---
${(0,be.stringifyYaml)(c).trimEnd()}
---
${i}`;o!==r&&await e.vault.modify(a,o)}function Pt(e){return e.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}function ie(e,n){let t=Pt(n.basename);return/^project(\s|:|-|_)/.test(t)}function de(e,n){let t=Pt(n.basename);return/^task(\s|:|-|_)/.test(t)}function le(e,n){let t=Pt(n.basename);return/^goal(\s|:|-|_)/.test(t)}function Rn(e,n){let a=e.metadataCache.getFileCache(n)?.links??[],r=new Set,s=[];for(let i of a){let c=e.metadataCache.getFirstLinkpathDest(i.link,n.path);c instanceof Lt.TFile&&c.extension==="md"&&(r.has(c.path)||(r.add(c.path),s.push(c)))}return s}function On(e,n){return Rn(e,n).filter(t=>de(e,t))}function Ir(e,n){return Rn(e,n).filter(t=>ie(e,t))}function St(e,n){let t=e.metadataCache.getFileCache(n)?.frontmatter??{},a=["duration_hours","durationHours","duration","duration hours"];for(let r of a)if(t[r]!==void 0){let s=(typeof t[r]=="string",Number(t[r]));if(Number.isFinite(s))return s}return 0}async function Nn(e,n,t,a){let r=e.metadataCache.getFileCache(n)?.frontmatter?.[t],s=Number(r),i=Math.round(a*10)/10;Number.isFinite(s)&&Math.abs(s-i)<.05||await Hn(e,n.path,{[t]:i})}async function Le(e,n){if(!ie(e,n))return;let t=On(e,n),a=0;for(let r of t)a+=St(e,r);await Nn(e,n,"duration_hours",a)}async function Ct(e,n){if(!le(e,n))return;let t=Ir(e,n),a=On(e,n),r=0;for(let s of t)r+=St(e,s);for(let s of a)r+=St(e,s);await Nn(e,n,"duration_hours",r)}function $t(e,n,t){let a=[],r=e.metadataCache.resolvedLinks,s=new Set;for(let[i,c]of Object.entries(r)){if(!c[n.path])continue;let d=e.vault.getAbstractFileByPath(i);d instanceof Lt.TFile&&d.extension==="md"&&t(e,d)&&(s.has(d.path)||(s.add(d.path),a.push(d)))}return a}function ee(e,n){if(ie(e,n))return[n,...$t(e,n,le)];if(de(e,n)){let t=$t(e,n,ie),a=$t(e,n,le);return[...t,...a]}return le(e,n)?[n]:[]}var Yn=require("obsidian");function Dt(e){let{app:n}=e;console.log("[WishMap] rollup auto: wiring listeners");let t=new Map;function a(s){let i=s.path,c=t.get(i);c&&window.clearTimeout(c);let d=window.setTimeout(async()=>{if(t.delete(i),ie(n,s)){await Le(n,s);for(let o of ee(n,s).filter(l=>le(n,l)))await Ct(n,o)}else le(n,s)&&await Ct(n,s)},300);t.set(i,d)}function r(s){if(s instanceof Yn.TFile&&s.extension==="md"){console.log("[WishMap] rollup auto: file change",s.path);for(let i of ee(n,s))a(i)}}e.registerEvent(n.metadataCache.on("changed",r)),e.registerEvent(n.vault.on("modify",r)),e.registerEvent(n.vault.on("create",r)),e.registerEvent(n.vault.on("rename",r)),e.registerEvent(n.vault.on("delete",r)),e.addCommand({id:"wishmap-rollup-current",name:"Recompute duration for current note",checkCallback:s=>{let i=n.workspace.getActiveFile();return!i||i.extension!=="md"?!1:(s||a(i),!0)}}),n.workspace.onLayoutReady(()=>{let s=n.vault.getMarkdownFiles();for(let i of s)for(let c of ee(n,i))a(c)})}var ne=require("obsidian"),Ge="03 SaveBox/Active",qr=["duration_hours","durationHours","duration","duration hours"],Gr=2;function me(e){return e.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}var Qe=e=>/^area(\s|:|-|_)/.test(me(e.basename)),Pe=e=>/^wish(\s|:|-|_)/.test(me(e.basename)),Ce=e=>/^goal(\s|:|-|_)/.test(me(e.basename)),ge=e=>/^project(\s|:|-|_)/.test(me(e.basename)),ke=e=>/^task(\s|:|-|_)/.test(me(e.basename)),De=e=>/^habit(\s|:|-|_)/.test(me(e.basename)),He=e=>/^note(\s|:|-|_)/.test(me(e.basename)),Kr=e=>e.path===Ge||e.path.startsWith(Ge+"/"),D=e=>e.vault.getMarkdownFiles().filter(Kr),x=(e,n)=>e.basename.localeCompare(n.basename),ue=(e,n)=>e.metadataCache.getFileCache(n),Ht=(e,n)=>ue(e,n)?.frontmatter??{};function Qr(e){let n=Number(String(e??"").replace(/[^0-9.\-]/g,""));return Number.isFinite(n)?n:NaN}function V(e,n){for(let t of qr)if(Ht(e,n)[t]!==void 0){let a=Qr(Ht(e,n)[t]);if(Number.isFinite(a))return a}return NaN}function Ur(e,n){let t=new Set;for(let r of ue(e,n)?.tags??[])t.add(String(r?.tag??r).replace(/^#/,""));let a=Ht(e,n).tags;return Array.isArray(a)?a.forEach(r=>r&&t.add(String(r).replace(/^#/,""))):a&&t.add(String(a).replace(/^#/,"")),Array.from(t)}var k=(e,n)=>{let t=Ur(e,n);return t.length?" "+t.map(a=>`#${a}`).join(" "):""},Ke=e=>Number(e.toFixed(Gr)),Y=e=>`${Ke(e)} ${Ke(e)===1?"hr":"hrs"}`,_=e=>`<span class="duration-chip">${e}</span>`,L=(e,n)=>n?`<span class="grey-link">~~${e}~~ \u2705</span>`:e;function te(e,n){let t=n.split(`
`).map(a=>a?`> ${a}`:">").join(`
`);return`> [!wishmap]+ ${e}
>
${t}
`}function _n(){return`
.duration-chip{display:inline-block;padding:0 6px;border-radius:12px;line-height:1.6;font-size:0.9em;background-color:var(--interactive-accent-hover);color:var(--background-primary);}
.grey-link a{color:var(--text-faint)!important;}
.callout[data-callout="wishmap"] .callout-icon{display:none;} /* hide icon */
`}function jn(e,n){let t=ue(e,n)?.links??[],a=new Set,r=[];for(let s of t){let i=e.metadataCache.getFirstLinkpathDest(s.link,n.path);i instanceof ne.TFile&&i.extension==="md"&&!a.has(i.path)&&(a.add(i.path),r.push(i))}return r}var O=(e,n,t)=>jn(e,n).some(a=>a.path===t.path)||jn(e,t).some(a=>a.path===n.path),zr=(e,n)=>D(e).filter(Pe).filter(t=>O(e,n,t)),Bn=(e,n)=>D(e).filter(Ce).filter(t=>O(e,n,t)),ve=(e,n)=>D(e).filter(ge).filter(t=>O(e,n,t)),he=(e,n)=>D(e).filter(ke).filter(t=>O(e,n,t)),Ue=(e,n)=>D(e).filter(De).filter(t=>O(e,n,t)),Xr=(e,n)=>D(e).filter(He).filter(t=>O(e,n,t)),In=(e,n)=>D(e).filter(He).filter(t=>O(e,n,t)),Rt=(e,n)=>D(e).filter(He).filter(t=>O(e,n,t)),ze=(e,n)=>D(e).filter(He).filter(t=>O(e,n,t)),pe=(e,n)=>D(e).filter(He).filter(t=>O(e,n,t)),Vr=(e,n)=>D(e).filter(ge).filter(t=>O(e,n,t)),Jr=(e,n)=>D(e).filter(ke).filter(t=>O(e,n,t)),Zr=(e,n)=>D(e).filter(De).filter(t=>O(e,n,t)),es=(e,n)=>D(e).filter(ge).filter(t=>O(e,n,t)),ts=(e,n)=>D(e).filter(ke).filter(t=>O(e,n,t)),ns=(e,n)=>D(e).filter(De).filter(t=>O(e,n,t)),as=(e,n)=>D(e).filter(ke).filter(t=>O(e,n,t)),rs=(e,n)=>D(e).filter(De).filter(t=>O(e,n,t));function Te(e,n){let t=he(e,n).map(s=>({d:V(e,s),done:R(e,s)})).filter(s=>Number.isFinite(s.d)&&s.d>0),a=t.reduce((s,i)=>s+i.d,0),r=t.filter(s=>s.done).reduce((s,i)=>s+i.d,0);return a<=0?{total:null,pct:null}:{total:Ke(a),pct:Math.round(r/a*100)}}var xe=(e,n)=>he(e,n).length>0&&he(e,n).every(t=>R(e,t));function qn(e,n){let t=ve(e,n),a=0,r=0,s=!1;for(let i of t){let{total:c,pct:d}=Te(e,i);Number.isFinite(c)&&c>0&&(s=!0,a+=c,d!=null&&(r+=c*(d/100)))}return!s||a<=0?{total:null,pct:null}:{total:Ke(a),pct:Math.round(r/a*100)}}var Gn=(e,n)=>ve(e,n).length>0&&ve(e,n).every(t=>xe(e,t));function R(e,n){let a=(ue(e,n)?.listItems??[]).find(r=>r&&"task"in r);return String(a?.task??"").toLowerCase()==="x"}function Ot(e,n){let t=new Set,a=[];a.push(`- [[${n.path}|${n.basename}]]${k(e,n)}`);for(let r of zr(e,n).sort(x))if(!t.has(r.path)){t.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${k(e,r)}`);for(let s of Bn(e,r).sort(x)){if(t.has(s.path))continue;t.add(s.path);let{total:i,pct:c}=qn(e,s),d=Gn(e,s),o=Number.isFinite(i)&&i>0?` ${_(Y(i))}`:"",l=c!=null&&c>0&&c<100?` ${c}%`:"",u=`[[${s.path}|${s.basename}]]${o}${l}${k(e,s)}`;a.push(`    - ${L(u,d)}`);for(let h of ve(e,s).sort(x)){if(t.has(h.path))continue;t.add(h.path);let{total:p,pct:g}=Te(e,h),y=xe(e,h),m=Number.isFinite(p)&&p>0?` ${_(Y(p))}`:"",b=g!=null&&g>0&&g<100?` ${g}%`:"",w=`[[${h.path}|${h.basename}]]${m}${b}${k(e,h)}`;a.push(`      - ${L(w,y)}`);for(let f of he(e,h).sort(x)){if(t.has(f.path))continue;t.add(f.path);let v=V(e,f),M=Number.isFinite(v)&&v>0?` ${_(Y(v))}`:"",T=`[[${f.path}|${f.basename}]]${M}${k(e,f)}`;a.push(`        - ${L(T,R(e,f))}`)}for(let f of Ue(e,h).sort(x)){if(t.has(f.path))continue;t.add(f.path);let v=`[[${f.path}|${f.basename}]]${k(e,f)}`;a.push(`        - ${L(v,R(e,f))}`)}for(let f of ze(e,h).sort(x))t.has(f.path)||(t.add(f.path),a.push(`        - [[${f.path}|${f.basename}]]${k(e,f)}`))}for(let h of Rt(e,s).sort(x))t.has(h.path)||(t.add(h.path),a.push(`    - [[${h.path}|${h.basename}]]${k(e,h)}`))}for(let s of In(e,r).sort(x))t.has(s.path)||(t.add(s.path),a.push(`  - [[${s.path}|${s.basename}]]${k(e,s)}`))}for(let r of Vr(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let{total:s,pct:i}=Te(e,r),c=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"",d=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${c}${d}${k(e,r)}`,xe(e,r))}`)}for(let r of Jr(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let s=V(e,r),i=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${i}${k(e,r)}`,R(e,r))}`)}for(let r of Zr(e,n).sort(x))t.has(r.path)||(t.add(r.path),a.push(`  - ${L(`[[${r.path}|${r.basename}]]${k(e,r)}`,R(e,r))}`));for(let r of Xr(e,n).sort(x))t.has(r.path)||(t.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${k(e,r)}`));return te(`${n.basename}`,a.join(`
`))}function Kn(e,n){let t=new Set,a=[];a.push(`- [[${n.path}|${n.basename}]]${k(e,n)}`);for(let r of Bn(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let{total:s,pct:i}=qn(e,r),c=Gn(e,r),d=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"",o=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${d}${o}${k(e,r)}`,c)}`);for(let l of ve(e,r).sort(x)){if(t.has(l.path))continue;t.add(l.path);let{total:u,pct:h}=Te(e,l),p=xe(e,l),g=Number.isFinite(u)&&u>0?` ${_(Y(u))}`:"",y=h!=null&&h>0&&h<100?` ${h}%`:"";a.push(`    - ${L(`[[${l.path}|${l.basename}]]${g}${y}${k(e,l)}`,p)}`);for(let m of he(e,l).sort(x)){if(t.has(m.path))continue;t.add(m.path);let b=V(e,m),w=Number.isFinite(b)&&b>0?` ${_(Y(b))}`:"";a.push(`      - ${L(`[[${m.path}|${m.basename}]]${w}${k(e,m)}`,R(e,m))}`);for(let f of pe(e,m).sort(x))t.has(f.path)||(t.add(f.path),a.push(`        - [[${f.path}|${f.basename}]]${k(e,f)}`))}for(let m of Ue(e,l).sort(x))t.has(m.path)||(t.add(m.path),a.push(`      - ${L(`[[${m.path}|${m.basename}]]${k(e,m)}`,R(e,m))}`));for(let m of ze(e,l).sort(x))t.has(m.path)||(t.add(m.path),a.push(`      - [[${m.path}|${m.basename}]]${k(e,m)}`))}for(let l of Rt(e,r).sort(x))t.has(l.path)||(t.add(l.path),a.push(`  - [[${l.path}|${l.basename}]]${k(e,l)}`))}for(let r of es(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let{total:s,pct:i}=Te(e,r),c=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"",d=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${c}${d}${k(e,r)}`,xe(e,r))}`)}for(let r of ts(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let s=V(e,r),i=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${i}${k(e,r)}`,R(e,r))}`);for(let c of pe(e,r).sort(x))t.has(c.path)||(t.add(c.path),a.push(`    - [[${c.path}|${c.basename}]]${k(e,c)}`))}for(let r of ns(e,n).sort(x))t.has(r.path)||(t.add(r.path),a.push(`  - ${L(`[[${r.path}|${r.basename}]]${k(e,r)}`,R(e,r))}`));for(let r of In(e,n).sort(x))t.has(r.path)||(t.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${k(e,r)}`));return te(`${n.basename}`,a.join(`
`))}function Qn(e,n){let t=new Set,a=[];a.push(`- [[${n.path}|${n.basename}]]${k(e,n)}`);for(let r of ve(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let{total:s,pct:i}=Te(e,r),c=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"",d=i!=null&&i>0&&i<100?` ${i}%`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${c}${d}${k(e,r)}`,xe(e,r))}`);for(let o of he(e,r).sort(x)){if(t.has(o.path))continue;t.add(o.path);let l=V(e,o),u=Number.isFinite(l)&&l>0?` ${_(Y(l))}`:"";a.push(`    - ${L(`[[${o.path}|${o.basename}]]${u}${k(e,o)}`,R(e,o))}`);for(let h of pe(e,o).sort(x))t.has(h.path)||(t.add(h.path),a.push(`      - [[${h.path}|${h.basename}]]${k(e,h)}`))}for(let o of Ue(e,r).sort(x))t.has(o.path)||(t.add(o.path),a.push(`    - ${L(`[[${o.path}|${o.basename}]]${k(e,o)}`,R(e,o))}`));for(let o of ze(e,r).sort(x))t.has(o.path)||(t.add(o.path),a.push(`    - [[${o.path}|${o.basename}]]${k(e,o)}`))}for(let r of as(e,n).sort(x)){if(t.has(r.path))continue;t.add(r.path);let s=V(e,r),i=Number.isFinite(s)&&s>0?` ${_(Y(s))}`:"";a.push(`  - ${L(`[[${r.path}|${r.basename}]]${i}${k(e,r)}`,R(e,r))}`);for(let c of pe(e,r).sort(x))t.has(c.path)||(t.add(c.path),a.push(`    - [[${c.path}|${c.basename}]]${k(e,c)}`))}for(let r of rs(e,n).sort(x))t.has(r.path)||(t.add(r.path),a.push(`  - ${L(`[[${r.path}|${r.basename}]]${k(e,r)}`,R(e,r))}`));for(let r of Rt(e,n).sort(x))t.has(r.path)||(t.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${k(e,r)}`));return te(`${n.basename}`,a.join(`
`))}function Un(e,n){let t=[];t.push(`- [[${n.path}|${n.basename}]]${k(e,n)}`);for(let a of he(e,n).sort(x)){let r=V(e,a),s=Number.isFinite(r)&&r>0?` ${_(Y(r))}`:"";t.push(`  - ${L(`[[${a.path}|${a.basename}]]${s}${k(e,a)}`,R(e,a))}`);for(let i of pe(e,a).sort(x))t.push(`    - [[${i.path}|${i.basename}]]${k(e,i)}`)}for(let a of Ue(e,n).sort(x))t.push(`  - ${L(`[[${a.path}|${a.basename}]]${k(e,a)}`,R(e,a))}`);for(let a of ze(e,n).sort(x))t.push(`  - [[${a.path}|${a.basename}]]${k(e,a)}`);return te(`${n.basename}`,t.join(`
`))}function ss(e,n){let t=[],a=V(e,n),r=Number.isFinite(a)&&a>0?` ${_(Y(a))}`:"";t.push(`- ${L(`[[${n.path}|${n.basename}]]${r}${k(e,n)}`,R(e,n))}`);for(let s of pe(e,n).sort(x))t.push(`  - [[${s.path}|${s.basename}]]${k(e,s)}`);return te(`${n.basename}`,t.join(`
`))}function Wn(e){return Qe(e)?0:Pe(e)?1:Ce(e)?2:ge(e)?3:99}function is(e,n,t){let a=ue(e,n)?.links??[],r=ue(e,t)?.links??[],s=a.some(c=>e.metadataCache.getFirstLinkpathDest(c.link,n.path)?.path===t.path),i=r.some(c=>e.metadataCache.getFirstLinkpathDest(c.link,t.path)?.path===n.path);return s||i}function os(e,n){let t=f=>(ue(e,f)?.links??[]).length>0,a=f=>{for(let[,v]of Object.entries(e.metadataCache.resolvedLinks))if(v[f.path])return!0;return!1},r=f=>!t(f)&&!a(f),s=f=>{let v=Wn(f);return v===0?!1:D(e).filter(T=>Wn(T)<v).some(T=>is(e,T,f))},i=f=>!s(f),c=n.filter(Pe).sort(x),d=n.filter(Ce).sort(x),o=n.filter(ge).sort(x),l=n.filter(ke).sort(x),u=n.filter(De).sort(x),h=f=>f.map(v=>`- [[${v.path}|${v.basename}]]`).join(`
`),p=(f,v)=>v.length?te(`${f} (${v.length})`,h(v)):"",g=f=>f.sort(x).map(v=>cs(e,v)).join(`

`),y=(f,v)=>v.length?te(`${f} (${v.length})`,g(v)):"",m=l.filter(f=>r(f)||i(f)),b="";if(m.length){let f=[];for(let v of m.sort(x)){let M=V(e,v),T=Number.isFinite(M)&&M>0?` ${_(Y(M))}`:"";f.push(`- ${L(`[[${v.path}|${v.basename}]]${T}${k(e,v)}`,R(e,v))}`);for(let F of pe(e,v).sort(x))f.push(`  - [[${F.path}|${F.basename}]]${k(e,F)}`)}b=te(`\u{1F4CC} Solo Tasks (${m.length})`,f.join(`
`))}let w=[];return w.push(y("\u{1F4AD} Unparented Wishes",c.filter(i))),w.push(y("\u{1F3AF} Unparented Goals",d.filter(i))),w.push(y("\u{1F680} Unparented Projects",o.filter(i))),w.push(b),w.push(p("\u{1F501} Solo Habits",u.filter(f=>r(f)||i(f)))),w.push(p("\u{1F4AD} Standalone Wishes",c.filter(r))),w.push(p("\u{1F3AF} Standalone Goals",d.filter(r))),w.push(p("\u{1F680} Standalone Projects",o.filter(r))),w.filter(Boolean).join(`

`)}function cs(e,n){if(Qe(n))return Ot(e,n);if(Pe(n))return Kn(e,n);if(Ce(n))return Qn(e,n);if(ge(n))return Un(e,n);let t=k(e,n);return te(`\u{1F4C4} ${n.basename}`,`- [[${n.path}|${n.basename}]]${t}`)}function zn(e){let n=e.app;e.registerMarkdownCodeBlockProcessor("wishmap",async(t,a,r)=>{a.empty(),a.createEl("style",{text:_n()});let s=await Xn(n);await ne.MarkdownRenderer.render(n,s,a,r.sourcePath,e)}),e.registerMarkdownCodeBlockProcessor("wishmap-local",async(t,a,r)=>{let s=String(t||"").trim().toLowerCase(),i=n.vault.getAbstractFileByPath(r.sourcePath);if(!(i instanceof ne.TFile)||i.extension!=="md"){a.setText("No file context");return}a.empty(),a.createEl("style",{text:_n()});let c="";s==="project"||!s&&ge(i)?c=Un(n,i):s==="goal"||!s&&Ce(i)?c=Qn(n,i):s==="wish"||!s&&Pe(i)?c=Kn(n,i):s==="area"||!s&&Qe(i)?c=Ot(n,i):s==="task"||!s&&ke(i)?c=ss(n,i):c="_Place in an Area, Wish, Goal, Project, or Task note, or pass one of: area | wish | goal | project | task._",await ne.MarkdownRenderer.render(n,c,a,r.sourcePath,e)})}async function Xn(e){let n=D(e),t=n.filter(Qe).sort(x),a=[];for(let r of t)a.push(Ot(e,r));return a.push(os(e,n)),a.filter(Boolean).join(`

`)}async function Vn(e){let n=await Xn(e),t=(0,ne.normalizePath)(`${Ge}/_Maps/Area-Maps.md`),a=e.vault.getAbstractFileByPath(t);if(a instanceof ne.TFile)await e.vault.read(a)!==n&&await e.vault.modify(a,n);else{try{await e.vault.createFolder(`${Ge}/_Maps`)}catch{}await e.vault.create(t,n)}return t}var B=require("obsidian");function Fe(){if(document.getElementById("wm-scheduler-style"))return;let e=`
/* -------------------------------------------------------------------------- */
/* 1. Utility visibility helpers                                              */
/* -------------------------------------------------------------------------- */
.wm-hidden { display: none !important; }  /* Hide elements dynamically */

/* -------------------------------------------------------------------------- */
/* 2. Scheduled wish link bubble (#Y2025) under \u201CMy Wishes\u201D section           */
/* -------------------------------------------------------------------------- */
.wm-wish-link--scheduled::after {
  content: "#Y" attr(data-year);
  display: inline-block;
  margin-left: 6px;
  padding: 2px 8px 3px 8px;
  border-radius: 999px;
  font-size: 0.8em;
  font-weight: 600;
  line-height: 1;
  background: color-mix(in srgb, var(--text-accent) 20%, var(--background-primary));
  color: var(--text-accent);
  vertical-align: middle;
}

/* -------------------------------------------------------------------------- */
/* 3. Wish card hover and external styling                                    */
/* -------------------------------------------------------------------------- */
.wm-year-col .wm-wish-card:hover {
  filter: brightness(1.08);
  opacity: 0.95;
}

/* External (foreign) wishes from other areas: lighter, muted tone */
.wm-year-col .wm-wish-card.is-external {
  background: color-mix(in srgb, var(--interactive-accent) 25%, var(--background-primary));
  border-color: color-mix(in srgb, var(--interactive-accent) 25%, var(--background-primary));
  color: color-mix(in srgb, var(--text-muted) 70%, var(--text-normal));
  opacity: 0.85;
  box-shadow: none;
}

.wm-year-col .wm-wish-card.is-external:hover {
  background: color-mix(in srgb, var(--interactive-accent) 30%, var(--background-primary));
  opacity: 1;
}

/* -------------------------------------------------------------------------- */
/* 4. Hide Obsidian popover previews while dragging                           */
/* -------------------------------------------------------------------------- */
body.wm-dragging .popover,
body.wm-dragging .mod-hover-popover,
body.wm-drag-intent .popover,
body.wm-drag-intent .mod-hover-popover {
  display: none !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* -------------------------------------------------------------------------- */
/* 5. Yearly Schedule grid container                                          */
/* -------------------------------------------------------------------------- */
.wm-year-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;  /* two columns: current year + next */
  gap: 12px;
  margin-top: 6px;
}

.wm-year-col {
  border: 0;
  background: transparent;
}

/* -------------------------------------------------------------------------- */
/* 6. Instruction line shown above the grid                                   */
/* -------------------------------------------------------------------------- */
.wm-year-instruction {
  margin-top: 8px;
  margin-bottom: 6px;
  text-align: left;
  font-size: 0.95em;
  color: var(--text-muted);
  font-style: italic;
}

/* -------------------------------------------------------------------------- */
/* 7. Year column header (year label, darker background)                      */
/* -------------------------------------------------------------------------- */
.wm-year-col--header {
  padding: 10px 12px;
  font-weight: 700;
  text-align: center;
  background: color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border: 1px solid color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border-bottom: 3px solid white;
  color: var(--text-muted);
  font-size: .85em;
  border-radius: 12px 12px 0 0;  /* rounded top corners */
}
/* -------------------------------------------------------------------------- */
/* 7A. Unscheduled column (tighter spacing)                                   */
/* -------------------------------------------------------------------------- */
.wm-year-col--unscheduled .wm-year-col--header {
  padding: 10px 12px;
  font-weight: 700;
  text-align: center;
  background: color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border: 1px solid color-mix(in srgb, var(--background-secondary) 100%, var(--background-primary));
  border-bottom: 3px solid white;
  color: var(--text-muted);
  font-size: .85em;
  border-radius: 12px 12px 0 0;  /* rounded top corners */
}

.wm-year-col--unscheduled .wm-year-col--body {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* -------------------------------------------------------------------------- */
/* 8. Year column body (drop zone)                                            */
/* -------------------------------------------------------------------------- */
.wm-year-col--body {
  min-height: 140px;
  padding: 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  background: color-mix(in srgb, var(--background-secondary) 70%, var(--background-primary));
  border: 1px solid color-mix(in srgb, var(--background-secondary) 70%, var(--background-primary));
  border-top: none;
  border-radius: 0 0 12px 12px;  /* rounded bottom corners only */
}

/* When user drags over a box: show accent outline */
.wm-year-col--body.is-dragover {
  outline: 2px dashed var(--text-accent);
  outline-offset: -4px;
}

/* -------------------------------------------------------------------------- */
/* 9. Wish cards (purple draggable rectangles)                                */
/* -------------------------------------------------------------------------- */
.wm-wish-card {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 10px;
  background: var(--interactive-accent);
  border: 1px solid var(--interactive-accent);
  box-shadow: 0 1px 2px rgba(0,0,0,.05);
  color: white;
  font-weight: 700;

  /* --- additions for smoother drag --- */
  cursor: grab;
  user-select: none;
  -webkit-user-drag: element; /* makes the element draggable on Chromium/WebKit */
  transition: transform 0.05s ease-in-out;
}

.wm-wish-card:active {
  cursor: grabbing;
  transform: scale(0.98); /* visual feedback */
}

/* Slightly transparent when external */
.wm-wish-card.is-external { opacity: .9; }

/* -------------------------------------------------------------------------- */
/* 10. Scheduled wish links under \u201CMy Wishes\u201D                                 */
/* -------------------------------------------------------------------------- */
.wm-wish-link--scheduled {
  color: var(--text-faint) !important;
  cursor: default !important;
  text-decoration: none !important;
}

/* Add the #Y2025 bubble for both anchor and span variants */
a.internal-link.wm-wish-link--scheduled::after,
span.cm-hmd-internal-link.wm-wish-link--scheduled::after,
span.internal-link.wm-wish-link--scheduled::after {
  content: "#Y" attr(data-year);
  display: inline-block;
  margin-left: 6px;
  padding: 2px 8px 3px 8px;
  border-radius: 999px;
  font-size: 0.8em;
  font-weight: 600;
  line-height: 1;
  background: color-mix(in srgb, var(--text-accent) 20%, var(--background-primary));
  color: var(--text-accent);
  vertical-align: middle;
}

/* --- Goals: scheduled link treatment --- */
.wm-goal-link--scheduled {
  color: var(--text-muted);                /* greyed link */
  text-decoration: none;
  opacity: 1;
  pointer-events: none;
}

.wm-goal-link--scheduled::after {
  content: " #" attr(data-label);          /* show #2025 Q2 */
  margin-left: 6px;
  font-size: 0.75em;
  line-height: 1;
  padding: 2px 6px;
  border-radius: 999px;
  background-color: var(--interactive-accent); /* strong accent bubble */
  color: var(--text-on-accent);                 /* readable text */
  vertical-align: baseline;
  border: none;
}

.markdown-source-view .wm-goal-link--scheduled {
  color: var(--text-muted);
  opacity: 1;
}



`,n=document.createElement("style");n.id="wm-scheduler-style",n.textContent=e,document.head.appendChild(n)}var oe=require("obsidian"),ls=/^(?:Y)?\d{4}$/,ds=/^Y\d{4}$/;function fe(e,n,t,a){if(typeof e!="object"){let d=window.app,o=e,l=n,u={origin:"native",payloadKey:"text/x-goal-path",...a??{}};return Jn(d,o,l,u)}return Jn(e,n,t,a??{})}function Jn(e,n,t,a){let r=document.createElement("div");r.classList.add("wm-wish-card"),r.textContent=n,r.setAttribute("draggable","true"),r.dataset.path=t;let s=a.origin??"native";r.dataset.origin=s,s==="external"&&r.classList.add("is-external");let i=a.payloadKey??"text/x-wish-path";return r.addEventListener("dragstart",c=>{let d=c.dataTransfer;if(!d)return;d.setData("text/x-origin",s),d.setData(i,t),d.setData("text/plain",t),document.body.classList.add("wm-dragging");let o=new Image;o.src=Nt,d.setDragImage(o,0,0)}),r.addEventListener("dragend",()=>{document.body.classList.remove("wm-dragging")}),r.addEventListener("click",async()=>{let c=e.vault.getAbstractFileByPath(t);c instanceof oe.TFile&&await e.workspace.getLeaf(!1).openFile(c)}),r}var Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=";function us(e){return(Array.isArray(e?.tags)?e.tags:e?.tags?[e.tags]:[]).map(String)}function hs(e){return e?(Array.isArray(e?.tags)?e.tags:typeof e?.tags=="string"?[e.tags]:Array.isArray(e?.tag)?e.tag:typeof e?.tag=="string"?[e.tag]:[]).map(String):[]}function K(e){return hs(e).map(n=>n.trim()).filter(n=>ls.test(n)).map(n=>n.replace(/^Y/,"")).filter(n=>/^\d{4}$/.test(n))}function Me(e,n){let r=[...us(e).filter(s=>!/^Y\d{4}$/.test(String(s))),`Y${n}`];e.tags=r}function J(e){return(Array.isArray(e)?e.map(String):[]).filter(t=>!ds.test(t))}function P(e){return/^âœ¨\s*Wish\s*-\s*/i.test(e)?"wish":/^ðŸŽ¯\s*Goal\s*-\s*/i.test(e)?"goal":/^ðŸš€\s*Project\s*-\s*/i.test(e)?"project":/^ðŸ“Œ\s*Task\s*-\s*/i.test(e)?"task":"other"}function ae(e){return(e||[]).filter(n=>!/^Y\d{4}Q[1-4]$/i.test(n))}function Yt(e,n,t){let a=`Y${n}${t}`,r=Array.isArray(e?.tags)?e.tags:typeof e?.tags=="string"?[e.tags]:[],s=ae(r);s.includes(a)||s.push(a),s.length?e.tags=s:delete e.tags}function Xe(e,n){let a=(Array.isArray(e?.tags)?e.tags:typeof e?.tags=="string"?[e.tags]:[]).filter(r=>/^Y\d{4}Q[1-4]$/i.test(r));return n?a.filter(r=>r.startsWith(`Y${n}`)):a}function _t(e){let n=e.match(/^Y(\d{4})Q([1-4])$/i);return n?{year:n[1],q:"Q"+n[2]}:null}function Ve(e){let{app:n,fileRef:t,containerEl:a,getNoteContainer:r,render:s,reAnnotate:i,registerEvent:c}=e,d=null,o=(p,g=120)=>{d&&window.clearTimeout(d),d=window.setTimeout(()=>{d=null,p()},g)},l=()=>i(),u=()=>{n.workspace.getActiveFile()?.path===t.path&&document.visibilityState==="visible"&&(l(),requestAnimationFrame(l),setTimeout(l,120),setTimeout(l,300),setTimeout(l,800),setTimeout(l,1500))},h=()=>{let p=r(a);p.querySelector(".wm-year-grid-mount")||p.querySelector(".wm-quarter-grid-mount")||s(),u()};c(n.metadataCache.on("resolved",()=>{n.workspace.getActiveFile()?.path===t.path&&s(),o(h,150)})),c(n.workspace.on("file-open",p=>{p?.path===t.path&&s(),o(h,150)})),c(n.metadataCache.on("changed",()=>{n.workspace.getActiveFile()?.path===t.path&&s(),o(h,150)}))}function Je(e){return e.trim().replace(/\\/g,"/").toLowerCase().replace(/\.md$/,"")+".md"}function Zn(e){return(e??"").normalize("NFD").replace(/\p{M}+/gu,"").toLowerCase().replace(/\s+/g," ").replace(/[:.]/g," ").replace(/[0-9]/g," ").replace(/[^\p{L}\s]/gu,"").replace(/\s+/g," ").trim()}function Q(e,n){let t=Zn(n),a=Array.from(e.querySelectorAll(["h1","h2","h3","h4","h5","h6","[data-heading]","[role='heading']","[class^='el-h']",".cm-header",".HyperMD-header"].join(",")));for(let r of a){let s=r.getAttribute("data-heading")??r.textContent??"",i=Zn(s);if(i===t||i.includes(t))return r}return null}function Ze(e,n){let t=e.nextElementSibling;if(t&&t.classList.contains(n))return t;let a=document.createElement("div");return a.classList.add(n),e.insertAdjacentElement("afterend",a),a}function Z(e){let n=r=>!!r&&(r.classList.contains("markdown-reading-view")||r.classList.contains("markdown-preview-view")||r.classList.contains("markdown-rendered")||r.classList.contains("markdown-source-view"));if(n(e))return e;let t=e.closest(".markdown-reading-view")||e.closest(".markdown-preview-view")||e.closest(".markdown-rendered")||e.closest(".markdown-source-view");if(t)return t;let a=e;for(;a&&!n(a);)a=a.parentElement;return a??e}function et(e,n,t="__wmAutoAnnoGeneric"){if(e[t])return;let a=null,r=()=>{a&&window.clearTimeout(a),a=window.setTimeout(n,100)},s=new MutationObserver(i=>{i.every(d=>{if(d.type!=="attributes")return!1;let o=d.target.classList||{contains:()=>!1};return o.contains("wm-wish-link--scheduled")||o.contains("wm-goal-link--scheduled")})||r()});return s.observe(e,{subtree:!0,childList:!0,characterData:!1,attributes:!1}),r(),e[t]=s,()=>{try{s.disconnect()}catch{}e[t]=null}}function tt(e,n){let{resolveFileFromEl:t,scheduledClass:a,payloadKey:r,bindKey:s="__wmBridgeBound_generic"}=n;if(e[s])return;e[s]=!0;let i=d=>{let o=d,l=o.target;if(!l)return;let u=l.closest("a.internal-link, span.cm-hmd-internal-link, span.internal-link");if(!u||u.classList.contains(a))return;let h=t(u);if(!(h instanceof oe.TFile))return;let p=o.dataTransfer;if(!p)return;p.setData("text/x-origin","native"),p.setData(r,h.path),p.setData("text/plain",h.path),p.effectAllowed="copyMove";let g=new Image;g.src=Nt,p.setDragImage(g,0,0),document.body.classList.add("wm-dragging","wm-drag-intent"),document.querySelectorAll(".popover,.mod-hover-popover").forEach(y=>{let m=y;m.style.display="none",m.style.opacity="0",m.style.pointerEvents="none"}),requestAnimationFrame(()=>{try{o.dataTransfer?.setData(r,h.path)}catch{}})},c=()=>{document.body.classList.remove("wm-dragging","wm-drag-intent")};e.addEventListener("dragstart",i,!0),e.addEventListener("dragend",c,!0)}function nt(e){let{grid:n,keys:t,selectors:a,nativeSet:r,filesFor:s,dedupeKey:i,isNative:c,createCard:d,onAppend:o,clearColumns:l=!0}=e,u=t.reduce((p,g)=>(p[g]=0,p),{});if(l)for(let p of t)n.columns[p]?.body.replaceChildren();let h=new Set;for(let p of a){let g=p.key,y=n.columns[g]?.body;if(!y)continue;let m=s(p);for(let b of m){let w=i(b);if(h.has(w))continue;h.add(w);let f=c(b),v=d(b,f);y.appendChild(v),u[g]=(u[g]??0)+1,o?.(v,g)}}return u}function at(e){let{root:n,queryLinks:t,scheduledClass:a,kind:r,dataMime:s,app:i,fileRef:c}=e;t(n).filter(o=>o.tagName.toLowerCase()==="a").forEach(o=>{let l=o;if(l.classList.contains(a)){l.removeAttribute("draggable");return}let u=l.getAttribute("data-href")||l.getAttribute("href")||"",h=i.metadataCache.getFirstLinkpathDest(u,c.path);if(!(h instanceof oe.TFile)||P(h.basename)!==r||l._wmBound)return;l._wmBound=!0,l.setAttribute("draggable","true");let p=null,g=()=>{p||(p=window.setTimeout(()=>{document.body.classList.add("wm-drag-intent"),document.querySelectorAll(".popover,.mod-hover-popover").forEach(m=>{let b=m;b.style.display="none",b.style.opacity="0",b.style.pointerEvents="none"})},500))},y=()=>{p&&(window.clearTimeout(p),p=null),document.body.classList.remove("wm-drag-intent")};l.addEventListener("mousedown",g),l.addEventListener("touchstart",g,{passive:!0}),["mouseup","mouseleave","touchend","touchcancel"].forEach(m=>l.addEventListener(m,y)),l.addEventListener("dragstart",m=>{let b=m.dataTransfer;if(b){b.setData("text/x-origin","native"),b.setData("text/plain",h.path),b.setData(s,h.path),b.effectAllowed="copyMove";let w=new Image;w.src=Nt,b.setDragImage(w,0,0)}document.body.classList.add("wm-dragging","wm-drag-intent"),requestAnimationFrame(()=>{try{m.dataTransfer?.setData(s,h.path)}catch{}})}),l.addEventListener("dragend",()=>{document.body.classList.remove("wm-dragging","wm-drag-intent"),y()})})}function Re(e){let n=e.getAttribute("data-href")||e.getAttribute("href");if(n)return n;let t=e.dataset||{},a=t.href||t.linkPath||t.linkpath||t.originalLink||t.file||t.path||t.target||t.routerHref||t.wikilinkTarget;if(a)return String(a);let s=(e.textContent||"").trim().match(/\[\[([^|\]]+)(?:\|[^\]]+)?\]\]/);return s?s[1].trim():null}function rt(e,n,t,a,r={}){let{emojiPrefix:s="",labelPrefix:i=""}=r,c=Re(t);if(c){let m=e.metadataCache.getFirstLinkpathDest(c,n.path);if(m instanceof oe.TFile&&P(m.basename)===a)return m}let d=(t.textContent||"").trim(),l=(d.match(/\[\[([^|\]]+)(?:\|([^\]]+))?\]\]/)?.[2]||d).trim(),u=m=>m.toLowerCase().replace(/\s+/g," ").trim(),h=s?new RegExp(`^${s.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\$&")}\\s*${i}\\s*-\\s*`,"i"):new RegExp(`^\\p{Extended_Pictographic}\\s*${i}\\s*-\\s*`,"iu"),p=i?new RegExp(`^${i}\\s*-\\s*`,"i"):/^$/,g=e.vault.getMarkdownFiles().filter(m=>P(m.basename)===a),y=g.find(m=>u(m.basename)===u(l));return y||(y=g.find(m=>u(m.basename.replace(h,""))===u(l)),y)||(y=g.find(m=>{let b=m.basename.replace(h,"");return u(b)===u(l.replace(p,""))}),y)||s&&i&&(y=g.find(m=>u(m.basename)===u(`${s}${i?" ":""}${i} - ${l}`)),y)?y:null}function st(e,n,t){let a=["a.internal-link","span.cm-hmd-internal-link","span.internal-link","a[data-href]","[data-link-path]","[data-router-href]","[data-wikilink-target]","[data-linkpath]","[data-original-link]"].join(",");return Array.from(e.querySelectorAll(a)).filter(s=>{let i=t(s);return i instanceof oe.TFile&&P(i.basename)===n})}function ea(e,n,t,a){let r=e.dataTransfer;if(!r)return null;let s=r.getData(a)||r.getData("text/plain")||r.getData("text/uri-list")||"";if(!s)return null;if(!s.endsWith(".md")){let i=n.metadataCache.getFirstLinkpathDest(s,t.path);if(i instanceof oe.TFile)s=i.path;else return null}return s}function ta(e,n,t){let{keys:a,headerFor:r,dataAttrFor:s,payloadKey:i,onDrop:c}=t,d=document.createElement("div");d.classList.add("wm-year-grid");let o={};for(let l of a){let u=document.createElement("div");u.classList.add("wm-year-col");let h=document.createElement("div");h.classList.add("wm-year-col--header"),h.textContent=r(l);let p=document.createElement("div");p.classList.add("wm-year-col--body");let g=s(l);p.setAttribute(g.name,g.value),p.style.pointerEvents="auto",p.style.position="relative",p.addEventListener("dragenter",y=>{p.classList.add("is-dragover");let m=y.dataTransfer;m&&(m.dropEffect="copy"),p.style.boxShadow="inset 0 0 0 2px var(--text-accent)"}),p.addEventListener("dragover",y=>{y.preventDefault(),y.stopPropagation();let m=y.dataTransfer;m&&(m.dropEffect="copy"),p.classList.contains("is-dragover")||(p.classList.add("is-dragover"),p.style.boxShadow="inset 0 0 0 2px var(--text-accent)")}),p.addEventListener("dragleave",()=>{p.classList.remove("is-dragover"),p.style.boxShadow=""}),p.addEventListener("drop",async y=>{y.preventDefault(),y.stopPropagation(),p.classList.remove("is-dragover"),p.style.boxShadow="";let m=ea(y,e,n,i);m&&await c(m,{key:l,body:p})}),u.appendChild(h),u.appendChild(p),d.appendChild(u),o[l]={root:u,header:h,body:p}}return{wrapper:d,columns:o}}function ce(e,n,t,a,r,s){let i=n.map(p=>Q(e,p)).find(p=>!!p)||null;if(!i)return[];let c=p=>/^H[1-6]$/i.test(p.tagName)||p.hasAttribute("data-heading")||p.getAttribute("role")==="heading"||(p.className||"").toString().startsWith("el-h"),d=[];for(let p=i.nextElementSibling;p&&!c(p);p=p.nextElementSibling)d.push(p);let o=[];for(let p of d)o.push(...t(p));let l=[];for(let p of o){let g=a(p);g instanceof oe.TFile&&P(g.basename)===r&&l.push(g.path)}let u=Array.from(new Set(l)),h=s?s():[];return Array.from(new Set([...u,...h]))}function na(e,n,t){let{rows:a,cols:r,keyFor:s,headerFor:i,dataAttrFor:c,payloadKey:d,onDrop:o,placeCell:l,classes:u}=t,h=document.createElement("div");h.classList.add(u?.wrapper||"wm-matrix-grid"),h.style.display="grid",h.style.gridTemplateColumns=`repeat(${r.length}, 1fr)`,h.style.gridAutoRows="minmax(100px, auto)",h.style.gap="8px";let p={},g=new Set,y=(m,b,w=1,f=1)=>{for(let v=m;v<m+w;v++)for(let M=b;M<b+f;M++)g.add(`${v}:${M}`)};for(let m=0;m<a.length;m++){let b=a[m];for(let w=0;w<r.length;w++){let f=r[w],v=s(b,f),M=m+1,T=w+1,F=1,H=1,C=!0;if(l){let S=l(b,f,v)||{};M=S.row??M,T=S.col??T,F=S.rowSpan??F,H=S.colSpan??H,C=S.render!==!1}if(!C)continue;let j=!1;for(let S=M;S<M+F;S++){for(let W=T;W<T+H;W++)if(g.has(`${S}:${W}`)){j=!0;break}if(j)break}if(j)continue;let E=document.createElement("div");E.classList.add(u?.cell||"wm-matrix-cell"),E.style.gridRow=F>1?`${M} / span ${F}`:String(M),E.style.gridColumn=H>1?`${T} / span ${H}`:String(T);let U=document.createElement("div");U.classList.add(u?.header||"wm-matrix-header"),U.textContent=i(b,f);let A=document.createElement("div");A.classList.add(u?.body||"wm-matrix-body");let re=c(b,f);A.setAttribute(re.name,re.value),A.style.pointerEvents="auto",A.style.position="relative",A.addEventListener("dragenter",S=>{A.classList.add("is-dragover");let W=S.dataTransfer;W&&(W.dropEffect="copy"),A.style.boxShadow="inset 0 0 0 2px var(--text-accent)"}),A.addEventListener("dragover",S=>{S.preventDefault(),S.stopPropagation();let W=S.dataTransfer;W&&(W.dropEffect="copy"),A.classList.contains("is-dragover")||(A.classList.add("is-dragover"),A.style.boxShadow="inset 0 0 0 2px var(--text-accent)")}),A.addEventListener("dragleave",()=>{A.classList.remove("is-dragover"),A.style.boxShadow=""}),A.addEventListener("drop",async S=>{S.preventDefault(),S.stopPropagation(),A.classList.remove("is-dragover"),A.style.boxShadow="";let W=ea(S,e,n,d);W&&await o(W,{row:b,col:f,key:v,body:A})}),E.appendChild(U),E.appendChild(A),h.appendChild(E),p[v]={root:E,header:U,body:A},y(M,T,F,H)}}return{wrapper:h,cells:p}}var jt=class extends B.MarkdownRenderChild{constructor(t,a,r){super(r);this.appRef=t;this.fileRef=a;this._peEnabled=window.PointerEvent!==void 0;this._dropTargets=[];this._dragGhost=null;this._dragOverEl=null;this._yearsCache=[]}populateWishes(t,a,r){let s=Array.from(new Set(ce(r,["\u270D\uFE0Fmy wishes","my wishes"],c=>this.queryWishLinks(c),c=>this.resolveWishFileFromEl(c),"wish")));console.log("[area] collectKindFromThisPage ->",s.length,"paths");let i=new Set(s);return console.log("[area] nativePaths count:",s.length),s.length&&console.log("[area] nativePaths sample:",s.slice(0,10)),nt({grid:t,keys:a,selectors:a.map(c=>({key:c,ctx:c})),nativeSet:i,clearColumns:!0,filesFor:({ctx:c})=>{let d=c;return this.appRef.vault.getMarkdownFiles().filter(o=>{if(P(o.basename)!=="wish")return!1;let l=this.appRef.metadataCache.getFileCache(o)?.frontmatter;return K(l).includes(d)})},dedupeKey:c=>Je(c.path),isNative:c=>i.has(c.path),createCard:(c,d)=>{let o=c.basename.trim(),l=d?"native":"external";console.log("[area] createCard",{path:c.path,origin:l});let u=fe(this.appRef,o,c.path,{origin:l,payloadKey:"text/x-wish-path"});return console.log("[area] card element after makeCard",{path:c.path,datasetOrigin:u.dataset.origin,hasExternalClass:u.classList.contains("is-external"),classList:Array.from(u.classList)}),d||u.classList.add("is-external"),u}})}pruneScheduledLinksUnderWishes(t){let a=Q(t,"\u270D\uFE0Fmy wishes")||Q(t,"my wishes");if(!a)return;let r=null;for(let c=a.nextElementSibling;c;c=c.nextElementSibling)if(/^H[1-6]$/i.test(c.tagName)||c.hasAttribute("data-heading")){r=c;break}let s=c=>{let d=!!(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING),o=!r||!!(c.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING);return d&&o},i=()=>{let d=this.queryWishLinks(t).filter(s);for(let o of d){let l=this.resolveWishFileFromEl(o);if(!(l instanceof B.TFile)||P(l.basename)!=="wish")continue;let u=this.appRef.metadataCache.getFileCache(l)?.frontmatter,p=K(u)[0];p?(o.classList.add("wm-wish-link--scheduled"),o.setAttribute("data-year",String(p)),o.tagName.toLowerCase()==="a"&&o.setAttribute("draggable","false")):(o.classList.remove("wm-wish-link--scheduled"),o.removeAttribute("data-year"),o.tagName.toLowerCase()==="a"&&o.setAttribute("draggable","true"))}};requestAnimationFrame(()=>{i(),window.setTimeout(i,150)}),window.setTimeout(()=>{try{let d=t.querySelector(".wm-unscheduled")?.children.length??0;this.queryWishLinks(t).length>0&&d===0&&this.doRender()}catch{}},500)}bindMyWishesAnchors(t){at({root:t,queryLinks:this.queryWishLinks.bind(this),scheduledClass:"wm-wish-link--scheduled",kind:"wish",dataMime:"text/x-wish-path",app:this.appRef,fileRef:this.fileRef})}onload(){Fe();let t="wm-pointer-dnd";if(!document.getElementById(t)){let r=document.createElement("style");r.id=t,r.textContent=`
        .wm-drag-ghost{position:fixed;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);opacity:.9}
        .wm-drop-over{outline:2px solid rgba(0,0,0,.15); outline-offset:-2px}
        @media (hover:none) and (pointer:coarse){
          .wm-card a{pointer-events:none}
        }
      `,document.head.appendChild(r)}let a=Z(this.containerEl);Ve({app:this.appRef,fileRef:this.fileRef,containerEl:this.containerEl,getNoteContainer:Z,render:this.doRender.bind(this),reAnnotate:this.reAnnotateFresh.bind(this),registerEvent:r=>this.registerEvent(r)}),et(a,()=>this.reAnnotateFresh()),tt(a,{resolveFileFromEl:this.resolveWishFileFromEl.bind(this),scheduledClass:"wm-wish-link--scheduled",payloadKey:"text/x-wish-path",bindKey:"__wmBridgeBound_wish"}),this.doRender(),this.reAnnotateFresh()}doRender(){Fe();let t="wm-hide-inline-in-reading";if(!document.getElementById(t)){let w=document.createElement("style");w.id=t,w.textContent=".markdown-reading-view .wm-instruction-inline{display:none!important}",document.head.appendChild(w)}let a=Z(this.containerEl),r=Q(a,"yearly schedule")||Q(a,"my yearly schedule");if(!r)return;let s=r,i=r.nextElementSibling;(i&&(i.classList?.contains("wm-instruction-inline")||i.hasAttribute?.("data-wm-instruction"))||i&&i.tagName?.toLowerCase()==="p")&&(s=i);let c=a.querySelector(".wm-year-grid-mount")||Ze(s,"wm-year-grid-mount");c.innerHTML="";let d=new Date,o=[String(d.getFullYear()),String(d.getFullYear()+1)];this._yearsCache=o;let l=document.createElement("div");l.classList.add("wm-year-instruction"),l.textContent="Long press a card and drag it.",c.appendChild(l);let u=this.renderYearGrid(o);c.appendChild(u.wrapper),u.wrapper.style.gridTemplateColumns="1fr 1fr 1fr";let h=document.createElement("div"),p=document.createElement("div"),g=document.createElement("div");h.classList.add("wm-year-col"),h.classList.add("wm-year-col--unscheduled"),p.classList.add("wm-year-col--header"),p.textContent="Unscheduled",g.classList.add("wm-year-col--body","wm-unscheduled"),g.setAttribute("data-year","unscheduled"),g.style.pointerEvents="auto",g.style.position="relative",h.appendChild(p),h.appendChild(g),u.wrapper.insertBefore(h,u.wrapper.firstChild),this._dropTargets=[g,...Object.values(u.columns).map(w=>w.body)],g.addEventListener("dragenter",w=>{g.classList.add("is-dragover");let f=w.dataTransfer;(f?.getData("text/x-origin")||"")!=="external"&&f&&(f.dropEffect="copy")}),g.addEventListener("dragover",w=>{w.preventDefault(),w.stopPropagation(),g.classList.add("is-dragover");let f=w.dataTransfer;f&&(f.dropEffect="copy")}),g.addEventListener("drop",async w=>{w.preventDefault(),w.stopPropagation(),g.classList.remove("is-dragover");let f=w.dataTransfer;if((f?.getData("text/x-origin")||"")==="external")return;let M=f?.getData("text/x-wish-path")||f?.getData("text/plain")||f?.getData("text/uri-list")||"";if(M&&!M.endsWith(".md")){let F=this.appRef.metadataCache.getFirstLinkpathDest(M,this.fileRef.path);F instanceof B.TFile&&(M=F.path)}if(!M)return;let T=this.appRef.vault.getAbstractFileByPath(M);T instanceof B.TFile&&await this.appRef.fileManager.processFrontMatter(T,F=>{let H=Array.isArray(F?.tags)?F.tags.slice():typeof F?.tags=="string"?[F.tags]:[],C=J(H);C.length>0?F.tags=C:delete F.tags});try{let F=this.appRef.metadataCache.getBacklinksForFile(T)?.data??{};for(let H of Object.keys(F)){let C=this.appRef.vault.getAbstractFileByPath(H);if(!(C instanceof B.TFile))continue;let j=P(C.basename);(j==="goal"||j==="project"||j==="task"||j==="wish")&&await this.appRef.fileManager.processFrontMatter(C,E=>{let U=Array.isArray(E?.tags)?E.tags.slice():typeof E?.tags=="string"?[E.tags]:[],A=J(ae(U));A.length>0?E.tags=A:delete E.tags,j==="task"&&delete E.due})}}catch{}this.doRender()});let y=0,m=ce(a,["\u270D\uFE0Fmy wishes","my wishes"],w=>this.queryWishLinks(w),w=>this.resolveWishFileFromEl(w),"wish");for(let w of m){let f=this.appRef.vault.getAbstractFileByPath(w);if(!(f instanceof B.TFile)||P(f.basename)!=="wish")continue;let v=this.appRef.metadataCache.getFileCache(f)?.frontmatter;if(K(v).length>0)continue;let T=fe(this.appRef,f.basename.trim(),f.path,{origin:"native",payloadKey:"text/x-wish-path"});g.appendChild(T),y++}y>0?p.textContent=`\u26A0\uFE0F Unscheduled (${y})`:p.textContent="Unscheduled";let b=this.populateWishes(u,o,a);for(let w of o){let f=u.columns[w];if(!f)continue;let v=b[w]??0;f.header.textContent=v>0?`${w} (${v})`:w}}reAnnotateFresh(){let t=Z(this.containerEl);if(t)try{this.pruneScheduledLinksUnderWishes(t),this.bindMyWishesAnchors(t)}catch{}}getLinkpathFromEl(t){return Re(t)}resolveWishFileFromEl(t){return rt(this.appRef,this.fileRef,t,"wish",{emojiPrefix:"\u2728",labelPrefix:"Wish"})}queryWishLinks(t){return st(t,"wish",this.resolveWishFileFromEl.bind(this))}renderYearGrid(t){return ta(this.appRef,this.fileRef,{keys:t,headerFor:a=>a,dataAttrFor:a=>({name:"data-year",value:a}),payloadKey:"text/x-wish-path",onDrop:async(a,{key:r})=>{await this.onDropWishToYear(a,r),this.doRender()}})}createCard(t,a){let r=fe(this.appRef,t.basename.trim(),t.path,{origin:a?"native":"external",payloadKey:"text/x-wish-path"});try{this.bindPointerDrag(r,t.path)}catch{}return r}collectWishesFromThisPage(t){return ce(t,["\u270D\uFE0Fmy wishes","my wishes"],a=>this.queryWishLinks(a),a=>this.resolveWishFileFromEl(a),"wish",()=>this.collectWishesFromCache())}collectAllWishesWithYear(t,a){return this.appRef.vault.getMarkdownFiles().filter(s=>P(s.basename)==="wish").filter(s=>{if(a.has(s.path))return!1;let i=this.appRef.metadataCache.getFileCache(s)?.frontmatter;return K(i).includes(t)})}collectWishesFromCache(){let a=(this.appRef.metadataCache.getFileCache(this.fileRef)?.links??[]).map(i=>i.link).filter(Boolean),r=[];for(let i of a){let c=this.appRef.metadataCache.getFirstLinkpathDest(i,this.fileRef.path);c instanceof B.TFile&&P(c.basename)==="wish"&&r.push(c.path)}return Array.from(new Set(r))}async onDropWishToYear(t,a){let r=this.appRef.vault.getAbstractFileByPath(t);if(r instanceof B.TFile){await this.appRef.fileManager.processFrontMatter(r,s=>{Me(s,String(a))});try{let s=this.appRef.metadataCache.getBacklinksForFile(r)?.data??{};for(let i of Object.keys(s)){let c=this.appRef.vault.getAbstractFileByPath(i);if(!(c instanceof B.TFile))continue;let d=P(c.basename);(d==="goal"||d==="project"||d==="task"||d==="wish")&&await this.appRef.fileManager.processFrontMatter(c,o=>{Me(o,String(a));let l=Array.isArray(o?.tags)?o.tags.slice():typeof o?.tags=="string"?[o.tags]:[],u=ae(l);u.length>0?o.tags=u:delete o.tags,d==="task"&&delete o.due})}}catch{}}}bindPointerDrag(t,a){this._peEnabled&&t.addEventListener("pointerdown",r=>{if(r.pointerType==="mouse")return;r.preventDefault(),t.setPointerCapture(r.pointerId),this._dragGhost=this.makeGhost(t),document.body.appendChild(this._dragGhost),this.moveGhost(r.clientX,r.clientY);let s=c=>{this._dragGhost&&(this.moveGhost(c.clientX,c.clientY),this.highlightOver(c.clientX,c.clientY))},i=async c=>{t.releasePointerCapture(c.pointerId),document.removeEventListener("pointermove",s,!0),document.removeEventListener("pointerup",i,!0),this.clearHighlight(),this._dragGhost&&(this._dragGhost.remove(),this._dragGhost=null);let d=this.hitTarget(c.clientX,c.clientY);if(!d)return;let o=d.getAttribute("data-year")||"unscheduled";o==="unscheduled"?await this.unscheduleByPath(a):await this.onDropWishToYear(a,o),this.doRender()};document.addEventListener("pointermove",s,!0),document.addEventListener("pointerup",i,!0)},{passive:!1})}makeGhost(t){let a=t.cloneNode(!0);return a.classList.add("wm-drag-ghost"),a.style.width=Math.min(220,t.getBoundingClientRect().width)+"px",a}moveGhost(t,a){this._dragGhost&&(this._dragGhost.style.left=t+"px",this._dragGhost.style.top=a+"px")}hitTarget(t,a){for(let r of this._dropTargets){let s=r.getBoundingClientRect();if(t>=s.left&&t<=s.right&&a>=s.top&&a<=s.bottom)return r}return null}highlightOver(t,a){let r=this.hitTarget(t,a);r!==this._dragOverEl&&(this._dragOverEl&&this._dragOverEl.classList.remove("wm-drop-over"),this._dragOverEl=r,this._dragOverEl&&this._dragOverEl.classList.add("wm-drop-over"))}clearHighlight(){this._dragOverEl&&this._dragOverEl.classList.remove("wm-drop-over"),this._dragOverEl=null}async unscheduleByPath(t){let a=this.appRef.vault.getAbstractFileByPath(t);a instanceof B.TFile&&await this.appRef.fileManager.processFrontMatter(a,r=>{let s=Array.isArray(r?.tags)?r.tags.slice():typeof r?.tags=="string"?[r.tags]:[],i=J(s);i.length>0?r.tags=i:delete r.tags})}},it=class{constructor(n){this.app=n}async postProcess(n,t){let a=this.app.vault.getAbstractFileByPath(t.sourcePath);if(!(a instanceof B.TFile)||!/area/i.test(a.basename))return;let r=n.closest(".markdown-reading-view")||n.closest(".markdown-preview-view")||n.closest(".markdown-rendered")||n,s=new jt(this.app,a,r);t.addChild(s)}};var N=require("obsidian");var Wt=class extends N.MarkdownRenderChild{constructor(t,a,r){super(r);this.appRef=t;this.fileRef=a;this._peEnabled=window.PointerEvent!==void 0;this._dropTargets=[];this._dragGhost=null;this._dragOverEl=null;this._yearsCache=[];this._didStagePass=!1;this._quarterKeys=null;this._nativeGoalSet=new Set}findParentWishForGoal(t){let a=this.appRef.metadataCache.getBacklinksForFile(t)?.data??{};for(let r of Object.keys(a)){let s=this.appRef.vault.getAbstractFileByPath(r);if(s instanceof N.TFile&&P(s.basename)==="wish")return s}return null}populateGoalsByQuarter(t,a,r){let s=Array.from(new Set(ce(r,["\u270D\uFE0Fmy goals","my goals"],c=>this.queryGoalLinks(c),c=>this.resolveGoalFileFromEl(c),"goal")));console.log("[goal] collectKindFromThisPage ->",s.length,"paths");let i=new Set(s);return this._nativeGoalSet=i,console.log("[goal] nativePaths count:",s.length),s.length&&console.log("[goal] nativePaths sample:",s.slice(0,10)),nt({grid:t,keys:a,selectors:a.map(c=>{let[d,o]=c.split("-Q");return{key:c,ctx:{y:d,q:`Q${o}`}}}),nativeSet:i,clearColumns:!0,filesFor:({ctx:c})=>this.appRef.vault.getMarkdownFiles().filter(o=>{if(P(o.basename)!=="goal")return!1;let l=this.appRef.metadataCache.getFileCache(o)?.frontmatter,u=Xe(l,c.y),h=u.some(p=>_t(p)?.q===c.q);return h&&console.debug("[wish] bucket match",{path:o.path,year:c.y,quarter:c.q,tags:u}),h}),dedupeKey:c=>Je(c.path),isNative:c=>i.has(c.path),createCard:(c,d)=>{let o=this.appRef.metadataCache.getFileCache(c)?.frontmatter,l=o?.["high impact"]??o?.high_impact??o?.highImpact,u=l===!0||l==="true"||l===1||l==="1",h=c.basename.trim()+(u?" \u{1F4AA}":""),p=d?"native":"external",g=fe(this.appRef,h,c.path,{origin:p,payloadKey:"text/x-goal-path"});return d||g.classList.add("is-external"),g}})}pruneScheduledLinksUnderGoals(t){let a=Q(t,"\u270D\uFE0Fmy goals")||Q(t,"my goals");if(!a)return;let r=null;for(let c=a.nextElementSibling;c;c=c.nextElementSibling)if(/^H[1-6]$/i.test(c.tagName)||c.hasAttribute("data-heading")){r=c;break}let s=c=>{let d=!!(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING),o=!r||!!(c.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING);return d&&o},i=()=>{let d=this.queryGoalLinks(t).filter(s);for(let o of d){let l=this.resolveGoalFileFromEl(o);if(!(l instanceof N.TFile)||P(l.basename)!=="goal")continue;let u=this.appRef.metadataCache.getFileCache(l)?.frontmatter,h=Xe(u),p=h.length?_t(h[0]):null,g=p?.year??(K(u)[0]||""),y=p?.q||"",m=o.matches("a,span.cm-hmd-internal-link,span.internal-link")?o:o.querySelector("a,span.cm-hmd-internal-link,span.internal-link");g||y?(o.classList.add("wm-goal-link--scheduled"),g&&o.setAttribute("data-year",String(g)),y&&o.setAttribute("data-quarter",y),m&&(m.classList.add("wm-goal-link--scheduled"),g&&m.setAttribute("data-year",String(g)),y&&m.setAttribute("data-quarter",y),m.tagName.toLowerCase()==="a"&&m.setAttribute("draggable","false"))):(o.classList.remove("wm-goal-link--scheduled"),o.removeAttribute("data-year"),o.removeAttribute("data-quarter"),m&&(m.classList.remove("wm-goal-link--scheduled"),m.removeAttribute("data-year"),m.removeAttribute("data-quarter"),m.tagName.toLowerCase()==="a"&&m.setAttribute("draggable","true")))}requestAnimationFrame(()=>{i(),window.setTimeout(i,150)}),window.setTimeout(()=>{try{let l=t.querySelector(".wm-unscheduled")?.children.length??0;this.queryGoalLinks(t).length>0&&l===0&&this.doRender()}catch{}},500)}}bindMyGoalsAnchors(t){at({root:t,queryLinks:this.queryGoalLinks.bind(this),scheduledClass:"wm-goal-link--scheduled",kind:"goal",dataMime:"text/x-goal-path",app:this.appRef,fileRef:this.fileRef})}onload(){Fe();let t="wm-quarter-badge";if(!document.getElementById(t)){let s=document.createElement("style");s.id=t,s.textContent=`
        a.wm-goal-link--scheduled::after,
        .wm-goal-link--scheduled a::after,
        span.cm-hmd-internal-link.wm-goal-link--scheduled::after,
        .wm-goal-link--scheduled span.cm-hmd-internal-link::after,
        span.internal-link.wm-goal-link--scheduled::after,
        .wm-goal-link--scheduled span.internal-link::after {
        content: attr(data-year) "-" attr(data-quarter); /* e.g. 2026-Q1 */
        margin-left: .5rem;
        font-size: .8em;
         padding: .05rem .35rem;
        border-radius: .35rem;
        background: var(--tag-background, rgba(128,128,128,.15));
        color: var(--text-muted);
      }
      `,document.head.appendChild(s)}let a="wm-pointer-dnd";if(!document.getElementById(a)){let s=document.createElement("style");s.id=a,s.textContent=`
        .wm-drag-ghost{position:fixed;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);opacity:.9}
        .wm-drop-over{outline:2px solid rgba(0,0,0,.15); outline-offset:-2px}
        @media (hover:none) and (pointer:coarse){
          .wm-card a{pointer-events:none}
        }
      `,document.head.appendChild(s)}let r=Z(this.containerEl);Ve({app:this.appRef,fileRef:this.fileRef,containerEl:this.containerEl,getNoteContainer:Z,render:this.doRender.bind(this),reAnnotate:this.reAnnotateFresh.bind(this),registerEvent:s=>this.registerEvent(s)}),et(r,()=>this.reAnnotateFresh()),tt(r,{resolveFileFromEl:this.resolveGoalFileFromEl.bind(this),scheduledClass:"wm-goal-link--scheduled",payloadKey:"text/x-goal-path",bindKey:"__wmBridgeBound_goal"}),this.doRender(),this.reAnnotateFresh(),setTimeout(()=>{try{this.reAnnotateFresh()}catch{}},120),setTimeout(()=>{try{this.doRender()}catch{}},80)}doRender(){Fe();let t="wm-hide-inline-in-reading";if(!document.getElementById(t)){let T=document.createElement("style");T.id=t,T.textContent=".markdown-reading-view .wm-instruction-inline{display:none!important}",document.head.appendChild(T)}let a=Z(this.containerEl),r=Q(a,"quarterly schedule")||Q(a,"my quarterly schedule");if(!r)return;let s=r,i=r.nextElementSibling;(i&&(i.classList?.contains("wm-instruction-inline")||i.hasAttribute?.("data-wm-instruction"))||i&&i.tagName?.toLowerCase()==="p")&&(s=i);let c=a.querySelector(".wm-quarter-grid-mount")||Ze(s,"wm-quarter-grid-mount");c.innerHTML="";let d=new Date,o=d.getFullYear(),l=Math.floor(d.getMonth()/3)+1,u=o,h=l,p=[];for(let T=0;T<4;T++)p.push(`${u}-Q${h}`),h++,h>4&&(h=1,u++);let g=p;this._yearsCache=[String(o)];let y=document.createElement("div");y.classList.add("wm-quarter-instruction"),y.textContent="Long press a card and drag it.",c.appendChild(y);let m=this.renderQuarterGrid(g);c.appendChild(m.wrapper),m.wrapper.style.marginTop="0.75rem",m.wrapper.style.paddingBottom="0.5rem";let b=m.wrapper.querySelector('.wm-year-col--body[data-quarter="unscheduled"]'),w=b?b.previousElementSibling:null;this._dropTargets=[b,...Object.values(m.columns).map(T=>T.body)],b.addEventListener("dragenter",T=>{b.classList.add("is-dragover");let F=T.dataTransfer;(F?.getData("text/x-origin")||"")!=="external"&&F&&(F.dropEffect="copy")}),b.addEventListener("dragover",T=>{T.preventDefault(),T.stopPropagation(),b.classList.add("is-dragover");let F=T.dataTransfer;F&&(F.dropEffect="copy")}),b.addEventListener("drop",async T=>{T.preventDefault(),T.stopPropagation(),b.classList.remove("is-dragover");let F=T.dataTransfer;if((F?.getData("text/x-origin")||"")==="external")return;let C=F?.getData("text/x-goal-path")||F?.getData("text/plain")||F?.getData("text/uri-list")||"";if(C&&!C.endsWith(".md")){let E=this.appRef.metadataCache.getFirstLinkpathDest(C,this.fileRef.path);E instanceof N.TFile&&(C=E.path)}if(!C)return;let j=this.appRef.vault.getAbstractFileByPath(C);j instanceof N.TFile&&await this.appRef.fileManager.processFrontMatter(j,E=>{let U=Array.isArray(E?.tags)?E.tags.slice():typeof E?.tags=="string"?[E.tags]:[],A=ae(J(U));A.length>0?E.tags=A:delete E.tags});try{let E=this.appRef.metadataCache.getBacklinksForFile(j)?.data??{};for(let U of Object.keys(E)){let A=this.appRef.vault.getAbstractFileByPath(U);if(!(A instanceof N.TFile))continue;let re=P(A.basename);(re==="goal"||re==="project"||re==="task"||re==="")&&await this.appRef.fileManager.processFrontMatter(A,S=>{let W=Array.isArray(S?.tags)?S.tags.slice():typeof S?.tags=="string"?[S.tags]:[],zt=J(ae(W));zt.length>0?S.tags=zt:delete S.tags,re==="task"&&delete S.due})}}catch{}this.doRender()});let f=0,v=ce(a,["\u270D\uFE0Fmy goals","my goals"],T=>this.queryGoalLinks(T),T=>this.resolveGoalFileFromEl(T),"goal",()=>this.collectWishesFromCache());for(let T of v){let F=this.appRef.vault.getAbstractFileByPath(T);if(!(F instanceof N.TFile)||P(F.basename)!=="goal")continue;let H=this.appRef.metadataCache.getFileCache(F)?.frontmatter,C=K(H),j=Xe(H);if(C.length>0||j.length>0)continue;let E=this.createCard(F,!0);b.appendChild(E),f++}f>0?w&&(w.textContent=`\u26A0\uFE0F Unscheduled (${f})`):w&&(w.textContent="Unscheduled");let M=this.populateGoalsByQuarter(m,g,a);for(let T of g){let F=m.columns[T];if(!F)continue;let H=M[T]??0;F.header.textContent=H>0?`${T} (${H})`:T}this._didStagePass||(this._didStagePass=!0,[150,400,900].forEach(T=>setTimeout(()=>{try{this.doRender()}catch{}},T)))}reAnnotateFresh(){let t=Z(this.containerEl);if(t)try{this.pruneScheduledLinksUnderGoals(t),this.bindMyGoalsAnchors(t)}catch{}}getLinkpathFromEl(t){return Re(t)}resolveGoalFileFromEl(t){return rt(this.appRef,this.fileRef,t,"goal",{emojiPrefix:"\u{1F3AF}",labelPrefix:"Goal"})}queryGoalLinks(t){return st(t,"goal",this.resolveGoalFileFromEl.bind(this))}renderQuarterGrid(t){let a=["r1","r2"],r=["c1","c2","c3"],s={"r1-c1":null,"r1-c2":t[0]??null,"r1-c3":t[1]??null,"r2-c1":null,"r2-c2":t[2]??null,"r2-c3":t[3]??null},i=na(this.appRef,this.fileRef,{rows:[...a],cols:[...r],keyFor:(d,o)=>`${d}-${o}`,headerFor:(d,o)=>d==="r1"&&o==="c1"?"Unscheduled":s[`${d}-${o}`]??"",dataAttrFor:(d,o)=>d==="r1"&&o==="c1"?{name:"data-quarter",value:"unscheduled"}:{name:"data-quarter",value:s[`${d}-${o}`]??"none"},payloadKey:"text/x-goal-path",onDrop:async(d,{row:o,col:l})=>{let u=s[`${o}-${l}`];if(u){let[h,p]=u.split("-Q");await this.onDropGoalToQuarter(d,h,`Q${p}`),this.doRender()}},placeCell:(d,o,l)=>{let u=a.indexOf(d)+1,h=r.indexOf(o)+1;return d==="r1"&&o==="c1"?{row:1,col:1,rowSpan:2}:d==="r2"&&o==="c1"?{row:u,col:h,render:!1}:{row:u,col:h}},classes:{wrapper:"wm-year-grid",cell:"wm-year-col",header:"wm-year-col--header",body:"wm-year-col--body"}}),c={};for(let d of a)for(let o of r){let l=s[`${d}-${o}`];if(!l)continue;let u=i.cells[`${d}-${o}`];u&&(c[l]=u)}return{wrapper:i.wrapper,columns:c}}createCard(t,a){let r=this.appRef.metadataCache.getFileCache(t)?.frontmatter,s=r?.["high impact"]??r?.high_impact??r?.highImpact,i=s===!0||s==="true"||s===1||s==="1",c=t.basename.trim()+(i?" \u{1F4AA}":""),d=fe(this.appRef,c,t.path,{origin:a?"native":"external",payloadKey:"text/x-goal-path"});try{this.bindPointerDrag(d,t.path)}catch{}return d}collectGoalsFromThisPage(t){return ce(t,["\u270D\uFE0Fmy goals","my goals"],a=>this.queryGoalLinks(a),a=>this.resolveGoalFileFromEl(a),"goal",()=>this.collectWishesFromCache())}collectAllWishesWithYear(t,a){return this.appRef.vault.getMarkdownFiles().filter(s=>P(s.basename)==="goal").filter(s=>{if(a.has(s.path))return!1;let i=this.appRef.metadataCache.getFileCache(s)?.frontmatter;return K(i).includes(t)})}collectWishesFromCache(){let a=(this.appRef.metadataCache.getFileCache(this.fileRef)?.links??[]).map(i=>i.link).filter(Boolean),r=[];for(let i of a){let c=this.appRef.metadataCache.getFirstLinkpathDest(i,this.fileRef.path);c instanceof N.TFile&&P(c.basename)==="goal"&&r.push(c.path)}return Array.from(new Set(r))}async onDropWishToYear(t,a){let r=this.appRef.vault.getAbstractFileByPath(t);if(r instanceof N.TFile){await this.appRef.fileManager.processFrontMatter(r,s=>{Me(s,String(a))});try{let s=this.appRef.metadataCache.getBacklinksForFile(r)?.data??{};for(let i of Object.keys(s)){let c=this.appRef.vault.getAbstractFileByPath(i);if(!(c instanceof N.TFile))continue;let d=P(c.basename);(d==="goal"||d==="project"||d==="task"||d==="")&&await this.appRef.fileManager.processFrontMatter(c,o=>{Me(o,String(a));let l=Array.isArray(o?.tags)?o.tags.slice():typeof o?.tags=="string"?[o.tags]:[],u=ae(l);u.length>0?o.tags=u:delete o.tags,d==="task"&&delete o.due})}}catch{}try{let s=this._nativeGoalSet.has(t)?this.fileRef:this.findParentWishForGoal(r);if(s instanceof N.TFile){let i=this.appRef.metadataCache.getFileCache(s)?.frontmatter;(K(i)[0]||null)!==String(a)&&await this.appRef.fileManager.processFrontMatter(s,o=>{let l=Array.isArray(o?.tags)?o.tags.slice():typeof o?.tags=="string"?[o.tags]:[],u=J(l);o.tags=[...u,`Y${a}`]})}}catch{}}}bindPointerDrag(t,a){this._peEnabled&&t.addEventListener("pointerdown",r=>{if(r.pointerType==="mouse")return;r.preventDefault(),t.setPointerCapture(r.pointerId),this._dragGhost=this.makeGhost(t),document.body.appendChild(this._dragGhost),this.moveGhost(r.clientX,r.clientY);let s=c=>{this._dragGhost&&(this.moveGhost(c.clientX,c.clientY),this.highlightOver(c.clientX,c.clientY))},i=async c=>{t.releasePointerCapture(c.pointerId),document.removeEventListener("pointermove",s,!0),document.removeEventListener("pointerup",i,!0),this.clearHighlight(),this._dragGhost&&(this._dragGhost.remove(),this._dragGhost=null);let d=this.hitTarget(c.clientX,c.clientY);if(!d)return;let o=d.getAttribute("data-quarter")||"";if(o==="unscheduled")console.debug("[wish] pointer-drop -> unschedule",{filePath:a}),await this.unscheduleByPath(a);else{let[l,u]=o.split("-Q");await this.onDropGoalToQuarter(a,l,`Q${u}`)}this.doRender()};document.addEventListener("pointermove",s,!0),document.addEventListener("pointerup",i,!0)},{passive:!1})}makeGhost(t){let a=t.cloneNode(!0);return a.classList.add("wm-drag-ghost"),a.style.width=Math.min(220,t.getBoundingClientRect().width)+"px",a}moveGhost(t,a){this._dragGhost&&(this._dragGhost.style.left=t+"px",this._dragGhost.style.top=a+"px")}hitTarget(t,a){for(let r of this._dropTargets){let s=r.getBoundingClientRect();if(t>=s.left&&t<=s.right&&a>=s.top&&a<=s.bottom)return r}return null}highlightOver(t,a){let r=this.hitTarget(t,a);r!==this._dragOverEl&&(this._dragOverEl&&this._dragOverEl.classList.remove("wm-drop-over"),this._dragOverEl=r,this._dragOverEl&&this._dragOverEl.classList.add("wm-drop-over"))}clearHighlight(){this._dragOverEl&&this._dragOverEl.classList.remove("wm-drop-over"),this._dragOverEl=null}async unscheduleByPath(t){let a=this.appRef.vault.getAbstractFileByPath(t);a instanceof N.TFile&&(console.debug("[wish] unschedule goal",t),await this.appRef.fileManager.processFrontMatter(a,r=>{let s=Array.isArray(r?.tags)?r.tags.slice():typeof r?.tags=="string"?[r.tags]:[],i=ae(J(s));i.length>0?r.tags=i:delete r.tags}))}async onDropGoalToQuarter(t,a,r){console.debug("[wish] mutate goal quarter",t,a,r);let s=this.appRef.vault.getAbstractFileByPath(t);if(!(s instanceof N.TFile))return;await this.appRef.fileManager.processFrontMatter(s,c=>{Yt(c,a,r)});let i=this._nativeGoalSet?.has(t)?this.fileRef:this.findParentWishForGoal(s);if(i instanceof N.TFile){let c=this.appRef.metadataCache.getFileCache(i)?.frontmatter,o=K(c)[0]||null;console.debug("[wish] parent wish retag check",{parent:i.path,currentYearTag:o,targetYear:String(a)}),o!==String(a)&&(await this.appRef.fileManager.processFrontMatter(i,l=>{let u=Array.isArray(l?.tags)?l.tags.slice():typeof l?.tags=="string"?[l.tags]:[],h=J(u);l.tags=[...h,`Y${a}`]}),console.debug("[wish] parent wish retagged",{parent:i.path,newYear:`Y${a}`}))}try{let c=this.appRef.metadataCache.getBacklinksForFile(s)?.data??{};for(let d of Object.keys(c)){let o=this.appRef.vault.getAbstractFileByPath(d);if(!(o instanceof N.TFile))continue;let l=P(o.basename);(l==="project"||l==="task")&&await this.appRef.fileManager.processFrontMatter(o,u=>{Yt(u,a,r),l==="task"&&delete u.due})}}catch{}}},ot=class{constructor(n){this.app=n}async postProcess(n,t){let a=this.app.vault.getAbstractFileByPath(t.sourcePath);if(!(a instanceof N.TFile)||!/wish/i.test(a.basename))return;console.debug("[wish] matched note:",a.basename);let r=n.closest(".markdown-reading-view")||n.closest(".markdown-preview-view")||n.closest(".markdown-rendered")||n,s=new Wt(this.app,a,r);t.addChild(s)}};var ht=require("obsidian");var ct=class{constructor(){this.data={nodes:new Map,byType:{area:new Set,wish:new Set,goal:new Set,project:new Set,task:new Set},childrenOf:new Map,observersOf:new Map,unscheduled:{goal:0,project:0,task:0},ready:!1}}reset(){this.data.nodes.clear(),Object.keys(this.data.byType).forEach(n=>this.data.byType[n].clear()),this.data.childrenOf.clear(),this.data.observersOf.clear(),this.data.unscheduled={goal:0,project:0,task:0},this.data.ready=!1}get(){return this.data}markReady(){this.data.ready=!0}isReady(){return this.data.ready}upsertNode(n){this.data.nodes.set(n.path,n),n.type&&this.data.byType[n.type].add(n.path)}removeNode(n){let t=this.data.nodes.get(n);t?.type&&this.data.byType[t.type].delete(n),this.data.nodes.delete(n),this.data.childrenOf.delete(n),this.data.observersOf.delete(n);for(let a of this.data.childrenOf.values())a.delete(n);for(let a of this.data.observersOf.values())a.delete(n)}setPrimaryEdge(n,t){for(let[a,r]of this.data.childrenOf)r.delete(n);t&&(this.data.childrenOf.has(t)||this.data.childrenOf.set(t,new Set),this.data.childrenOf.get(t).add(n))}setObserverEdges(n,t){for(let[a,r]of this.data.observersOf)t.has(a)||r.delete(n);for(let a of t)this.data.observersOf.has(a)||this.data.observersOf.set(a,new Set),this.data.observersOf.get(a).add(n)}getNode(n){return this.data.nodes.get(n)}getByType(n){return[...this.data.byType[n]].map(t=>this.data.nodes.get(t)).filter(Boolean)}getUnscheduledCounts(){return{...this.data.unscheduled}}setUnscheduledCounts(n){this.data.unscheduled=n}};var Oe={YEAR:/#year\/(\d{4})/i,QUARTER:/#quarter\/(\d{4}-Q[1-4])/i,MONTH:/#month\/(\d{4})-(\d{2})/i,WEEK:/#week\/(\d{4})-W(\d{2})/i,DUE:/#due\/(\d{4})-(\d{2})-(\d{2})/i};function Bt(e){let n={},t=e.match(Oe.YEAR);t&&(n.year=t[1]);let a=e.match(Oe.QUARTER);a&&(n.quarter=a[1]);let r=e.match(Oe.MONTH);r&&(n.month=`${r[1]}-${r[2].padStart(2,"0")}`);let s=e.match(Oe.WEEK);s&&(n.week=`${s[1]}-W${s[2].padStart(2,"0")}`);let i=e.match(Oe.DUE);return i&&(n.due=`${i[1]}-${i[2].padStart(2,"0")}-${i[3].padStart(2,"0")}`),Ne(n)}function aa(e){return e?Bt(e):{}}function ra(e){let n=Ne(e),t=[];return n.year&&t.push(`#year/${n.year}`),n.quarter&&t.push(`#quarter/${n.quarter}`),n.month&&t.push(`#month/${n.month}`),n.week&&t.push(`#week/${n.week}`),n.due&&t.push(`#due/${n.due}`),`<!-- wishmap: ${t.join(" ")} -->`}function Ne(e){let n={};if(e.year&&/^\d{4}$/.test(e.year)&&(n.year=e.year),e.quarter&&/^\d{4}-Q[1-4]$/.test(e.quarter)&&(n.quarter=e.quarter),e.month&&/^\d{4}-\d{1,2}$/.test(e.month)){let[t,a]=e.month.split("-").map(Number);a>=1&&a<=12&&(n.month=`${t}-${String(a).padStart(2,"0")}`)}if(e.week&&/^\d{4}-W\d{1,2}$/.test(e.week)){let[t,a]=e.week.replace("W","").split("-").map(Number);a>=1&&a<=53&&(n.week=`${t}-W${String(a).padStart(2,"0")}`)}if(e.due&&/^\d{4}-\d{1,2}-\d{1,2}$/.test(e.due)){let[t,a,r]=e.due.split("-").map(Number);a>=1&&a<=12&&r>=1&&r<=31&&(n.due=`${t}-${String(a).padStart(2,"0")}-${String(r).padStart(2,"0")}`)}return n}function It(e){let n={due:Ne({due:e}).due};if(!n.due)return n;let[t,a,r]=n.due.split("-").map(Number);return n.year=String(t),n.month=`${t}-${String(a).padStart(2,"0")}`,n.quarter=`${t}-Q${Math.floor((a-1)/3)+1}`,n.week=`${t}-W${String(ms(new Date(t,a-1,r))).padStart(2,"0")}`,n}function sa(e,n){let t=["due","week","month","quarter","year"];for(let a of t){let r=e[a],s=n[a];if(!r&&!s)continue;if(r&&!s)return-1;if(!r&&s)return 1;let i=ps(a,r,s);if(i!==0)return i}return 0}function ps(e,n,t){switch(e){case"due":case"week":case"month":return n<t?-1:n>t?1:0;case"quarter":{let[a,r]=n.split("-Q").map(Number),[s,i]=t.split("-Q").map(Number);return a!==s?a<s?-1:1:r<i?-1:r>i?1:0}case"year":{let a=Number(n),r=Number(t);return a<r?-1:a>r?1:0}default:return 0}}function ms(e){let n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));let t=new Date(Date.UTC(n.getUTCFullYear(),0,1));return Math.ceil(((n.getTime()-t.getTime())/864e5+1)/7)}function gs(e){let n=e.trim().match(/^(?:\p{Emoji_Presentation}|\p{Emoji}\uFE0F)/u);return n?n[0]:void 0}function ia(e){let n=gs(e)||"",t=e.toLowerCase();if(n==="\u{1F331}"||t.startsWith("area "))return"area";if(n==="\u2728"||t.startsWith("wish "))return"wish";if(n==="\u{1F3AF}"||t.startsWith("goal "))return"goal";if(n==="\u{1F680}"||t.startsWith("project "))return"project";if(n==="\u{1F4CC}"||t.startsWith("task "))return"task"}function lt(e){let n=e.match(/<!--\s*wishmap:\s*([^>]*)-->/i);return n?n[0]:void 0}function oa(e){let n=Bt(e),t=aa(lt(e)??"");return{year:t.year??n.year,quarter:t.quarter??n.quarter,month:t.month??n.month,week:t.week??n.week,due:t.due??n.due}}function ca(e){let n=new Set,t=/^(?:Parents?|Parent)\s*:\s*(.*)$/i,a=e.split(/\r?\n/);for(let r of a){let s=r.match(t);if(!s)continue;let i=s[1].match(/\[\[([^\]]+)\]\]/g)||[];for(let c of i){let d=c.slice(2,-2).trim();d&&n.add(d)}}return n}async function la(e,n){let t=new Set,r=(await e.vault.read(n)).match(/\[\[([^\]]+)\]\]/g)||[];for(let s of r){let i=s.slice(2,-2).trim();i&&t.add(i)}return t}async function dt(e,n,t){let a=await e.vault.read(n),r=ra(t),s=lt(a),i=s?a.replace(s,r):a.trimEnd()+`

`+r+`
`;i!==a&&await e.vault.modify(n,i)}async function ua(e,n){let t=e.metadataCache.getFileCache(n)?.frontmatter??{},a={};if(typeof t.done=="boolean"&&(a.done=t.done),typeof t.status=="string"&&(a.status=t.status),typeof t.impact=="string"&&(a.impact=t.impact),da(t.duration_hours)&&(a.durationHours=Number(t.duration_hours)),da(t.budget)&&(a.budget=Number(t.budget)),typeof t.due=="string"){let r=fs(t.due);r&&(a.due=r)}return a}function da(e){return typeof e=="number"||typeof e=="string"&&e.trim()!==""&&!Number.isNaN(Number(e))}function fs(e){let n=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(n){let a=Number(n[1]),r=String(Number(n[2])).padStart(2,"0"),s=String(Number(n[3])).padStart(2,"0");return`${a}-${r}-${s}`}let t=new Date(e);if(!Number.isNaN(t.getTime())){let a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${a}-${r}-${s}`}}function ha(){let e=new ct,n;return{async init(t){n=t,await this.rescanAll(),e.markReady(),console.debug("[WishMap] indexer ready")},async rescanAll(){e.reset();let t=n.vault.getMarkdownFiles();for(let a of t){let r=await qt(n,a);r&&e.upsertNode(r)}for(let a of e.get().nodes.values())Gt(e,a);e.setUnscheduledCounts(ut(e))},onFileCreate(t){!(t instanceof ht.TFile)||t.extension!=="md"||qt(n,t).then(a=>{a&&(e.upsertNode(a),Gt(e,a),e.setUnscheduledCounts(ut(e)))})},onFileModify(t){!(t instanceof ht.TFile)||t.extension!=="md"||qt(n,t).then(a=>{a&&(e.upsertNode(a),Gt(e,a),e.setUnscheduledCounts(ut(e)))})},onFileDelete(t){t instanceof ht.TFile&&(e.removeNode(t.path),e.setUnscheduledCounts(ut(e)))},getStore(){return e}}}async function qt(e,n){let t=n.basename,a=ia(t);if(!a)return;let r=n.stat.mtime,s=await e.vault.read(n),i=oa(s),c=lt(s),d=await ua(e,n),o=ca(s);if(o.size===0){let h=await la(e,n);for(let p of h)o.add(p)}let l=new Set;for(let h of o){let p=e.metadataCache.getFirstLinkpathDest(h,n.path);p&&l.add(p.path)}return{path:n.path,basename:t,type:a,parents:l,primaryParent:void 0,secondaryParents:new Set,tags:i,yaml:d,conflicts:[],serviceLine:c,mtime:r}}function Gt(e,n){if(!n||!n.type)return;let t=[];for(let s of n.parents){let i=e.getNode(s);i&&ws(i.type,n.type)&&t.push(i)}if(t.length===0){n.primaryParent=void 0,n.secondaryParents=new Set,e.setPrimaryEdge(n.path,void 0),e.setObserverEdges(n.path,new Set);return}let a=ys(t);n.primaryParent=a?.path;let r=new Set(t.filter(s=>s.path!==n.primaryParent).map(s=>s.path));n.secondaryParents=r,e.setPrimaryEdge(n.path,n.primaryParent),e.setObserverEdges(n.path,r)}function ys(e){if(e.length===0)return;let n=e[0];for(let t=1;t<e.length;t++){let a=e[t],r=sa(n.tags,a.tags);(r>0||r===0&&a.mtime<n.mtime)&&(n=a)}return n}function ws(e,n){let t=["area","wish","goal","project","task"];return t.indexOf(e)<t.indexOf(n)}function ut(e){let n=0,t=0,a=0;for(let r of e.get().nodes.values())r.type==="goal"&&!r.tags.year&&n++,r.type==="project"&&!r.tags.quarter&&t++,r.type==="task"&&!r.yaml?.due&&a++;return{goal:n,project:t,task:a}}function ma(){return{async run(e){for(let n of e.get().nodes.values())await pa(e,n.path)},async onNodeChange(e,n){await pa(e,n)}}}async function pa(e,n){let t=e.getNode(n);if(t){if(t.yaml.due){let a=bs(t);await vs(e,t,a),t.primaryParent&&await Ts(e,t.path)}t.primaryParent&&await xs(e,t.primaryParent)}}function bs(e){return It(e.yaml.due)}async function vs(e,n,t){let a=Kt(n.tags,t);if(Qt(n.tags,a)){n.tags=a;let r=Ut(e,n.path);r&&(await dt(window.app,r,n.tags),console.debug("[WishMap] service tags updated",{path:n.path,tags:n.tags}))}}function Kt(e,n){let t={...e};return t.due=e.due??n.due,t.week=e.week??n.week,t.month=e.month??n.month,t.quarter=e.quarter??n.quarter,t.year=e.year??n.year,Ne(t)}function Qt(e,n){return JSON.stringify(e)!==JSON.stringify(n)}async function Ts(e,n){let t=e.getNode(n);if(!t?.yaml.due)return;let a=It(t.yaml.due),r=t.primaryParent?e.getNode(t.primaryParent):void 0;for(;r;){let s={};r.tags.year||(s.year=a.year),r.tags.quarter||(s.quarter=a.quarter),r.tags.month||(s.month=a.month),r.tags.week||(s.week=a.week);let i=Kt(r.tags,s);if(Qt(r.tags,i)){r.tags=i;let c=Ut(e,r.path);c&&await dt(window.app,c,r.tags),console.debug("[WishMap] Auto-filled parent from child due",{parent:r.path,tags:r.tags})}r=r.primaryParent?e.getNode(r.primaryParent):void 0}}async function xs(e,n){let t=e.getNode(n);if(!t)return;let a=e.get().childrenOf.get(n);if(a?.size)for(let r of a){let s=e.getNode(r);if(!s)continue;let i={};t.tags.year&&!s.tags.year&&(i.year=t.tags.year),t.tags.quarter&&!s.tags.quarter&&(i.quarter=t.tags.quarter),t.tags.month&&!s.tags.month&&(i.month=t.tags.month),t.tags.week&&!s.tags.week&&(i.week=t.tags.week);let c=Kt(s.tags,i);if(Qt(s.tags,c)){s.tags=c;let d=Ut(e,s.path);d&&await dt(window.app,d,s.tags),console.debug("[WishMap] Top-down fill",{child:s.path,tags:s.tags})}}}function Ut(e,n){return window.app.vault.getAbstractFileByPath(n)}var Ye=require("obsidian");function ga(){let e,n;return{init(t,a){e=t,n=a},onNoteOpen(t){let a=n.getNode(t);if(a){if(a.type==="goal"&&!a.tags.year){new Ye.Notice("WishMap: Schedule this goal for a year.");return}if(a.type==="project"&&(a.primaryParent?n.getNode(a.primaryParent):void 0)?.tags.year&&!a.tags.quarter){new Ye.Notice("WishMap: Assign a quarter for this project.");return}a.type==="task"&&!a.yaml.due&&(ks(n,a).some(i=>!i.tags.year||!i.tags.quarter)?new Ye.Notice("WishMap: Set a due date. Parents are unscheduled, we'll fill them automatically."):new Ye.Notice("WishMap: Set a due date or week for this task."))}}}}function ks(e,n){let t=[];for(let a of n.parents){let r=e.getNode(a);r&&t.push(r)}return t}var pt=class extends $.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set;this.data={};this._openedDailyGuard=!1;this.indexer=ha();this.inference=ma();this.prompts=ga()}async onload(){console.debug("[WishMap] loading\u2026"),await this.indexer.init(this.app),this.store=this.indexer.getStore(),await this.inference.run(this.store),this.prompts.init(this.app,this.store);let t=new ot(this.app);this.registerMarkdownPostProcessor((o,l)=>t.postProcess(o,l)),this.areaScheduler=new it(this.app),this.registerMarkdownPostProcessor((o,l)=>{this.areaScheduler.postProcess(o,l)}),this.addCommand({id:"wishmap-refresh-area-schedule",name:"WishMap: Refresh Area Schedule",callback:()=>{let o=this.app.workspace.getActiveViewOfType($.MarkdownView);if(!o)return;let l=o.getMode?.();o.setMode?.(l==="preview"?"source":"preview"),o.setMode?.("preview")}}),this.registerEvent(this.app.vault.on("create",async o=>{o instanceof $.TFile&&o.extension==="md"&&(this.indexer.onFileCreate(o),await this.inference.onNodeChange(this.store,o.path))})),this.registerEvent(this.app.vault.on("modify",async o=>{o instanceof $.TFile&&o.extension==="md"&&(this.indexer.onFileModify(o),await this.inference.onNodeChange(this.store,o.path))})),this.registerEvent(this.app.vault.on("delete",o=>{this.indexer.onFileDelete(o)})),this.registerEvent(this.app.workspace.on("file-open",o=>{o&&this.prompts.onNoteOpen(o.path)})),console.log("WishMap v0.2 loaded"),Dt(this),console.log("[WishMap] rollup auto: setup called from main"),zn(this),this.addCommand({id:"wishmap-generate-area-maps",name:"Generate Area Maps note",callback:async()=>{let o=await Vn(this.app),l=this.app.vault.getAbstractFileByPath(o);l&&this.app.workspace.getLeaf(!0).openFile(l)}}),this.addCommand({id:"wishmap-print-note",name:"Print (Export to PDF)",callback:()=>{this.app.commands.executeCommandById?.("markdown:export-pdf")}}),await this.loadSettings();let a=new Map,r=o=>{let l=o.path,u=a.get(l);u&&window.clearTimeout(u);let h=window.setTimeout(async()=>{a.delete(l),await Le(this.app,o)},300);a.set(l,h)};this.registerEvent(this.app.vault.on("create",async o=>{let l=o;!(l instanceof $.TFile)||l.extension!=="md"||window.setTimeout(async()=>{if(!de(this.app,l))return;let u=ee(this.app,l);for(let h of u)r(h)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async o=>{let l=o;if(!(l instanceof $.TFile)||l.extension!=="md"||!de(this.app,l))return;let u=ee(this.app,l);for(let h of u)r(h)})),this.addCommand({id:"project-rollup-duration-hours",name:"Project: Roll up duration_hours from linked tasks",callback:async()=>{}}),this.addCommand({id:"create-starter-structure",name:"Create Starter Structure",callback:async()=>{await en(this.app),new $.Notice("Starter structure created.")}}),tn(this.app),this.registerEvent(this.app.vault.on("create",async o=>{let l=o instanceof $.TFile?o:null;if(!l||l.extension!=="md")return;let h=this.app.metadataCache.getFileCache(l)?.frontmatter;(h&&(h.type==="habit"||h.category==="habit")||/\bhabit\b/i.test(l.basename))&&await En(this.app,l)})),this.registerEvent(this.app.workspace.on("file-open",async o=>{o&&await Se(this.app,o)})),cn(this.app),hn(this.app),Dn(this),Cn(this),this.addCommand({id:"open-today",name:"Open Today",callback:async()=>this.createOrOpenTodayDaily()}),this.addCommand({id:"run-habit-autolog",name:"Habit: Run Autolog for Scheduled Habits",callback:async()=>{await $n(this.app),new $.Notice("Habit autolog completed.")}}),this.addCommand({id:"toggle-first-checkbox",name:"Toggle First Checkbox",callback:async()=>{let o=this.app.workspace.getActiveFile();if(!o)return new $.Notice("No active file.");await ln(this.app,o)}}),this.addCommand({id:"habit-add-today-line",name:"Habit: Append Today Line",callback:async()=>{let o=this.app.workspace.getActiveFile();if(!o)return new $.Notice("No active file.");await Se(this.app,o)}}),this.addCommand({id:"wishmap-rescan",name:"WishMap: Rescan vault",callback:async()=>{new $.Notice("WishMap: Rescanning\u2026"),await this.indexer.rescanAll(),await this.inference.run(this.store),new $.Notice("WishMap: Rescan complete.")}}),this.addCommand({id:"wishmap-rebuild-inference",name:"WishMap: Rebuild inference",callback:async()=>{new $.Notice("WishMap: Rebuilding inference\u2026"),await this.inference.run(this.store),new $.Notice("WishMap: Inference rebuilt.")}});let s=!1;this.app.workspace.onLayoutReady(()=>{s||(this.ensureTodayDailyOpenOnce(),s=!0)}),this.registerEvent(this.app.metadataCache.on("resolved",()=>{s||(this.ensureTodayDailyOpenOnce(),s=!0)})),console.log("WishMap ready");let i=new Map,c=(o,l=300)=>{let u=o.path,h=i.get(u);h&&window.clearTimeout(h);let p=window.setTimeout(async()=>{i.delete(u),await Le(this.app,o)},l);i.set(u,p)},d=(o,l=1500)=>new Promise(u=>{let h=!1,p=()=>{h||(h=!0,u())},g=this.app.metadataCache.on("changed",y=>{y?.path===o&&(this.app.metadataCache.offref(g),p())});window.setTimeout(()=>{this.app.metadataCache.offref(g),p()},l)});this.registerEvent(this.app.vault.on("create",async o=>{let l=o;!(l instanceof $.TFile)||l.extension!=="md"||window.setTimeout(async()=>{if(!de(this.app,l))return;await d(l.path,1500);let u=ee(this.app,l);for(let h of u)c(h,200)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async o=>{let l=o;if(!(l instanceof $.TFile)||l.extension!=="md"||!de(this.app,l))return;let u=ee(this.app,l);for(let h of u)c(h,200)})),this.registerEvent(this.app.metadataCache.on("changed",async o=>{let l=o;!(l instanceof $.TFile)||l.extension!=="md"||ie(this.app,l)&&c(l,200)})),Dt(this)}onunload(){console.log("WishMap unloaded")}async openRouted(t){switch(t.type){case"task":await xn(this.app,t.name??"");break;case"project":await kn(this.app,t.name??"");break;case"goal":await Fn(this.app,t.name??"");break;case"daily":await $e(this.app);break}}todayISO(){return window.moment().format("YYYY-MM-DD")}pathForTodayDaily(){let t=window.moment(),a=t.format("YYYY-MM-DD"),r=t.format("dddd");return`02 Execution/1 Daily/${a} ${r}.md`}async createOrOpenTodayDaily(){let t=(0,$.normalizePath)(this.pathForTodayDaily()),a=this.app.vault.getAbstractFileByPath(t);if(a instanceof $.TFile){await this.app.workspace.getLeaf(!0).openFile(a);return}let s=this.app.vault.getAbstractFileByPath("03 SaveBox/Templates/Daily Template.md"),i="";s instanceof $.TFile&&(i=await this.app.vault.read(s),i=i.replace(/{{date}}/g,this.todayISO()));let c=await this.app.vault.create(t,i);await this.app.workspace.getLeaf(!0).openFile(c),console.log("Created today\u2019s daily:",t)}async ensureTodayDailyOpenOnce(){if(this._openedDailyGuard)return;let t=this.todayISO(),a=(0,$.normalizePath)(this.pathForTodayDaily()),r=this.app.vault.getAbstractFileByPath(a);if(r instanceof $.TFile){await this.app.workspace.getLeaf(!0).openFile(r),this._openedDailyGuard=!0,this.data.lastDailyISO=t,await this.saveSettings();return}await this.createOrOpenTodayDaily(),this._openedDailyGuard=!0,this.data.lastDailyISO=t,await this.saveSettings()}async loadSettings(){let t=await this.loadData();this.data=t??{}}async saveSettings(){await this.saveData(this.data)}};
